<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>K8sä¹‹RBAC | Hexo</title>
  <meta name="keywords" content=" RBAC ">
  <meta name="description" content="K8sä¹‹RBAC | Hexo">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="åœ¨ç”³è¯·æœºå™¨æ—¶ï¼Œåˆå§‹æœºå™¨å½“æ—¶ç”³è¯·çš„ç£ç›˜å¤§å°ä¸å®é™…ä¸ç¬¦ï¼Œé€šè¿‡è§‚å¯Ÿæ˜¯ç”³è¯·çš„ç¡¬ç›˜éœ€è¦æ‰‹åŠ¨æŒ‚è½½ï¼Œäºæ˜¯äº†è§£ä¸‹è¿™æ–¹é¢ä¸œè¥¿  å¯ä»¥çœ‹åˆ°æ ¹ç›®å½•æŒ‚è½½çš„ç©ºé—´å¤§å°ä¸º50Gï¼Œä½†æˆ‘ç”³è¯·çš„æ˜¯100Gï¼Œè¿˜æœ‰50Gç©ºä½™æ²¡åˆ©ç”¨ã€‚ å…ˆlsblk æŸ¥çœ‹ä¸‹å½“å‰åˆ†åŒºä¿¡æ¯  æŠŠç©ºä½™çš„åˆ†åŒºç©ºé—´åˆ©ç”¨èµ·æ¥fdisk &#x2F;dev&#x2F;sda æä¸ªæ–°åˆ†åŒº  mkfs.ext4 &#x2F;dev&#x2F;sda3 æ ¼å¼åŒ–æ–°åˆ†åŒºmount">
<meta property="og:type" content="article">
<meta property="og:title" content="ç£ç›˜æŒ‚è½½åˆ†åŒº">
<meta property="og:url" content="http://example.com/2024/10/09/%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="åœ¨ç”³è¯·æœºå™¨æ—¶ï¼Œåˆå§‹æœºå™¨å½“æ—¶ç”³è¯·çš„ç£ç›˜å¤§å°ä¸å®é™…ä¸ç¬¦ï¼Œé€šè¿‡è§‚å¯Ÿæ˜¯ç”³è¯·çš„ç¡¬ç›˜éœ€è¦æ‰‹åŠ¨æŒ‚è½½ï¼Œäºæ˜¯äº†è§£ä¸‹è¿™æ–¹é¢ä¸œè¥¿  å¯ä»¥çœ‹åˆ°æ ¹ç›®å½•æŒ‚è½½çš„ç©ºé—´å¤§å°ä¸º50Gï¼Œä½†æˆ‘ç”³è¯·çš„æ˜¯100Gï¼Œè¿˜æœ‰50Gç©ºä½™æ²¡åˆ©ç”¨ã€‚ å…ˆlsblk æŸ¥çœ‹ä¸‹å½“å‰åˆ†åŒºä¿¡æ¯  æŠŠç©ºä½™çš„åˆ†åŒºç©ºé—´åˆ©ç”¨èµ·æ¥fdisk &#x2F;dev&#x2F;sda æä¸ªæ–°åˆ†åŒº  mkfs.ext4 &#x2F;dev&#x2F;sda3 æ ¼å¼åŒ–æ–°åˆ†åŒºmount">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/132adbf626a746e1b00682dd424915b0.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/9ebb3e4f50d14911864944420704e553.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/0b019f55f0954044b30f4a5366636bfe.png">
<meta property="article:published_time" content="2024-10-09T03:56:07.454Z">
<meta property="article:modified_time" content="2024-10-09T05:55:11.433Z">
<meta property="article:author" content="hatjwe">
<meta property="article:tag" content="linuxå‘½ä»¤">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i-blog.csdnimg.cn/direct/132adbf626a746e1b00682dd424915b0.png">


<link rel="icon" href="/img/avatar1.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.3.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar1.jpg"/>
</a>
<div class="author">
    <span>hatjwe</span>
</div>

<div class="icon">
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(3)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="äº‘åŸç”Ÿ">
            <i class="fold iconfont icon-right"></i>
            äº‘åŸç”Ÿ
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="äº‘åŸç”Ÿ&lt;---&gt;RBAC">
            
            RBAC
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="ä¸»æœºå®‰å…¨">
            <i class="fold iconfont icon-right"></i>
            ä¸»æœºå®‰å…¨
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="ä¸»æœºå®‰å…¨&lt;---&gt;Capsule8">
            
            Capsule8
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="linuxè¿ç»´">
            
            linuxè¿ç»´
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="3">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="search shortcut key i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="switch to outline view shortcut key w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="return"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="case sensitive"></i>
            <i class="iconfont icon-tag" data-title="label"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">outline</div>
            <i class="iconfont icon-list" data-title="switch to article list"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Capsule8</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>linuxå‘½ä»¤</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>RBAC</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="All linuxè¿ç»´ "
           href="/2024/10/09/%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/"
           data-tag="linuxå‘½ä»¤"
           data-author="" >
            <span class="post-title" title="ç£ç›˜æŒ‚è½½åˆ†åŒº">ç£ç›˜æŒ‚è½½åˆ†åŒº</span>
            <span class="post-date" title="2024-10-09 11:56:07">2024/10/09</span>
        </a>
        
        
        <a  class="All äº‘åŸç”Ÿ RBAC "
           href="/2024/10/05/RBAC/"
           data-tag="RBAC"
           data-author="" >
            <span class="post-title" title="K8sä¹‹RBAC">K8sä¹‹RBAC</span>
            <span class="post-date" title="2024-10-05 21:49:22">2024/10/05</span>
        </a>
        
        
        <a  class="All ä¸»æœºå®‰å…¨ Capsule8 "
           href="/2024/10/05/ecaplute8/"
           data-tag="Capsule8"
           data-author="" >
            <span class="post-title" title="Capsule8åˆ†æ (ä¸€)">Capsule8åˆ†æ (ä¸€)</span>
            <span class="post-date" title="2024-10-05 21:49:22">2024/10/05</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="Toggle full screen shortcut key s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-RBAC" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">K8sä¹‹RBAC</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="äº‘åŸç”Ÿ">äº‘åŸç”Ÿ</a> > 
            
            <a  data-rel="äº‘åŸç”Ÿ&lt;---&gt;RBAC">RBAC</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color5">RBAC</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2024-10-05 21:55:57'>2024-10-05 21:49</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#RBAC"><span class="toc-text">RBAC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7user"><span class="toc-text">ç”¨æˆ·user</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-text">åˆ›å»ºç”¨æˆ·</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-CertificateSigningRequest"><span class="toc-text">åˆ›å»º CertificateSigningRequest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%96%E5%BE%97%E8%AF%81%E4%B9%A6"><span class="toc-text">å–å¾—è¯ä¹¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%B0-kubeconfig"><span class="toc-text">æ·»åŠ åˆ° kubeconfig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RBAC%E6%9D%A5%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90"><span class="toc-text">RBACæ¥åˆ†é…æƒé™</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%92%E8%89%B2Role%E5%92%8CClusterRole"><span class="toc-text">åˆ›å»ºè§’è‰²Roleå’ŒClusterRole</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RoleBinding-%E5%92%8C-ClusterRoleBinding"><span class="toc-text">RoleBinding å’Œ ClusterRoleBinding</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E5%88%92%E5%88%86"><span class="toc-text">æƒé™åˆ’åˆ†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6%E6%96%B9%E6%B3%95"><span class="toc-text">æ‰‹åŠ¨åˆ›å»ºè¯ä¹¦æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7server-account"><span class="toc-text">åˆ›å»ºç”¨æˆ·server account</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%92%E8%89%B2role%E5%92%8CroleBinding"><span class="toc-text">è§’è‰²roleå’ŒroleBinding</span></a></li></ol></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="RBAC"><a href="#RBAC" class="headerlink" title="RBAC"></a>RBAC</h2><p>BACæ¨¡å‹(Role-Based Access Control:åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶)ï¼Œk8sé›†ç¾¤ä¸­çš„èº«ä»½æœ‰ä¸¤ç§ï¼šç”¨æˆ·ï¼ˆUserï¼‰å’ŒæœåŠ¡è´¦å·ï¼ˆService Accountï¼‰ï¼Œå…¶ä¸­service accountæ˜¯k8sä¸ºpodå†…éƒ¨çš„è¿›ç¨‹è®¿é—®apiserveråˆ›å»ºçš„ä¸€ç§ç”¨æˆ·ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡saä¸­çš„tokenä¸apierverè¿›è¡Œé€šä¿¡ï¼Œä¹Ÿå¯ä»¥åŸºäºç”¨æˆ·çš„kubeconfigä¸apierverè¿›è¡Œé€šä¿¡ã€‚</p>
<span id="more"></span>

<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/11.png" alt="img"></p>
<h3 id="ç”¨æˆ·user"><a href="#ç”¨æˆ·user" class="headerlink" title="ç”¨æˆ·user"></a>ç”¨æˆ·user</h3><p>å¯¹äºUserè´¦æˆ·ï¼Œä¸»è¦åˆ†ä¸ºç³»ç»Ÿç®¡ç†å‘˜è´¦æˆ·å’Œæ™®é€šè´¦æˆ·ï¼Œç³»ç»Ÿç®¡ç†å‘˜è´¦æˆ·ä¸ºåˆ›é€ é›†ç¾¤æ—¶è‡ªå¸¦ï¼Œæƒé™å¾ˆé«˜ï¼Œæ™®é€šè´¦æˆ·ä¹Ÿæ˜¯ç”±ç³»ç»Ÿç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºå¹¶èµ‹äºˆæœŸå¯¹åº”çš„è®¿é—®æ“ä½œæƒé™ã€‚</p>
<h3 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h3><p>å¯¹äºUserè´¦æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºk8sé›†ç¾¤æ—¶è‡ªå¸¦çš„è¯ä¹¦å¯¹æˆ‘ä»¬ï¼ˆadminï¼‰æƒé™ï¼ˆå‡ ä¹ï¼‰æ‰‹åŠ¨ç®¡ç†masterä¸­çš„å‡­è¯æ–‡ä»¶ï¼Œå¹¶ä¸”å°†æ¯ä¸ªå‡­è¯æ–‡ä»¶å’Œä¸€ä¸ªå­—ç¬¦ä¸²å¯¹åº”èµ·æ¥ï¼Œåªè¦ç”¨æˆ·è¯·æ±‚ä¸­æœ‰ä¿¡æ¯ï¼ˆä¸€èˆ¬æ¥è‡ªæœ¬åœ°ä¿å­˜çš„.kube&#x2F;configæ–‡ä»¶ä¸­ï¼‰èƒ½å¤Ÿè¯æ˜è‡ªå·±æœ‰ä»»æ„ä¸€ä¸ªå‡­è¯æ–‡ä»¶çš„æˆæƒï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å°±è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªåˆæ³•ç”¨æˆ·å‘å‡ºçš„ï¼ŒåŒæ—¶ï¼Œåœ¨è¯ä¹¦ä¸­è¿˜å¯ä»¥åŠ å…¥ç”¨æˆ·æ‰€åœ¨çš„ç»„ï¼ˆgroupï¼‰çš„ä¿¡æ¯ï¼Œk8så¯ä»¥æ®æ­¤è®¤ä¸ºuseråœ¨ä¸€ä¸ªç»„ä¸­æˆ–è€…åæœŸé€šè¿‡rolebindingç­‰èµ‹äºˆæ“ä½œæƒé™ã€‚</p>
<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/AFCB03E0-BB72-46f2-B417-FB0B7E3406AF.png" alt="img"><br>é€šè¿‡CSRåˆ›å»ºä¸ºä¾‹ï¼Œï¼ˆå‚è€ƒå®˜æ–¹æ–‡æ¡£<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/certificate-signing-requests%EF%BC%89">https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/certificate-signing-requestsï¼‰</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>ç”Ÿæˆä¸€ä¸ª <span class="number">2048</span> ä½çš„ morece.key æ–‡ä»¶</span><br><span class="line">openssl genrsa -out morece.key <span class="number">2048</span></span><br><span class="line"><span class="number">2.</span>åœ¨ morece.key æ–‡ä»¶çš„åŸºç¡€ä¸Šï¼Œç”Ÿæˆ morece.crt æ–‡ä»¶ï¼ˆç”¨å‚æ•° -days è®¾ç½®è¯ä¹¦æœ‰æ•ˆæœŸï¼‰</span><br><span class="line">è¿™é‡Œæ³¨æ„ä¸¤ä¸ªå­—æ®µCommon Nameè¾“å…¥çš„æ˜¯ç”¨æˆ·åã€‚</span><br><span class="line">Organization Name æ˜¯ç”¨æˆ·ç»„ï¼Œå¦‚æœå†™system:mastersåˆ™å½’å±äºç³»ç»Ÿç»„è·å–ç³»ç»Ÿç®¡ç†æƒé™ï¼Œè¿™å—å¯ä»¥å†™ä¸€ä¸ªæ–°çš„ï¼Œåè¾¹æˆ‘ä»¬é€šè¿‡roleæˆ–clusterroleæ¥é™åˆ¶è´¦å·çš„æƒé™ã€‚</span><br><span class="line">openssl req -<span class="built_in">new</span> -key morece.key -out morece.csr</span><br></pre></td></tr></table></figure>



<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/2.png" alt="img"></p>
<h4 id="åˆ›å»º-CertificateSigningRequest"><a href="#åˆ›å»º-CertificateSigningRequest" class="headerlink" title="åˆ›å»º CertificateSigningRequest"></a>åˆ›å»º CertificateSigningRequest</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: certificates.k8s.io/v1</span><br><span class="line">kind: CertificateSigningRequest</span><br><span class="line">metadata:</span><br><span class="line">  name: morece</span><br><span class="line">spec:</span><br><span class="line">  request: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ2p6Q0NBWGNDQVFBd1NqRUxNQWtHQTFVRUJoTUNRMDR4RlRBVEJnTlZCQWNNREVSbFptRjFiSFFnUTJsMAplVEVUTUJFR0ExVUVDZ3dLYTNWaVpYSnVaWFJsY3pFUE1BMEdBMVVFQXd3R2JXOXlaV05sTUlJQklqQU5CZ2txCmhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBd2hwOFh6Q2NLL2RJb1Y2aXJ0ZnVyeDN4MGU5Z1Z3Y1IKalNpUG1UVkcvc1ltUmhDbmd0djhOWldlanNjN2dDU1g2OEhDbW9kTk0yOGFYc3d0QnpnU2xQZk5HLytRZHUrVgpCQXF3YUtGS0xSeS9JQ2hON2hBaHo3MzNacFRDYTdlbktxUjlMZ285S1pwV2EzUFh1em4rZVZKNnpFTlpkN0FKCldzbVZ4MWZwejVLVmxWZXVQbUk3aW1JMHp5T29CVUVGVXB0ZStyTWlMMFRZTEpidmdab3ZZeXMwcTd2bCtpVm4KTkdzUkZ2RmY4eWVvUE5jS0pVWHZLWkp0TDRqaWJaUnptNitFd1RwR0tPbGw1b0JVUzhxdDdIb3VoaE92NmZlcgp1SGdwQ1RCbSsxbW9wTnUzMklZbmd6U1ZWUlFKR1FxbEVqRkFtQUNrVmNyOGU1L2hQMTBGWndJREFRQUJvQUF3CkRRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFIZW1jcVhEVFo0bnc0OUovdGRDRlJzYU4zMkdhT0J0aVo0alVQVE8KZGhRUjN5MDliQk1IYmJiSktjMCtlMnJGcll4aUFmMS8yV00rTmI3U1VhNGQzSWZFYlY2VzJuY1c3MTljTWFqZAovbjFPVVJzTWNuaUpRWGlwS3ZFUXpETzlJMmRQSHI2emNjOFBsVnJheXVsait6MlNuUE5HVzJwSzBUdWkzSTFCCkhEOXdBbWluNHlYWXlsK2p5dDFuV3Fsd05teWpqbVNYL2pwYmRsSldiYlRXT1RoMkczT1g5M0ltTW8vUUtnVXkKenJhQTB4RFJZS0dPSGlZOEVRL1RITWtyTGpDdi8raDdZZ1pWYTBIZ3hoczNCTmVvS2JTYTBsb01iRnhCNFl0eAo4TEdaa1Rtc0JsVUFhU3RmVFhQa0lnUVBlR3IrTFMzY2RTbjVEaUhRNVBzZmw1OD0KLS0tLS1FTkQgQ0VSVElGSUNBVEUgUkVRVUVTVC0tLS0tCg==</span><br><span class="line">  signerName: kubernetes.io/kube-apiserver-client</span><br><span class="line">  expirationSeconds: <span class="number">86400</span>  # one day</span><br><span class="line">  usages:</span><br><span class="line">  - client auth</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>usage</code> å­—æ®µå¿…é¡»æ˜¯ â€˜<code>client auth</code>â€˜</p>
</li>
<li><p><code>expirationSeconds</code> å¯ä»¥è®¾ç½®ä¸ºæ›´é•¿ï¼ˆä¾‹å¦‚ <code>864000</code> æ˜¯åå¤©ï¼‰æˆ–è€…æ›´çŸ­ï¼ˆä¾‹å¦‚ <code>3600</code> æ˜¯ä¸€ä¸ªå°æ—¶ï¼‰</p>
</li>
<li><p><code>request</code> å­—æ®µæ˜¯ CSR æ–‡ä»¶å†…å®¹çš„ base64 ç¼–ç å€¼ã€‚ è¦å¾—åˆ°è¯¥å€¼ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat morece.csr | base64 | tr -d <span class="string">&quot;\n&quot;</span></span><br></pre></td></tr></table></figure>

<p>æ‰¹å‡†è¯ä¹¦kubectl certificate approve morece</p>
</li>
</ul>
<h4 id="å–å¾—è¯ä¹¦"><a href="#å–å¾—è¯ä¹¦" class="headerlink" title="å–å¾—è¯ä¹¦"></a>å–å¾—è¯ä¹¦</h4><p>ä» CSR å–å¾—è¯ä¹¦ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get csr/morece -o yaml</span><br></pre></td></tr></table></figure>

<p>è¯ä¹¦çš„å†…å®¹ä½¿ç”¨ base64 ç¼–ç ï¼Œå­˜æ”¾åœ¨å­—æ®µ <code>status.certificate</code>ã€‚</p>
<p>ä» CertificateSigningRequest å¯¼å‡ºé¢å‘çš„è¯ä¹¦ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get csr morece -o jsonpath=&#x27;&#123;.status.certificate&#125;&#x27;| base64 -d &gt; morece.crt</span><br></pre></td></tr></table></figure>

<h4 id="æ·»åŠ åˆ°-kubeconfig"><a href="#æ·»åŠ åˆ°-kubeconfig" class="headerlink" title="æ·»åŠ åˆ° kubeconfig"></a>æ·»åŠ åˆ° kubeconfig</h4><p>æœ€åä¸€æ­¥æ˜¯å°†è¿™ä¸ªç”¨æˆ·æ·»åŠ åˆ° kubeconfig æ–‡ä»¶ã€‚</p>
<p>é¦–å…ˆï¼Œä½ éœ€è¦æ·»åŠ æ–°çš„å‡­æ®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config set-credentials morece --client-key=morece.key --client-certificate=morece.crt --embed-certs=true</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œä½ éœ€è¦æ·»åŠ ä¸Šä¸‹æ–‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config set-context morece --cluster=kubernetes --user=morece</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¹Ÿæ¨èä¸ªå·¥å…·çœ‹ç”¨æˆ·,åˆ‡æ¢contextå¾ˆæ–¹ä¾¿<a target="_blank" rel="noopener" href="https://github.com/sunny0826/kubecm.git">https://github.com/sunny0826/kubecm.git</a></p>
<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/4.png" alt="img"><br>æ¥æµ‹è¯•ä¸€ä¸‹ï¼ŒæŠŠä¸Šä¸‹æ–‡åˆ‡æ¢ä¸º <code> morece</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context morece</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æŠ¥é”™äº†ï¼Œé”™è¯¯åŸå› æ˜¯moreæµ‹ç”¨æˆ·å¹¶æ²¡æœ‰æƒé™å»è®¿é—®defaultç©ºé—´ä¸‹çš„podï¼Œè¿™æ—¶å€™å°±è¦å¼•å…¥RBACæ¥åˆ†é…æƒé™äº†</p>
<h4 id="RBACæ¥åˆ†é…æƒé™"><a href="#RBACæ¥åˆ†é…æƒé™" class="headerlink" title="RBACæ¥åˆ†é…æƒé™"></a>RBACæ¥åˆ†é…æƒé™</h4><p>RBAC API å£°æ˜äº†å››ç§ Kubernetes å¯¹è±¡ï¼š<strong>Role</strong>ã€<strong>ClusterRole</strong>ã€<strong>RoleBinding</strong> å’Œ <strong>ClusterRoleBinding</strong>ã€‚</p>
<h3 id="åˆ›å»ºè§’è‰²Roleå’ŒClusterRole"><a href="#åˆ›å»ºè§’è‰²Roleå’ŒClusterRole" class="headerlink" title="åˆ›å»ºè§’è‰²Roleå’ŒClusterRole"></a>åˆ›å»ºè§’è‰²Roleå’ŒClusterRole</h3><p>Role æ€»æ˜¯ç”¨æ¥åœ¨æŸä¸ª<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/namespaces/">åå­—ç©ºé—´</a>å†…è®¾ç½®è®¿é—®æƒé™ï¼› åœ¨ä½ åˆ›å»º Role æ—¶ï¼Œä½ å¿…é¡»æŒ‡å®šè¯¥ Role æ‰€å±çš„åå­—ç©ºé—´ã€‚</p>
<p>ä¸ä¹‹ç›¸å¯¹ï¼ŒClusterRole åˆ™æ˜¯ä¸€ä¸ªé›†ç¾¤ä½œç”¨åŸŸçš„èµ„æº</p>
<p>æ¥ä¸‹æ¥åˆ›å»ºä¸ªè¯»å–default podçš„æƒé™(æ³¨æ„è¦åˆ‡æ¢ä¸ºç®¡ç†å‘˜contextå†è¿›è¡Œèµ„æºåˆ›å»º)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: Role</span><br><span class="line">metadata:</span><br><span class="line">  namespace: <span class="keyword">default</span></span><br><span class="line">  name: morecepod-reader</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [<span class="string">&quot;&quot;</span>] # <span class="string">&quot;&quot;</span> æ ‡æ˜ core API ç»„</span><br><span class="line">  resources: [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  verbs: [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]<span class="comment">//å…è®¸çš„æ“ä½œè¡Œä¸º</span></span><br><span class="line"><span class="comment">//getå’ŒliståŒºåˆ«åœ¨äºå¦‚æœæ˜¯getå¯ä»¥æŸ¥çœ‹è¯¦æƒ…kubectl describeè¿™åœ¨secretæ—¶è·å–è¯¦æƒ…ä¸­çš„tokenå¾ˆå¥½ç”¨ï¼Œliståªèƒ½è·å–åˆ—è¡¨ä¸èƒ½æŸ¥çœ‹è¯¦æƒ…</span></span><br></pre></td></tr></table></figure>
<h4 id="RoleBinding-å’Œ-ClusterRoleBinding"><a href="#RoleBinding-å’Œ-ClusterRoleBinding" class="headerlink" title="RoleBinding å’Œ ClusterRoleBinding"></a><strong>RoleBinding</strong> å’Œ <strong>ClusterRoleBinding</strong></h4><p>ç®€å•æ¥è¯´<strong>RoleBinding</strong> å’Œ <strong>ClusterRoleBinding</strong>å°±æ˜¯å°†Roleå’ŒClusterRoleè§„åˆ™ä½œç”¨æ•ˆæœç»‘å®šåˆ°ç”¨æˆ·æˆ–serveraccountï¼Œä½¿å…¶æ‹¥æœ‰ä¸Roleå’ŒClusterRoleä¸€æ ·çš„æƒé™ã€‚</p>
<p>ä¸€ä¸ª RoleBinding å¯ä»¥å¼•ç”¨åŒä¸€çš„åå­—ç©ºé—´ä¸­çš„ä»»ä½• Roleã€‚ æˆ–è€…ï¼Œä¸€ä¸ª RoleBinding å¯ä»¥å¼•ç”¨æŸ ClusterRole å¹¶å°†è¯¥ ClusterRole ç»‘å®šåˆ° RoleBinding æ‰€åœ¨çš„åå­—ç©ºé—´ã€‚ å¦‚æœä½ å¸Œæœ›å°†æŸ ClusterRole ç»‘å®šåˆ°é›†ç¾¤ä¸­æ‰€æœ‰åå­—ç©ºé—´ï¼Œä½ è¦ä½¿ç”¨ ClusterRoleBindingã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line"># æ­¤è§’è‰²ç»‘å®šå…è®¸ <span class="string">&quot;jane&quot;</span> è¯»å– <span class="string">&quot;default&quot;</span> åå­—ç©ºé—´ä¸­çš„ Pod</span><br><span class="line"># ä½ éœ€è¦åœ¨è¯¥å‘½åç©ºé—´ä¸­æœ‰ä¸€ä¸ªåä¸º â€œpod-readerâ€ çš„ Role</span><br><span class="line">kind: RoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: moreceread-pods</span><br><span class="line">  namespace: <span class="keyword">default</span></span><br><span class="line">subjects:</span><br><span class="line"># ä½ å¯ä»¥æŒ‡å®šä¸æ­¢ä¸€ä¸ªâ€œsubjectï¼ˆä¸»ä½“ï¼‰â€</span><br><span class="line">- kind: User</span><br><span class="line">  name: morece # <span class="string">&quot;morece&quot;</span> æ˜¯åŒºåˆ†å¤§å°å†™çš„</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">roleRef:</span><br><span class="line">  # <span class="string">&quot;roleRef&quot;</span> æŒ‡å®šä¸æŸ Role æˆ– ClusterRole çš„ç»‘å®šå…³ç³»</span><br><span class="line">  kind: Role        # æ­¤å­—æ®µå¿…é¡»æ˜¯ Role æˆ– ClusterRole</span><br><span class="line">  name: morecepod-reader  # æ­¤å­—æ®µå¿…é¡»ä¸ä½ è¦ç»‘å®šçš„ Role æˆ– ClusterRole çš„åç§°åŒ¹é…</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†æŠŠä¸Šä¸‹æ–‡åˆ‡æ¢ä¸º <code> morece</code>çœ‹ä¸‹defaultç©ºé—´ä¸‹podå¯ä»¥äº†ï¼š</p>
<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/5.png" alt="img"></p>
<h3 id="æƒé™åˆ’åˆ†"><a href="#æƒé™åˆ’åˆ†" class="headerlink" title="æƒé™åˆ’åˆ†"></a>æƒé™åˆ’åˆ†</h3><p>Roleå’ŒClusterRoleçš„æƒé™æ§åˆ¶ä¸»è¦é€šè¿‡rulesä¸‹å­—æ®µ<br>apiGroupsï¼šè®¾å®šèµ„æºç»„â€â€ æ ‡æ˜ core API ç»„ï¼Œâ€<em>â€œ æ ‡æ˜æ‰€æœ‰ç»„<br>resourceå†…å®¹ä¸ºå¸¸è§èµ„æºç±»ï¼ˆcrontabsã€jobsã€podsã€pods&#x2F;logã€configmapsã€deploymentsç­‰ï¼‰<br>åŒæ—¶ä¹Ÿæ”¯æŒnonResourceURLsé€šè¿‡api urlåŠ è½½<br>nonResourceURLs: [â€œ&#x2F;healthzâ€, â€œ&#x2F;healthz&#x2F;</em>â€œ] # nonResourceURL ä¸­çš„ â€˜*â€™ æ˜¯ä¸€ä¸ªå…¨å±€é€šé…ç¬¦</p>
<p>verbsä¸»è¦æ§åˆ¶å¯¹èµ„æºçš„è¡Œä¸º[â€œgetâ€, â€œlistâ€, â€œwatchâ€, â€œcreateâ€, â€œupdateâ€, â€œpatchâ€, â€œdeleteâ€]</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: Role</span><br><span class="line">metadata:</span><br><span class="line">  namespace: <span class="keyword">default</span></span><br><span class="line">  name: morecepod-reader</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [<span class="string">&quot;&quot;</span>] # <span class="string">&quot;&quot;</span> æ ‡æ˜ core API ç»„</span><br><span class="line">  resources: [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  verbs: [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]<span class="comment">//å…è®¸çš„æ“ä½œè¡Œä¸º</span></span><br><span class="line"><span class="comment">//getå’ŒliståŒºåˆ«åœ¨äºå¦‚æœæ˜¯getå¯ä»¥æŸ¥çœ‹è¯¦æƒ…kubectl describeè¿™åœ¨secretæ—¶è·å–è¯¦æƒ…ä¸­çš„tokenå¾ˆå¥½ç”¨ï¼Œliståªèƒ½è·å–åˆ—è¡¨ä¸èƒ½æŸ¥çœ‹è¯¦æƒ…</span></span><br></pre></td></tr></table></figure>



<h4 id="æ‰‹åŠ¨åˆ›å»ºè¯ä¹¦æ–¹æ³•"><a href="#æ‰‹åŠ¨åˆ›å»ºè¯ä¹¦æ–¹æ³•" class="headerlink" title="æ‰‹åŠ¨åˆ›å»ºè¯ä¹¦æ–¹æ³•"></a>æ‰‹åŠ¨åˆ›å»ºè¯ä¹¦æ–¹æ³•</h4><p>åˆ©ç”¨æ‰‹åŠ¨åˆ›å»ºè¯ä¹¦åˆ›å»ºç”¨æˆ·ï¼Œå‰é¢ç”Ÿæˆå¯†é’¥éƒ¨åˆ†éƒ½ç›¸åŒï¼Œä½†æ˜¯ç­¾åé€šè¿‡åˆ©ç”¨é›†ç¾¤ä¸­CAè‡ªå¸¦çš„CAè¯ä¹¦è¿›è¡Œç­¾åå³å¯ã€‚è¯¦ç»†åœ¨<a target="_blank" rel="noopener" href="http://blog.itpub.net/69955379/viewspace-2778141">http://blog.itpub.net/69955379/viewspace-2778141</a></p>
<h3 id="åˆ›å»ºç”¨æˆ·server-account"><a href="#åˆ›å»ºç”¨æˆ·server-account" class="headerlink" title="åˆ›å»ºç”¨æˆ·server account"></a>åˆ›å»ºç”¨æˆ·server account</h3><p>æœåŠ¡è´¦å·å¯¹è±¡ä¸»ä½“æ›´å¤šä¸ºpod,æ¯”å¦‚å½“æœ‰podéœ€è¦è¿è¡Œæ—¶ï¼Œå¿…é¡»ä»¥ä¸€ä¸ªservice accountçš„èº«ä»½å»è¿è¡Œä»–ã€‚ä¸€ä¸ªpodä¸éœ€è¦åŒºåˆ†æ˜¯é‚£ä¸ªç”¨æˆ·çš„ï¼Œåªéœ€è¦å¯¹service accountæƒé™è¿›è¡Œæ§åˆ¶å³å¯ã€‚</p>
<p>æˆ‘ä»¬åœ¨åˆ›å»º Pod æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šæœåŠ¡è´¦å·ï¼ŒPod ä¼šè¢«æŒ‡å®šç»™å‘½åç©ºé—´ä¸­çš„ <code>default</code> æœåŠ¡è´¦å·ã€‚</p>
<h4 id="è§’è‰²roleå’ŒroleBinding"><a href="#è§’è‰²roleå’ŒroleBinding" class="headerlink" title="è§’è‰²roleå’ŒroleBinding"></a>è§’è‰²roleå’ŒroleBinding</h4><p>ä¸‹é¢æˆ‘ä»¬åœ¨namespaceä¸ºceshiä¸‹åˆ›å»ºä¸€ä¸ªservice account,æ¥ç€åœ¨podä¸­ä½¿ç”¨è¿™ä¸ªè´¦æˆ·</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kubectl create serviceaccount morece -n ceshi <span class="comment">//åˆ›å»ºsa</span></span><br><span class="line">æŒ‚è½½saèµ·pod</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: morecewithsa</span><br><span class="line">  namespace: ceshi</span><br><span class="line">spec:</span><br><span class="line">  serviceAccount: morece</span><br><span class="line">  containers:</span><br><span class="line">    - name: morece</span><br><span class="line">      image: nginx</span><br><span class="line">      imagePullPolicy: IfNotPresent </span><br><span class="line">å°†kubectl cpè¿›å»æµ‹è¯•ç”¨</span><br><span class="line">kubectl cp /usr/bin/kubectl ceshi/morecewithsa:/</span><br><span class="line">find / -name <span class="string">&quot;*token&quot;</span>æ‰¾ä¸€ä¸‹podé‡ŒæŒ‚è½½çš„token,ä¹Ÿå¯ä»¥ç›´æ¥ç”¨kubectl</span><br><span class="line">kubectl get pod</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/7.png" alt="img"></p>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å…‰æ˜¯åˆ›å»ºä¸€ä¸ªservice account,åœ¨podå†…æ˜¯æ²¡ä»€ä¹ˆæƒé™çš„ï¼Œç°åœ¨åˆ›å»ºä¸ªroleï¼Œé€šè¿‡rolebindingç»‘å®šåœ¨æˆ‘ä»¬çš„saä¸Š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: Role</span><br><span class="line">metadata:</span><br><span class="line">  namespace: ceshi</span><br><span class="line">  name: morecepod-create</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [<span class="string">&quot;*&quot;</span>]</span><br><span class="line">  # åœ¨ HTTP å±‚é¢ï¼Œç”¨æ¥è®¿é—® Secret èµ„æºçš„åç§°ä¸º <span class="string">&quot;secrets&quot;</span></span><br><span class="line">  resources: [<span class="string">&quot;secrets&quot;</span>,<span class="string">&quot;pods&quot;</span>,<span class="string">&quot;nodes&quot;</span>,<span class="string">&quot;services&quot;</span>]</span><br><span class="line">  verbs: [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>,<span class="string">&quot;create&quot;</span>]</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line"># æ­¤è§’è‰²ç»‘å®šå…è®¸ service account è¯»å– <span class="string">&quot;ceshi&quot;</span> åå­—ç©ºé—´ä¸­çš„ Pod</span><br><span class="line"># ä½ éœ€è¦åœ¨è¯¥å‘½åç©ºé—´ä¸­æœ‰ä¸€ä¸ªåä¸º â€œmorecepod-createâ€ çš„ Role</span><br><span class="line">kind: RoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: morececreate-pods</span><br><span class="line">  namespace: ceshi</span><br><span class="line">subjects:</span><br><span class="line"># ä½ å¯ä»¥æŒ‡å®šä¸æ­¢ä¸€ä¸ªâ€œsubjectï¼ˆä¸»ä½“ï¼‰â€</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: morece # <span class="string">&quot;morece&quot;</span> æ˜¯åŒºåˆ†å¤§å°å†™çš„</span><br><span class="line">roleRef:</span><br><span class="line">  # <span class="string">&quot;roleRef&quot;</span> æŒ‡å®šä¸æŸ Role æˆ– ClusterRole çš„ç»‘å®šå…³ç³»</span><br><span class="line">  kind: Role        # æ­¤å­—æ®µå¿…é¡»æ˜¯ Role æˆ– ClusterRole</span><br><span class="line">  name: morecepod-create  # æ­¤å­—æ®µå¿…é¡»ä¸ä½ è¦ç»‘å®šçš„ Role æˆ– ClusterRole çš„åç§°åŒ¹é…</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>åœ¨é‡Œè¾¹è¯•è¯•åˆ›å»ºä¸ªpod,å¯ä»¥äº†</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | ./kubectl apply -f -</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: createinmorecewithsa</span><br><span class="line">  namespace: ceshi</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">    - name: createinmorecewithsacon</span><br><span class="line">      image: nginx</span><br><span class="line">      imagePullPolicy: IfNotPresent  </span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/8.png?Expires=1676567430&OSSAccessKeyId=TMP.3Kk4pSrSmBFm96NfgY6GZKm1qhse1DffMaig8NhGPYR9RcQ4j74QAFhCvmGWDyXkr2E7wtHv71FS2rrVZhzZTQXAJUXuCo&Signature=iOG9FI4viDa8002eio23AIw0dw0=" alt="img"></p>
<p>æˆ‘ä»¬å†è¯•è¯•åœ¨åˆ«çš„å‘½åç©ºé—´åˆ›å»ºpodï¼Œå¤±è´¥äº†ã€‚äºæ˜¯ç°åœ¨åˆ›å»ºä¸ªclusterroleï¼Œé€šè¿‡clusterrolebindingç»‘å®šåœ¨æˆ‘ä»¬çš„saä¸Š</p>
<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/9.png" alt="img"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  # <span class="string">&quot;namespace&quot;</span> è¢«å¿½ç•¥ï¼Œå› ä¸º ClusterRoles ä¸å—åå­—ç©ºé—´é™åˆ¶</span><br><span class="line">  name: pod-create</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [<span class="string">&quot;*&quot;</span>]</span><br><span class="line">  # åœ¨ HTTP å±‚é¢ï¼Œç”¨æ¥è®¿é—® Secret èµ„æºçš„åç§°ä¸º <span class="string">&quot;secrets&quot;</span></span><br><span class="line">  resources: [<span class="string">&quot;secrets&quot;</span>,<span class="string">&quot;pods&quot;</span>,<span class="string">&quot;nodes&quot;</span>,<span class="string">&quot;services&quot;</span>]</span><br><span class="line">  verbs: [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>,<span class="string">&quot;create&quot;</span>]</span><br><span class="line">EOF</span><br><span class="line">  cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line"># æ­¤é›†ç¾¤è§’è‰²ç»‘å®šå…è®¸ â€œmanagerâ€ ç»„ä¸­çš„ä»»ä½•äººè®¿é—®ä»»ä½•åå­—ç©ºé—´ä¸­çš„ Secret èµ„æº</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: create-pod-glob</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  namespace: ceshi</span><br><span class="line">  name: morece      # <span class="string">&#x27;name&#x27;</span> æ˜¯åŒºåˆ†å¤§å°å†™çš„</span><br><span class="line">roleRef:</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: pod-create</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>


      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æº. </span>
    </div>
</article>







    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2022-2024
</p>


    </div>
    <div class="full-toc">
        <button class="full" data-title="Toggle full screen shortcut key s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>







</html>
