<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>K8s‰πãRBAC | Hexo</title>
  <meta name="keywords" content=" RBAC ">
  <meta name="description" content="K8s‰πãRBAC | Hexo">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="Âú®Áî≥ËØ∑Êú∫Âô®Êó∂ÔºåÂàùÂßãÊú∫Âô®ÂΩìÊó∂Áî≥ËØ∑ÁöÑÁ£ÅÁõòÂ§ßÂ∞è‰∏éÂÆûÈôÖ‰∏çÁ¨¶ÔºåÈÄöËøáËßÇÂØüÊòØÁî≥ËØ∑ÁöÑÁ°¨ÁõòÈúÄË¶ÅÊâãÂä®ÊåÇËΩΩÔºå‰∫éÊòØ‰∫ÜËß£‰∏ãËøôÊñπÈù¢‰∏úË•ø  ÂèØ‰ª•ÁúãÂà∞Ê†πÁõÆÂΩïÊåÇËΩΩÁöÑÁ©∫Èó¥Â§ßÂ∞è‰∏∫50GÔºå‰ΩÜÊàëÁî≥ËØ∑ÁöÑÊòØ100GÔºåËøòÊúâ50GÁ©∫‰ΩôÊ≤°Âà©Áî®„ÄÇ ÂÖàlsblk Êü•Áúã‰∏ãÂΩìÂâçÂàÜÂå∫‰ø°ÊÅØ  ÊääÁ©∫‰ΩôÁöÑÂàÜÂå∫Á©∫Èó¥Âà©Áî®Ëµ∑Êù•fdisk &#x2F;dev&#x2F;sda Êêû‰∏™Êñ∞ÂàÜÂå∫  mkfs.ext4 &#x2F;dev&#x2F;sda3 Ê†ºÂºèÂåñÊñ∞ÂàÜÂå∫mount">
<meta property="og:type" content="article">
<meta property="og:title" content="Á£ÅÁõòÊåÇËΩΩÂàÜÂå∫">
<meta property="og:url" content="http://example.com/2024/10/09/%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Âú®Áî≥ËØ∑Êú∫Âô®Êó∂ÔºåÂàùÂßãÊú∫Âô®ÂΩìÊó∂Áî≥ËØ∑ÁöÑÁ£ÅÁõòÂ§ßÂ∞è‰∏éÂÆûÈôÖ‰∏çÁ¨¶ÔºåÈÄöËøáËßÇÂØüÊòØÁî≥ËØ∑ÁöÑÁ°¨ÁõòÈúÄË¶ÅÊâãÂä®ÊåÇËΩΩÔºå‰∫éÊòØ‰∫ÜËß£‰∏ãËøôÊñπÈù¢‰∏úË•ø  ÂèØ‰ª•ÁúãÂà∞Ê†πÁõÆÂΩïÊåÇËΩΩÁöÑÁ©∫Èó¥Â§ßÂ∞è‰∏∫50GÔºå‰ΩÜÊàëÁî≥ËØ∑ÁöÑÊòØ100GÔºåËøòÊúâ50GÁ©∫‰ΩôÊ≤°Âà©Áî®„ÄÇ ÂÖàlsblk Êü•Áúã‰∏ãÂΩìÂâçÂàÜÂå∫‰ø°ÊÅØ  ÊääÁ©∫‰ΩôÁöÑÂàÜÂå∫Á©∫Èó¥Âà©Áî®Ëµ∑Êù•fdisk &#x2F;dev&#x2F;sda Êêû‰∏™Êñ∞ÂàÜÂå∫  mkfs.ext4 &#x2F;dev&#x2F;sda3 Ê†ºÂºèÂåñÊñ∞ÂàÜÂå∫mount">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/132adbf626a746e1b00682dd424915b0.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/9ebb3e4f50d14911864944420704e553.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/direct/0b019f55f0954044b30f4a5366636bfe.png">
<meta property="article:published_time" content="2024-10-09T03:56:07.454Z">
<meta property="article:modified_time" content="2024-10-09T05:55:11.433Z">
<meta property="article:author" content="hatjwe">
<meta property="article:tag" content="linuxÂëΩ‰ª§">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i-blog.csdnimg.cn/direct/132adbf626a746e1b00682dd424915b0.png">


<link rel="icon" href="/img/avatar1.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.3.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar1.jpg"/>
</a>
<div class="author">
    <span>hatjwe</span>
</div>

<div class="icon">
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(3)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="‰∫ëÂéüÁîü">
            <i class="fold iconfont icon-right"></i>
            ‰∫ëÂéüÁîü
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="‰∫ëÂéüÁîü&lt;---&gt;RBAC">
            
            RBAC
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="‰∏ªÊú∫ÂÆâÂÖ®">
            <i class="fold iconfont icon-right"></i>
            ‰∏ªÊú∫ÂÆâÂÖ®
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="‰∏ªÊú∫ÂÆâÂÖ®&lt;---&gt;Capsule8">
            
            Capsule8
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="linuxËøêÁª¥">
            
            linuxËøêÁª¥
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="3">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="search shortcut key i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="switch to outline view shortcut key w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="return"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="case sensitive"></i>
            <i class="iconfont icon-tag" data-title="label"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">outline</div>
            <i class="iconfont icon-list" data-title="switch to article list"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Capsule8</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>linuxÂëΩ‰ª§</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>RBAC</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="All linuxËøêÁª¥ "
           href="/2024/10/09/%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/"
           data-tag="linuxÂëΩ‰ª§"
           data-author="" >
            <span class="post-title" title="Á£ÅÁõòÊåÇËΩΩÂàÜÂå∫">Á£ÅÁõòÊåÇËΩΩÂàÜÂå∫</span>
            <span class="post-date" title="2024-10-09 11:56:07">2024/10/09</span>
        </a>
        
        
        <a  class="All ‰∫ëÂéüÁîü RBAC "
           href="/2024/10/05/RBAC/"
           data-tag="RBAC"
           data-author="" >
            <span class="post-title" title="K8s‰πãRBAC">K8s‰πãRBAC</span>
            <span class="post-date" title="2024-10-05 21:49:22">2024/10/05</span>
        </a>
        
        
        <a  class="All ‰∏ªÊú∫ÂÆâÂÖ® Capsule8 "
           href="/2024/10/05/ecaplute8/"
           data-tag="Capsule8"
           data-author="" >
            <span class="post-title" title="Capsule8ÂàÜÊûê (‰∏Ä)">Capsule8ÂàÜÊûê (‰∏Ä)</span>
            <span class="post-date" title="2024-10-05 21:49:22">2024/10/05</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="Toggle full screen shortcut key s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-RBAC" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">K8s‰πãRBAC</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="‰∫ëÂéüÁîü">‰∫ëÂéüÁîü</a> > 
            
            <a  data-rel="‰∫ëÂéüÁîü&lt;---&gt;RBAC">RBAC</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color5">RBAC</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2024-10-05 21:55:57'>2024-10-05 21:49</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            Views üëÄ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#RBAC"><span class="toc-text">RBAC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7user"><span class="toc-text">Áî®Êà∑user</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-text">ÂàõÂª∫Áî®Êà∑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-CertificateSigningRequest"><span class="toc-text">ÂàõÂª∫ CertificateSigningRequest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%96%E5%BE%97%E8%AF%81%E4%B9%A6"><span class="toc-text">ÂèñÂæóËØÅ‰π¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%B0-kubeconfig"><span class="toc-text">Ê∑ªÂä†Âà∞ kubeconfig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RBAC%E6%9D%A5%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90"><span class="toc-text">RBACÊù•ÂàÜÈÖçÊùÉÈôê</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%92%E8%89%B2Role%E5%92%8CClusterRole"><span class="toc-text">ÂàõÂª∫ËßíËâ≤RoleÂíåClusterRole</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RoleBinding-%E5%92%8C-ClusterRoleBinding"><span class="toc-text">RoleBinding Âíå ClusterRoleBinding</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E5%88%92%E5%88%86"><span class="toc-text">ÊùÉÈôêÂàíÂàÜ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6%E6%96%B9%E6%B3%95"><span class="toc-text">ÊâãÂä®ÂàõÂª∫ËØÅ‰π¶ÊñπÊ≥ï</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7server-account"><span class="toc-text">ÂàõÂª∫Áî®Êà∑server account</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%92%E8%89%B2role%E5%92%8CroleBinding"><span class="toc-text">ËßíËâ≤roleÂíåroleBinding</span></a></li></ol></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="RBAC"><a href="#RBAC" class="headerlink" title="RBAC"></a>RBAC</h2><p>BACÊ®°Âûã(Role-Based Access Control:Âü∫‰∫éËßíËâ≤ÁöÑËÆøÈóÆÊéßÂà∂)Ôºåk8sÈõÜÁæ§‰∏≠ÁöÑË∫´‰ªΩÊúâ‰∏§ÁßçÔºöÁî®Êà∑ÔºàUserÔºâÂíåÊúçÂä°Ë¥¶Âè∑ÔºàService AccountÔºâÔºåÂÖ∂‰∏≠service accountÊòØk8s‰∏∫podÂÜÖÈÉ®ÁöÑËøõÁ®ãËÆøÈóÆapiserverÂàõÂª∫ÁöÑ‰∏ÄÁßçÁî®Êà∑„ÄÇÊàë‰ª¨ÂèØ‰ª•ÈÄöËøása‰∏≠ÁöÑtoken‰∏éapierverËøõË°åÈÄö‰ø°Ôºå‰πüÂèØ‰ª•Âü∫‰∫éÁî®Êà∑ÁöÑkubeconfig‰∏éapierverËøõË°åÈÄö‰ø°„ÄÇ</p>
<span id="more"></span>

<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/11.png" alt="img"></p>
<h3 id="Áî®Êà∑user"><a href="#Áî®Êà∑user" class="headerlink" title="Áî®Êà∑user"></a>Áî®Êà∑user</h3><p>ÂØπ‰∫éUserË¥¶Êà∑Ôºå‰∏ªË¶ÅÂàÜ‰∏∫Á≥ªÁªüÁÆ°ÁêÜÂëòË¥¶Êà∑ÂíåÊôÆÈÄöË¥¶Êà∑ÔºåÁ≥ªÁªüÁÆ°ÁêÜÂëòË¥¶Êà∑‰∏∫ÂàõÈÄ†ÈõÜÁæ§Êó∂Ëá™Â∏¶ÔºåÊùÉÈôêÂæàÈ´òÔºåÊôÆÈÄöË¥¶Êà∑‰πüÊòØÁî±Á≥ªÁªüÁÆ°ÁêÜÂëòË¥¶Êà∑ÂàõÂª∫Âπ∂Ëµã‰∫àÊúüÂØπÂ∫îÁöÑËÆøÈóÆÊìç‰ΩúÊùÉÈôê„ÄÇ</p>
<h3 id="ÂàõÂª∫Áî®Êà∑"><a href="#ÂàõÂª∫Áî®Êà∑" class="headerlink" title="ÂàõÂª∫Áî®Êà∑"></a>ÂàõÂª∫Áî®Êà∑</h3><p>ÂØπ‰∫éUserË¥¶Êà∑ÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÂàõÂª∫k8sÈõÜÁæ§Êó∂Ëá™Â∏¶ÁöÑËØÅ‰π¶ÂØπÊàë‰ª¨ÔºàadminÔºâÊùÉÈôêÔºàÂá†‰πéÔºâÊâãÂä®ÁÆ°ÁêÜmaster‰∏≠ÁöÑÂá≠ËØÅÊñá‰ª∂ÔºåÂπ∂‰∏îÂ∞ÜÊØè‰∏™Âá≠ËØÅÊñá‰ª∂Âíå‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÂØπÂ∫îËµ∑Êù•ÔºåÂè™Ë¶ÅÁî®Êà∑ËØ∑Ê±Ç‰∏≠Êúâ‰ø°ÊÅØÔºà‰∏ÄËà¨Êù•Ëá™Êú¨Âú∞‰øùÂ≠òÁöÑ.kube&#x2F;configÊñá‰ª∂‰∏≠ÔºâËÉΩÂ§üËØÅÊòéËá™Â∑±Êúâ‰ªªÊÑè‰∏Ä‰∏™Âá≠ËØÅÊñá‰ª∂ÁöÑÊéàÊùÉÔºåÈÇ£‰πàËøô‰∏™ËØ∑Ê±ÇÂ∞±Ë¢´ËÆ§‰∏∫ÊòØ‰∏Ä‰∏™ÂêàÊ≥ïÁî®Êà∑ÂèëÂá∫ÁöÑÔºåÂêåÊó∂ÔºåÂú®ËØÅ‰π¶‰∏≠ËøòÂèØ‰ª•Âä†ÂÖ•Áî®Êà∑ÊâÄÂú®ÁöÑÁªÑÔºàgroupÔºâÁöÑ‰ø°ÊÅØÔºåk8sÂèØ‰ª•ÊçÆÊ≠§ËÆ§‰∏∫userÂú®‰∏Ä‰∏™ÁªÑ‰∏≠ÊàñËÄÖÂêéÊúüÈÄöËøárolebindingÁ≠âËµã‰∫àÊìç‰ΩúÊùÉÈôê„ÄÇ</p>
<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/AFCB03E0-BB72-46f2-B417-FB0B7E3406AF.png" alt="img"><br>ÈÄöËøáCSRÂàõÂª∫‰∏∫‰æãÔºåÔºàÂèÇËÄÉÂÆòÊñπÊñáÊ°£<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/certificate-signing-requests%EF%BC%89">https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/certificate-signing-requestsÔºâ</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>ÁîüÊàê‰∏Ä‰∏™ <span class="number">2048</span> ‰ΩçÁöÑ morece.key Êñá‰ª∂</span><br><span class="line">openssl genrsa -out morece.key <span class="number">2048</span></span><br><span class="line"><span class="number">2.</span>Âú® morece.key Êñá‰ª∂ÁöÑÂü∫Á°Ä‰∏äÔºåÁîüÊàê morece.crt Êñá‰ª∂ÔºàÁî®ÂèÇÊï∞ -days ËÆæÁΩÆËØÅ‰π¶ÊúâÊïàÊúüÔºâ</span><br><span class="line">ËøôÈáåÊ≥®ÊÑè‰∏§‰∏™Â≠óÊÆµCommon NameËæìÂÖ•ÁöÑÊòØÁî®Êà∑Âêç„ÄÇ</span><br><span class="line">Organization Name ÊòØÁî®Êà∑ÁªÑÔºåÂ¶ÇÊûúÂÜôsystem:mastersÂàôÂΩíÂ±û‰∫éÁ≥ªÁªüÁªÑËé∑ÂèñÁ≥ªÁªüÁÆ°ÁêÜÊùÉÈôêÔºåËøôÂùóÂèØ‰ª•ÂÜô‰∏Ä‰∏™Êñ∞ÁöÑÔºåÂêéËæπÊàë‰ª¨ÈÄöËøároleÊàñclusterroleÊù•ÈôêÂà∂Ë¥¶Âè∑ÁöÑÊùÉÈôê„ÄÇ</span><br><span class="line">openssl req -<span class="built_in">new</span> -key morece.key -out morece.csr</span><br></pre></td></tr></table></figure>



<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/2.png" alt="img"></p>
<h4 id="ÂàõÂª∫-CertificateSigningRequest"><a href="#ÂàõÂª∫-CertificateSigningRequest" class="headerlink" title="ÂàõÂª∫ CertificateSigningRequest"></a>ÂàõÂª∫ CertificateSigningRequest</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: certificates.k8s.io/v1</span><br><span class="line">kind: CertificateSigningRequest</span><br><span class="line">metadata:</span><br><span class="line">  name: morece</span><br><span class="line">spec:</span><br><span class="line">  request: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ2p6Q0NBWGNDQVFBd1NqRUxNQWtHQTFVRUJoTUNRMDR4RlRBVEJnTlZCQWNNREVSbFptRjFiSFFnUTJsMAplVEVUTUJFR0ExVUVDZ3dLYTNWaVpYSnVaWFJsY3pFUE1BMEdBMVVFQXd3R2JXOXlaV05sTUlJQklqQU5CZ2txCmhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBd2hwOFh6Q2NLL2RJb1Y2aXJ0ZnVyeDN4MGU5Z1Z3Y1IKalNpUG1UVkcvc1ltUmhDbmd0djhOWldlanNjN2dDU1g2OEhDbW9kTk0yOGFYc3d0QnpnU2xQZk5HLytRZHUrVgpCQXF3YUtGS0xSeS9JQ2hON2hBaHo3MzNacFRDYTdlbktxUjlMZ285S1pwV2EzUFh1em4rZVZKNnpFTlpkN0FKCldzbVZ4MWZwejVLVmxWZXVQbUk3aW1JMHp5T29CVUVGVXB0ZStyTWlMMFRZTEpidmdab3ZZeXMwcTd2bCtpVm4KTkdzUkZ2RmY4eWVvUE5jS0pVWHZLWkp0TDRqaWJaUnptNitFd1RwR0tPbGw1b0JVUzhxdDdIb3VoaE92NmZlcgp1SGdwQ1RCbSsxbW9wTnUzMklZbmd6U1ZWUlFKR1FxbEVqRkFtQUNrVmNyOGU1L2hQMTBGWndJREFRQUJvQUF3CkRRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFIZW1jcVhEVFo0bnc0OUovdGRDRlJzYU4zMkdhT0J0aVo0alVQVE8KZGhRUjN5MDliQk1IYmJiSktjMCtlMnJGcll4aUFmMS8yV00rTmI3U1VhNGQzSWZFYlY2VzJuY1c3MTljTWFqZAovbjFPVVJzTWNuaUpRWGlwS3ZFUXpETzlJMmRQSHI2emNjOFBsVnJheXVsait6MlNuUE5HVzJwSzBUdWkzSTFCCkhEOXdBbWluNHlYWXlsK2p5dDFuV3Fsd05teWpqbVNYL2pwYmRsSldiYlRXT1RoMkczT1g5M0ltTW8vUUtnVXkKenJhQTB4RFJZS0dPSGlZOEVRL1RITWtyTGpDdi8raDdZZ1pWYTBIZ3hoczNCTmVvS2JTYTBsb01iRnhCNFl0eAo4TEdaa1Rtc0JsVUFhU3RmVFhQa0lnUVBlR3IrTFMzY2RTbjVEaUhRNVBzZmw1OD0KLS0tLS1FTkQgQ0VSVElGSUNBVEUgUkVRVUVTVC0tLS0tCg==</span><br><span class="line">  signerName: kubernetes.io/kube-apiserver-client</span><br><span class="line">  expirationSeconds: <span class="number">86400</span>  # one day</span><br><span class="line">  usages:</span><br><span class="line">  - client auth</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>usage</code> Â≠óÊÆµÂøÖÈ°ªÊòØ ‚Äò<code>client auth</code>‚Äò</p>
</li>
<li><p><code>expirationSeconds</code> ÂèØ‰ª•ËÆæÁΩÆ‰∏∫Êõ¥ÈïøÔºà‰æãÂ¶Ç <code>864000</code> ÊòØÂçÅÂ§©ÔºâÊàñËÄÖÊõ¥Áü≠Ôºà‰æãÂ¶Ç <code>3600</code> ÊòØ‰∏Ä‰∏™Â∞èÊó∂Ôºâ</p>
</li>
<li><p><code>request</code> Â≠óÊÆµÊòØ CSR Êñá‰ª∂ÂÜÖÂÆπÁöÑ base64 ÁºñÁ†ÅÂÄº„ÄÇ Ë¶ÅÂæóÂà∞ËØ•ÂÄºÔºåÂèØ‰ª•ÊâßË°åÂëΩ‰ª§</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat morece.csr | base64 | tr -d <span class="string">&quot;\n&quot;</span></span><br></pre></td></tr></table></figure>

<p>ÊâπÂáÜËØÅ‰π¶kubectl certificate approve morece</p>
</li>
</ul>
<h4 id="ÂèñÂæóËØÅ‰π¶"><a href="#ÂèñÂæóËØÅ‰π¶" class="headerlink" title="ÂèñÂæóËØÅ‰π¶"></a>ÂèñÂæóËØÅ‰π¶</h4><p>‰ªé CSR ÂèñÂæóËØÅ‰π¶Ôºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get csr/morece -o yaml</span><br></pre></td></tr></table></figure>

<p>ËØÅ‰π¶ÁöÑÂÜÖÂÆπ‰ΩøÁî® base64 ÁºñÁ†ÅÔºåÂ≠òÊîæÂú®Â≠óÊÆµ <code>status.certificate</code>„ÄÇ</p>
<p>‰ªé CertificateSigningRequest ÂØºÂá∫È¢ÅÂèëÁöÑËØÅ‰π¶„ÄÇ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get csr morece -o jsonpath=&#x27;&#123;.status.certificate&#125;&#x27;| base64 -d &gt; morece.crt</span><br></pre></td></tr></table></figure>

<h4 id="Ê∑ªÂä†Âà∞-kubeconfig"><a href="#Ê∑ªÂä†Âà∞-kubeconfig" class="headerlink" title="Ê∑ªÂä†Âà∞ kubeconfig"></a>Ê∑ªÂä†Âà∞ kubeconfig</h4><p>ÊúÄÂêé‰∏ÄÊ≠•ÊòØÂ∞ÜËøô‰∏™Áî®Êà∑Ê∑ªÂä†Âà∞ kubeconfig Êñá‰ª∂„ÄÇ</p>
<p>È¶ñÂÖàÔºå‰Ω†ÈúÄË¶ÅÊ∑ªÂä†Êñ∞ÁöÑÂá≠ÊçÆÔºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config set-credentials morece --client-key=morece.key --client-certificate=morece.crt --embed-certs=true</span><br></pre></td></tr></table></figure>

<p>ÁÑ∂ÂêéÔºå‰Ω†ÈúÄË¶ÅÊ∑ªÂä†‰∏ä‰∏ãÊñáÔºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config set-context morece --cluster=kubernetes --user=morece</span><br></pre></td></tr></table></figure>
<p>ËøôÈáå‰πüÊé®Ëçê‰∏™Â∑•ÂÖ∑ÁúãÁî®Êà∑,ÂàáÊç¢contextÂæàÊñπ‰æø<a target="_blank" rel="noopener" href="https://github.com/sunny0826/kubecm.git">https://github.com/sunny0826/kubecm.git</a></p>
<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/4.png" alt="img"><br>Êù•ÊµãËØï‰∏Ä‰∏ãÔºåÊää‰∏ä‰∏ãÊñáÂàáÊç¢‰∏∫ <code> morece</code>Ôºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context morece</span><br></pre></td></tr></table></figure>

<p>ËøôÈáåÂèØ‰ª•ÁúãÂà∞Êä•Èîô‰∫ÜÔºåÈîôËØØÂéüÂõ†ÊòØmoreÊµãÁî®Êà∑Âπ∂Ê≤°ÊúâÊùÉÈôêÂéªËÆøÈóÆdefaultÁ©∫Èó¥‰∏ãÁöÑpodÔºåËøôÊó∂ÂÄôÂ∞±Ë¶ÅÂºïÂÖ•RBACÊù•ÂàÜÈÖçÊùÉÈôê‰∫Ü</p>
<h4 id="RBACÊù•ÂàÜÈÖçÊùÉÈôê"><a href="#RBACÊù•ÂàÜÈÖçÊùÉÈôê" class="headerlink" title="RBACÊù•ÂàÜÈÖçÊùÉÈôê"></a>RBACÊù•ÂàÜÈÖçÊùÉÈôê</h4><p>RBAC API Â£∞Êòé‰∫ÜÂõõÁßç Kubernetes ÂØπË±°Ôºö<strong>Role</strong>„ÄÅ<strong>ClusterRole</strong>„ÄÅ<strong>RoleBinding</strong> Âíå <strong>ClusterRoleBinding</strong>„ÄÇ</p>
<h3 id="ÂàõÂª∫ËßíËâ≤RoleÂíåClusterRole"><a href="#ÂàõÂª∫ËßíËâ≤RoleÂíåClusterRole" class="headerlink" title="ÂàõÂª∫ËßíËâ≤RoleÂíåClusterRole"></a>ÂàõÂª∫ËßíËâ≤RoleÂíåClusterRole</h3><p>Role ÊÄªÊòØÁî®Êù•Âú®Êüê‰∏™<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/namespaces/">ÂêçÂ≠óÁ©∫Èó¥</a>ÂÜÖËÆæÁΩÆËÆøÈóÆÊùÉÈôêÔºõ Âú®‰Ω†ÂàõÂª∫ Role Êó∂Ôºå‰Ω†ÂøÖÈ°ªÊåáÂÆöËØ• Role ÊâÄÂ±ûÁöÑÂêçÂ≠óÁ©∫Èó¥„ÄÇ</p>
<p>‰∏é‰πãÁõ∏ÂØπÔºåClusterRole ÂàôÊòØ‰∏Ä‰∏™ÈõÜÁæ§‰ΩúÁî®ÂüüÁöÑËµÑÊ∫ê</p>
<p>Êé•‰∏ãÊù•ÂàõÂª∫‰∏™ËØªÂèñdefault podÁöÑÊùÉÈôê(Ê≥®ÊÑèË¶ÅÂàáÊç¢‰∏∫ÁÆ°ÁêÜÂëòcontextÂÜçËøõË°åËµÑÊ∫êÂàõÂª∫)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: Role</span><br><span class="line">metadata:</span><br><span class="line">  namespace: <span class="keyword">default</span></span><br><span class="line">  name: morecepod-reader</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [<span class="string">&quot;&quot;</span>] # <span class="string">&quot;&quot;</span> Ê†áÊòé core API ÁªÑ</span><br><span class="line">  resources: [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  verbs: [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]<span class="comment">//ÂÖÅËÆ∏ÁöÑÊìç‰ΩúË°å‰∏∫</span></span><br><span class="line"><span class="comment">//getÂíålistÂå∫Âà´Âú®‰∫éÂ¶ÇÊûúÊòØgetÂèØ‰ª•Êü•ÁúãËØ¶ÊÉÖkubectl describeËøôÂú®secretÊó∂Ëé∑ÂèñËØ¶ÊÉÖ‰∏≠ÁöÑtokenÂæàÂ•ΩÁî®ÔºålistÂè™ËÉΩËé∑ÂèñÂàóË°®‰∏çËÉΩÊü•ÁúãËØ¶ÊÉÖ</span></span><br></pre></td></tr></table></figure>
<h4 id="RoleBinding-Âíå-ClusterRoleBinding"><a href="#RoleBinding-Âíå-ClusterRoleBinding" class="headerlink" title="RoleBinding Âíå ClusterRoleBinding"></a><strong>RoleBinding</strong> Âíå <strong>ClusterRoleBinding</strong></h4><p>ÁÆÄÂçïÊù•ËØ¥<strong>RoleBinding</strong> Âíå <strong>ClusterRoleBinding</strong>Â∞±ÊòØÂ∞ÜRoleÂíåClusterRoleËßÑÂàô‰ΩúÁî®ÊïàÊûúÁªëÂÆöÂà∞Áî®Êà∑ÊàñserveraccountÔºå‰ΩøÂÖ∂Êã•Êúâ‰∏éRoleÂíåClusterRole‰∏ÄÊ†∑ÁöÑÊùÉÈôê„ÄÇ</p>
<p>‰∏Ä‰∏™ RoleBinding ÂèØ‰ª•ÂºïÁî®Âêå‰∏ÄÁöÑÂêçÂ≠óÁ©∫Èó¥‰∏≠ÁöÑ‰ªª‰Ωï Role„ÄÇ ÊàñËÄÖÔºå‰∏Ä‰∏™ RoleBinding ÂèØ‰ª•ÂºïÁî®Êüê ClusterRole Âπ∂Â∞ÜËØ• ClusterRole ÁªëÂÆöÂà∞ RoleBinding ÊâÄÂú®ÁöÑÂêçÂ≠óÁ©∫Èó¥„ÄÇ Â¶ÇÊûú‰Ω†Â∏åÊúõÂ∞ÜÊüê ClusterRole ÁªëÂÆöÂà∞ÈõÜÁæ§‰∏≠ÊâÄÊúâÂêçÂ≠óÁ©∫Èó¥Ôºå‰Ω†Ë¶Å‰ΩøÁî® ClusterRoleBinding„ÄÇ</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line"># Ê≠§ËßíËâ≤ÁªëÂÆöÂÖÅËÆ∏ <span class="string">&quot;jane&quot;</span> ËØªÂèñ <span class="string">&quot;default&quot;</span> ÂêçÂ≠óÁ©∫Èó¥‰∏≠ÁöÑ Pod</span><br><span class="line"># ‰Ω†ÈúÄË¶ÅÂú®ËØ•ÂëΩÂêçÁ©∫Èó¥‰∏≠Êúâ‰∏Ä‰∏™Âêç‰∏∫ ‚Äúpod-reader‚Äù ÁöÑ Role</span><br><span class="line">kind: RoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: moreceread-pods</span><br><span class="line">  namespace: <span class="keyword">default</span></span><br><span class="line">subjects:</span><br><span class="line"># ‰Ω†ÂèØ‰ª•ÊåáÂÆö‰∏çÊ≠¢‰∏Ä‰∏™‚ÄúsubjectÔºà‰∏ª‰ΩìÔºâ‚Äù</span><br><span class="line">- kind: User</span><br><span class="line">  name: morece # <span class="string">&quot;morece&quot;</span> ÊòØÂå∫ÂàÜÂ§ßÂ∞èÂÜôÁöÑ</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">roleRef:</span><br><span class="line">  # <span class="string">&quot;roleRef&quot;</span> ÊåáÂÆö‰∏éÊüê Role Êàñ ClusterRole ÁöÑÁªëÂÆöÂÖ≥Á≥ª</span><br><span class="line">  kind: Role        # Ê≠§Â≠óÊÆµÂøÖÈ°ªÊòØ Role Êàñ ClusterRole</span><br><span class="line">  name: morecepod-reader  # Ê≠§Â≠óÊÆµÂøÖÈ°ª‰∏é‰Ω†Ë¶ÅÁªëÂÆöÁöÑ Role Êàñ ClusterRole ÁöÑÂêçÁß∞ÂåπÈÖç</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br></pre></td></tr></table></figure>

<p>ÁÑ∂ÂêéÂÜçÊää‰∏ä‰∏ãÊñáÂàáÊç¢‰∏∫ <code> morece</code>Áúã‰∏ãdefaultÁ©∫Èó¥‰∏ãpodÂèØ‰ª•‰∫ÜÔºö</p>
<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/5.png" alt="img"></p>
<h3 id="ÊùÉÈôêÂàíÂàÜ"><a href="#ÊùÉÈôêÂàíÂàÜ" class="headerlink" title="ÊùÉÈôêÂàíÂàÜ"></a>ÊùÉÈôêÂàíÂàÜ</h3><p>RoleÂíåClusterRoleÁöÑÊùÉÈôêÊéßÂà∂‰∏ªË¶ÅÈÄöËøárules‰∏ãÂ≠óÊÆµ<br>apiGroupsÔºöËÆæÂÆöËµÑÊ∫êÁªÑ‚Äù‚Äù Ê†áÊòé core API ÁªÑÔºå‚Äù<em>‚Äú Ê†áÊòéÊâÄÊúâÁªÑ<br>resourceÂÜÖÂÆπ‰∏∫Â∏∏ËßÅËµÑÊ∫êÁ±ªÔºàcrontabs„ÄÅjobs„ÄÅpods„ÄÅpods&#x2F;log„ÄÅconfigmaps„ÄÅdeploymentsÁ≠âÔºâ<br>ÂêåÊó∂‰πüÊîØÊåÅnonResourceURLsÈÄöËøáapi urlÂä†ËΩΩ<br>nonResourceURLs: [‚Äú&#x2F;healthz‚Äù, ‚Äú&#x2F;healthz&#x2F;</em>‚Äú] # nonResourceURL ‰∏≠ÁöÑ ‚Äò*‚Äô ÊòØ‰∏Ä‰∏™ÂÖ®Â±ÄÈÄöÈÖçÁ¨¶</p>
<p>verbs‰∏ªË¶ÅÊéßÂà∂ÂØπËµÑÊ∫êÁöÑË°å‰∏∫[‚Äúget‚Äù, ‚Äúlist‚Äù, ‚Äúwatch‚Äù, ‚Äúcreate‚Äù, ‚Äúupdate‚Äù, ‚Äúpatch‚Äù, ‚Äúdelete‚Äù]</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: Role</span><br><span class="line">metadata:</span><br><span class="line">  namespace: <span class="keyword">default</span></span><br><span class="line">  name: morecepod-reader</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [<span class="string">&quot;&quot;</span>] # <span class="string">&quot;&quot;</span> Ê†áÊòé core API ÁªÑ</span><br><span class="line">  resources: [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  verbs: [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]<span class="comment">//ÂÖÅËÆ∏ÁöÑÊìç‰ΩúË°å‰∏∫</span></span><br><span class="line"><span class="comment">//getÂíålistÂå∫Âà´Âú®‰∫éÂ¶ÇÊûúÊòØgetÂèØ‰ª•Êü•ÁúãËØ¶ÊÉÖkubectl describeËøôÂú®secretÊó∂Ëé∑ÂèñËØ¶ÊÉÖ‰∏≠ÁöÑtokenÂæàÂ•ΩÁî®ÔºålistÂè™ËÉΩËé∑ÂèñÂàóË°®‰∏çËÉΩÊü•ÁúãËØ¶ÊÉÖ</span></span><br></pre></td></tr></table></figure>



<h4 id="ÊâãÂä®ÂàõÂª∫ËØÅ‰π¶ÊñπÊ≥ï"><a href="#ÊâãÂä®ÂàõÂª∫ËØÅ‰π¶ÊñπÊ≥ï" class="headerlink" title="ÊâãÂä®ÂàõÂª∫ËØÅ‰π¶ÊñπÊ≥ï"></a>ÊâãÂä®ÂàõÂª∫ËØÅ‰π¶ÊñπÊ≥ï</h4><p>Âà©Áî®ÊâãÂä®ÂàõÂª∫ËØÅ‰π¶ÂàõÂª∫Áî®Êà∑ÔºåÂâçÈù¢ÁîüÊàêÂØÜÈí•ÈÉ®ÂàÜÈÉΩÁõ∏ÂêåÔºå‰ΩÜÊòØÁ≠æÂêçÈÄöËøáÂà©Áî®ÈõÜÁæ§‰∏≠CAËá™Â∏¶ÁöÑCAËØÅ‰π¶ËøõË°åÁ≠æÂêçÂç≥ÂèØ„ÄÇËØ¶ÁªÜÂú®<a target="_blank" rel="noopener" href="http://blog.itpub.net/69955379/viewspace-2778141">http://blog.itpub.net/69955379/viewspace-2778141</a></p>
<h3 id="ÂàõÂª∫Áî®Êà∑server-account"><a href="#ÂàõÂª∫Áî®Êà∑server-account" class="headerlink" title="ÂàõÂª∫Áî®Êà∑server account"></a>ÂàõÂª∫Áî®Êà∑server account</h3><p>ÊúçÂä°Ë¥¶Âè∑ÂØπË±°‰∏ª‰ΩìÊõ¥Â§ö‰∏∫pod,ÊØîÂ¶ÇÂΩìÊúâpodÈúÄË¶ÅËøêË°åÊó∂ÔºåÂøÖÈ°ª‰ª•‰∏Ä‰∏™service accountÁöÑË∫´‰ªΩÂéªËøêË°å‰ªñ„ÄÇ‰∏Ä‰∏™pod‰∏çÈúÄË¶ÅÂå∫ÂàÜÊòØÈÇ£‰∏™Áî®Êà∑ÁöÑÔºåÂè™ÈúÄË¶ÅÂØπservice accountÊùÉÈôêËøõË°åÊéßÂà∂Âç≥ÂèØ„ÄÇ</p>
<p>Êàë‰ª¨Âú®ÂàõÂª∫ Pod Êó∂ÔºåÂ¶ÇÊûúÊ≤°ÊúâÊåáÂÆöÊúçÂä°Ë¥¶Âè∑ÔºåPod ‰ºöË¢´ÊåáÂÆöÁªôÂëΩÂêçÁ©∫Èó¥‰∏≠ÁöÑ <code>default</code> ÊúçÂä°Ë¥¶Âè∑„ÄÇ</p>
<h4 id="ËßíËâ≤roleÂíåroleBinding"><a href="#ËßíËâ≤roleÂíåroleBinding" class="headerlink" title="ËßíËâ≤roleÂíåroleBinding"></a>ËßíËâ≤roleÂíåroleBinding</h4><p>‰∏ãÈù¢Êàë‰ª¨Âú®namespace‰∏∫ceshi‰∏ãÂàõÂª∫‰∏Ä‰∏™service account,Êé•ÁùÄÂú®pod‰∏≠‰ΩøÁî®Ëøô‰∏™Ë¥¶Êà∑</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kubectl create serviceaccount morece -n ceshi <span class="comment">//ÂàõÂª∫sa</span></span><br><span class="line">ÊåÇËΩΩsaËµ∑pod</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: morecewithsa</span><br><span class="line">  namespace: ceshi</span><br><span class="line">spec:</span><br><span class="line">  serviceAccount: morece</span><br><span class="line">  containers:</span><br><span class="line">    - name: morece</span><br><span class="line">      image: nginx</span><br><span class="line">      imagePullPolicy: IfNotPresent </span><br><span class="line">Â∞Ükubectl cpËøõÂéªÊµãËØïÁî®</span><br><span class="line">kubectl cp /usr/bin/kubectl ceshi/morecewithsa:/</span><br><span class="line">find / -name <span class="string">&quot;*token&quot;</span>Êâæ‰∏Ä‰∏ãpodÈáåÊåÇËΩΩÁöÑtoken,‰πüÂèØ‰ª•Áõ¥Êé•Áî®kubectl</span><br><span class="line">kubectl get pod</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/7.png" alt="img"></p>
<p>ÂèØ‰ª•ÁúãÂà∞Êàë‰ª¨ÂÖâÊòØÂàõÂª∫‰∏Ä‰∏™service account,Âú®podÂÜÖÊòØÊ≤°‰ªÄ‰πàÊùÉÈôêÁöÑÔºåÁé∞Âú®ÂàõÂª∫‰∏™roleÔºåÈÄöËøárolebindingÁªëÂÆöÂú®Êàë‰ª¨ÁöÑsa‰∏ä</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: Role</span><br><span class="line">metadata:</span><br><span class="line">  namespace: ceshi</span><br><span class="line">  name: morecepod-create</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [<span class="string">&quot;*&quot;</span>]</span><br><span class="line">  # Âú® HTTP Â±ÇÈù¢ÔºåÁî®Êù•ËÆøÈóÆ Secret ËµÑÊ∫êÁöÑÂêçÁß∞‰∏∫ <span class="string">&quot;secrets&quot;</span></span><br><span class="line">  resources: [<span class="string">&quot;secrets&quot;</span>,<span class="string">&quot;pods&quot;</span>,<span class="string">&quot;nodes&quot;</span>,<span class="string">&quot;services&quot;</span>]</span><br><span class="line">  verbs: [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>,<span class="string">&quot;create&quot;</span>]</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line"># Ê≠§ËßíËâ≤ÁªëÂÆöÂÖÅËÆ∏ service account ËØªÂèñ <span class="string">&quot;ceshi&quot;</span> ÂêçÂ≠óÁ©∫Èó¥‰∏≠ÁöÑ Pod</span><br><span class="line"># ‰Ω†ÈúÄË¶ÅÂú®ËØ•ÂëΩÂêçÁ©∫Èó¥‰∏≠Êúâ‰∏Ä‰∏™Âêç‰∏∫ ‚Äúmorecepod-create‚Äù ÁöÑ Role</span><br><span class="line">kind: RoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: morececreate-pods</span><br><span class="line">  namespace: ceshi</span><br><span class="line">subjects:</span><br><span class="line"># ‰Ω†ÂèØ‰ª•ÊåáÂÆö‰∏çÊ≠¢‰∏Ä‰∏™‚ÄúsubjectÔºà‰∏ª‰ΩìÔºâ‚Äù</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: morece # <span class="string">&quot;morece&quot;</span> ÊòØÂå∫ÂàÜÂ§ßÂ∞èÂÜôÁöÑ</span><br><span class="line">roleRef:</span><br><span class="line">  # <span class="string">&quot;roleRef&quot;</span> ÊåáÂÆö‰∏éÊüê Role Êàñ ClusterRole ÁöÑÁªëÂÆöÂÖ≥Á≥ª</span><br><span class="line">  kind: Role        # Ê≠§Â≠óÊÆµÂøÖÈ°ªÊòØ Role Êàñ ClusterRole</span><br><span class="line">  name: morecepod-create  # Ê≠§Â≠óÊÆµÂøÖÈ°ª‰∏é‰Ω†Ë¶ÅÁªëÂÆöÁöÑ Role Êàñ ClusterRole ÁöÑÂêçÁß∞ÂåπÈÖç</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>Âú®ÈáåËæπËØïËØïÂàõÂª∫‰∏™pod,ÂèØ‰ª•‰∫Ü</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | ./kubectl apply -f -</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: createinmorecewithsa</span><br><span class="line">  namespace: ceshi</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">    - name: createinmorecewithsacon</span><br><span class="line">      image: nginx</span><br><span class="line">      imagePullPolicy: IfNotPresent  </span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/8.png?Expires=1676567430&OSSAccessKeyId=TMP.3Kk4pSrSmBFm96NfgY6GZKm1qhse1DffMaig8NhGPYR9RcQ4j74QAFhCvmGWDyXkr2E7wtHv71FS2rrVZhzZTQXAJUXuCo&Signature=iOG9FI4viDa8002eio23AIw0dw0=" alt="img"></p>
<p>Êàë‰ª¨ÂÜçËØïËØïÂú®Âà´ÁöÑÂëΩÂêçÁ©∫Èó¥ÂàõÂª∫podÔºåÂ§±Ë¥•‰∫Ü„ÄÇ‰∫éÊòØÁé∞Âú®ÂàõÂª∫‰∏™clusterroleÔºåÈÄöËøáclusterrolebindingÁªëÂÆöÂú®Êàë‰ª¨ÁöÑsa‰∏ä</p>
<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/9.png" alt="img"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  # <span class="string">&quot;namespace&quot;</span> Ë¢´ÂøΩÁï•ÔºåÂõ†‰∏∫ ClusterRoles ‰∏çÂèóÂêçÂ≠óÁ©∫Èó¥ÈôêÂà∂</span><br><span class="line">  name: pod-create</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [<span class="string">&quot;*&quot;</span>]</span><br><span class="line">  # Âú® HTTP Â±ÇÈù¢ÔºåÁî®Êù•ËÆøÈóÆ Secret ËµÑÊ∫êÁöÑÂêçÁß∞‰∏∫ <span class="string">&quot;secrets&quot;</span></span><br><span class="line">  resources: [<span class="string">&quot;secrets&quot;</span>,<span class="string">&quot;pods&quot;</span>,<span class="string">&quot;nodes&quot;</span>,<span class="string">&quot;services&quot;</span>]</span><br><span class="line">  verbs: [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>,<span class="string">&quot;create&quot;</span>]</span><br><span class="line">EOF</span><br><span class="line">  cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line"># Ê≠§ÈõÜÁæ§ËßíËâ≤ÁªëÂÆöÂÖÅËÆ∏ ‚Äúmanager‚Äù ÁªÑ‰∏≠ÁöÑ‰ªª‰Ωï‰∫∫ËÆøÈóÆ‰ªª‰ΩïÂêçÂ≠óÁ©∫Èó¥‰∏≠ÁöÑ Secret ËµÑÊ∫ê</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: create-pod-glob</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  namespace: ceshi</span><br><span class="line">  name: morece      # <span class="string">&#x27;name&#x27;</span> ÊòØÂå∫ÂàÜÂ§ßÂ∞èÂÜôÁöÑ</span><br><span class="line">roleRef:</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: pod-create</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>


      
       <hr><span style="font-style: italic;color: gray;"> ËΩ¨ËΩΩËØ∑Ê≥®ÊòéÊù•Ê∫ê. </span>
    </div>
</article>







    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ¬©2022-2024
</p>


    </div>
    <div class="full-toc">
        <button class="full" data-title="Toggle full screen shortcut key s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*Ê∏≤ÊüìÂØπÂ∫îÁöÑË°®Ê†ºÊ†∑Âºè*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*Ê∏≤ÊüìÊâìËµèÊ†∑Âºè*/
        

        /*È´ò‰∫Æ‰ª£Á†ÅÂùóË°åÂè∑*/
        

        /*ËÆøÈóÆÊï∞Èáè*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*‰ª£Á†ÅÈ´ò‰∫ÆÔºåË°åÂè∑ÂØπÈΩê*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*ÊâìËµèÈ°µÈù¢ÈöêËóè‰∏éÂ±ïÁ§∫*/
    

</script>

<!--Âä†ÂÖ•Ë°åÂè∑ÁöÑÈ´ò‰∫Æ‰ª£Á†ÅÂùóÊ†∑Âºè-->

<!--Ëá™ÂÆö‰πâÊ†∑ÂºèËÆæÁΩÆ-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*ÂàóË°®Ê†∑Âºè*/
    

    /* ËÉåÊôØÂõæÊ†∑Âºè */
    
    


    /*ÂºïÁî®ÂùóÊ†∑Âºè*/
    

    /*ÊñáÁ´†ÂàóË°®ËÉåÊôØÂõæ*/
    

    
</style>







</html>
