<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>k8sæ—¥å¿—å®¡è®¡è°ƒç ” | Hexo</title>
  <meta name="keywords" content=" æ—¥å¿—å®¡è®¡ ">
  <meta name="description" content="k8sæ—¥å¿—å®¡è®¡è°ƒç ” | Hexo">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="æœ€è¿‘åœ¨å®‰å…¨å¹³å°å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¸Œæœ›ä½¿å¼€å‘æµç¨‹æ›´åŠ è§„èŒƒå’Œè‡ªåŠ¨åŒ–ã€‚äºæ˜¯äº†è§£äº†ä¸‹CI&#x2F;CDç›¸å…³çŸ¥è¯†ã€‚ CI&#x2F;CD Pipelineç®€å•ä»‹ç»ä¸‹CI&#x2F;CD Pipelineï¼Œæåˆ°DevOpsï¼Œå¾ˆå¤šäººå°±æƒ³åˆ°äº†CI&#x2F;CD Pipelineï¼Œç”šè‡³å¾ˆå¤šä¸ªäººæˆ–è€…ä¼ä¸šè®¤ä¸ºå®Œæˆäº†CI&#x2F;CD Pipelineå°±ç­‰äºå®ç°äº†DevOpsã€‚Pipeline æŒ‡ç®¡é“æˆ–è€…æµæ°´çº¿ï¼Œç±»ä¼¼äºå·¥">
<meta property="og:type" content="article">
<meta property="og:title" content="DevOpså®è·µ-gitlab CIé›†æˆ">
<meta property="og:url" content="http://example.com/2024/11/19/DevOps%E5%AE%9E%E8%B7%B5-CI/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="æœ€è¿‘åœ¨å®‰å…¨å¹³å°å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¸Œæœ›ä½¿å¼€å‘æµç¨‹æ›´åŠ è§„èŒƒå’Œè‡ªåŠ¨åŒ–ã€‚äºæ˜¯äº†è§£äº†ä¸‹CI&#x2F;CDç›¸å…³çŸ¥è¯†ã€‚ CI&#x2F;CD Pipelineç®€å•ä»‹ç»ä¸‹CI&#x2F;CD Pipelineï¼Œæåˆ°DevOpsï¼Œå¾ˆå¤šäººå°±æƒ³åˆ°äº†CI&#x2F;CD Pipelineï¼Œç”šè‡³å¾ˆå¤šä¸ªäººæˆ–è€…ä¼ä¸šè®¤ä¸ºå®Œæˆäº†CI&#x2F;CD Pipelineå°±ç­‰äºå®ç°äº†DevOpsã€‚Pipeline æŒ‡ç®¡é“æˆ–è€…æµæ°´çº¿ï¼Œç±»ä¼¼äºå·¥">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/11-19-1.png">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/11-19-2.jpg">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/11-19-5.jpg">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/11-19-7.jpg">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/11-19-9.png">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/11-19-11.png">
<meta property="article:published_time" content="2024-11-19T03:29:00.386Z">
<meta property="article:modified_time" content="2024-11-19T06:11:31.833Z">
<meta property="article:author" content="hatjwe">
<meta property="article:tag" content="CI&#x2F;CDå·¥å…·">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/11-19-1.png">


<link rel="icon" href="/img/avatar1.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.3.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar1.jpg"/>
</a>
<div class="author">
    <span>hatjwe</span>
</div>

<div class="icon">
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(7)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="äº‘åŸç”Ÿ">
            <i class="fold iconfont icon-right"></i>
            äº‘åŸç”Ÿ
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="äº‘åŸç”Ÿ&lt;---&gt;k8s">
            
            k8s
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="äº‘åŸç”Ÿ&lt;---&gt;RBAC">
            
            RBAC
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="ä¸»æœºå®‰å…¨">
            <i class="fold iconfont icon-right"></i>
            ä¸»æœºå®‰å…¨
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="ä¸»æœºå®‰å…¨&lt;---&gt;Capsule8">
            
            Capsule8
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="DevOps">
            
            DevOps
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="linuxè¿ç»´">
            
            linuxè¿ç»´
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="7">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="search shortcut key i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="switch to outline view shortcut key w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="return"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="case sensitive"></i>
            <i class="iconfont icon-tag" data-title="label"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">outline</div>
            <i class="iconfont icon-list" data-title="switch to article list"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æ—¥å¿—å®¡è®¡</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Capsule8</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>CI/CDå·¥å…·</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>linuxå‘½ä»¤</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>RBAC</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="All DevOps "
           href="/2024/11/19/DevOps%E5%AE%9E%E8%B7%B5-CI/"
           data-tag="CI/CDå·¥å…·"
           data-author="" >
            <span class="post-title" title="DevOpså®è·µ-gitlab CIé›†æˆ">DevOpså®è·µ-gitlab CIé›†æˆ</span>
            <span class="post-date" title="2024-11-19 11:29:00">2024/11/19</span>
        </a>
        
        
        <a  class="All "
           href="/2024/11/18/Redis%E9%98%9F%E5%88%97%E6%A8%A1%E5%BC%8F/"
           data-tag=""
           data-author="" >
            <span class="post-title" title=""></span>
            <span class="post-date" title="2024-11-18 10:30:26">2024/11/18</span>
        </a>
        
        
        <a  class="All DevOps "
           href="/2024/11/06/DevOps%E5%AE%9E%E8%B7%B5/"
           data-tag="CI/CDå·¥å…·"
           data-author="" >
            <span class="post-title" title="DevOpså®è·µ-Watchtowerä¸€é”®å…¨è‡ªåŠ¨çš„watchtower">DevOpså®è·µ-Watchtowerä¸€é”®å…¨è‡ªåŠ¨çš„watchtower</span>
            <span class="post-date" title="2024-11-06 17:03:02">2024/11/06</span>
        </a>
        
        
        <a  class="All äº‘åŸç”Ÿ k8s "
           href="/2024/10/12/K8s%E6%97%A5%E5%BF%97%E5%AE%A1%E8%AE%A1%E8%B0%83%E7%A0%94/"
           data-tag="æ—¥å¿—å®¡è®¡"
           data-author="" >
            <span class="post-title" title="k8sæ—¥å¿—å®¡è®¡è°ƒç ”">k8sæ—¥å¿—å®¡è®¡è°ƒç ”</span>
            <span class="post-date" title="2024-10-12 16:47:26">2024/10/12</span>
        </a>
        
        
        <a  class="All linuxè¿ç»´ "
           href="/2024/10/09/%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/"
           data-tag="linuxå‘½ä»¤"
           data-author="" >
            <span class="post-title" title="ç£ç›˜æŒ‚è½½åˆ†åŒº">ç£ç›˜æŒ‚è½½åˆ†åŒº</span>
            <span class="post-date" title="2024-10-09 11:56:07">2024/10/09</span>
        </a>
        
        
        <a  class="All äº‘åŸç”Ÿ RBAC "
           href="/2024/10/05/RBAC/"
           data-tag="RBAC"
           data-author="" >
            <span class="post-title" title="K8sä¹‹RBAC">K8sä¹‹RBAC</span>
            <span class="post-date" title="2024-10-05 21:49:22">2024/10/05</span>
        </a>
        
        
        <a  class="All ä¸»æœºå®‰å…¨ Capsule8 "
           href="/2024/10/05/ecaplute8/"
           data-tag="Capsule8"
           data-author="" >
            <span class="post-title" title="Capsule8åˆ†æ (ä¸€)">Capsule8åˆ†æ (ä¸€)</span>
            <span class="post-date" title="2024-10-05 21:49:22">2024/10/05</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="Toggle full screen shortcut key s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-K8sæ—¥å¿—å®¡è®¡è°ƒç ”" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">k8sæ—¥å¿—å®¡è®¡è°ƒç ”</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="äº‘åŸç”Ÿ">äº‘åŸç”Ÿ</a> > 
            
            <a  data-rel="äº‘åŸç”Ÿ&lt;---&gt;k8s">k8s</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color5">æ—¥å¿—å®¡è®¡</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2024-10-12 16:52:41'>2024-10-12 16:47</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#k8s%E6%97%A5%E5%BF%97%E5%AE%A1%E8%AE%A1%E8%B0%83%E7%A0%94"><span class="toc-text">k8sæ—¥å¿—å®¡è®¡è°ƒç ”</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E8%AF%A6%E6%83%85"><span class="toc-text">æ–¹æ¡ˆè¯¦æƒ…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kube-apiserver%E9%85%8D%E7%BD%AEyaml%E7%AD%96%E7%95%A5%E8%A7%84%E5%88%99"><span class="toc-text">kube-apiserveré…ç½®yamlç­–ç•¥è§„åˆ™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E6%94%B6%E9%9B%86%E9%9B%86%E7%BE%A4%E6%97%A5%E5%BF%97-%E8%84%9A%E6%9C%AC%E8%A7%84%E5%88%99%E5%A4%84%E7%90%86"><span class="toc-text">ç›‘å¬æ”¶é›†é›†ç¾¤æ—¥å¿—+è„šæœ¬è§„åˆ™å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="toc-text">è·å–æ–¹å¼ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-text">æ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E6%94%B6%E9%9B%86%E9%9B%86%E7%BE%A4%E6%97%A5%E5%BF%97"><span class="toc-text">ç›‘å¬æ”¶é›†é›†ç¾¤æ—¥å¿—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%88%86%E6%9E%90%E6%95%B0%E6%8D%AE"><span class="toc-text">å¤„ç†åˆ†ææ•°æ®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E8%A1%8C%E4%B8%BA%E8%A7%84%E5%88%99"><span class="toc-text">ç›¸å…³è¡Œä¸ºè§„åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-text">å·¥ä½œæµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEBhook-apiserver%E8%A1%8C%E4%B8%BA%E6%B6%88%E6%81%AF-%E8%A7%84%E5%88%99%E5%BC%95%E6%93%8E%EF%BC%88%E6%9C%80%E7%BB%88%E9%80%89%E6%8B%A9%E6%96%B9%E6%A1%88%EF%BC%89"><span class="toc-text">WEBhook apiserverè¡Œä¸ºæ¶ˆæ¯+è§„åˆ™å¼•æ“ï¼ˆæœ€ç»ˆé€‰æ‹©æ–¹æ¡ˆï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B-1"><span class="toc-text">å·¥ä½œæµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E8%A1%8C%E4%B8%BA%E8%A7%84%E5%88%99-1"><span class="toc-text">ç›¸å…³è¡Œä¸ºè§„åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">ä½¿ç”¨æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E7%BC%96%E5%86%99"><span class="toc-text">è§„åˆ™ç¼–å†™</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%AE%A1%E8%AE%A1-%E6%96%B0%E5%A2%9E%E5%8C%BF%E5%90%8D%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E8%A7%84%E5%88%99"><span class="toc-text">æ—¥å¿—å®¡è®¡-æ–°å¢åŒ¿åç”¨æˆ·è®¿é—®è§„åˆ™</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="k8sæ—¥å¿—å®¡è®¡è°ƒç ”"><a href="#k8sæ—¥å¿—å®¡è®¡è°ƒç ”" class="headerlink" title="k8sæ—¥å¿—å®¡è®¡è°ƒç ”"></a>k8sæ—¥å¿—å®¡è®¡è°ƒç ”</h1><p>k8sæ—¥å¿—å®¡è®¡k8sç»„ä»¶åœ¨å®¹å™¨ç¼–æ’åˆ›å»ºåˆ é™¤ç­‰è¿‡ç¨‹ä¸­éƒ½ä¼šå°†è¡Œä¸ºè®°å½•ä¸ºæ—¥å¿—ï¼Œå¯ä»¥é€šè¿‡æ—¥å¿—å®¡è®¡å‘ç°æŸäº›é»‘å®¢çš„æ•æ„Ÿè¡Œä¸ºè¿›è¡Œé¢„è­¦</p>
<h2 id="æ–¹æ¡ˆè¯¦æƒ…"><a href="#æ–¹æ¡ˆè¯¦æƒ…" class="headerlink" title="æ–¹æ¡ˆè¯¦æƒ…"></a>æ–¹æ¡ˆè¯¦æƒ…</h2><p>ç›®å‰ä¸»è¦å½¢æˆä»¥ä¸‹æ–¹æ¡ˆï¼Œè¯¦æƒ…åŠä¼˜ç¼ºç‚¹æä¾›å‚è€ƒï¼ˆä¸»è¦æ¨è:ç›‘å¬æ”¶é›†é›†ç¾¤æ—¥å¿—+è„šæœ¬è§„åˆ™å¤„ç†ï¼‰</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="right">ä¾µå…¥æ€§</th>
<th align="center">ä¼˜å…ˆçº§</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ç›‘å¬æ”¶é›†é›†ç¾¤æ—¥å¿—+è„šæœ¬è§„åˆ™å¤„ç†</td>
<td align="right">æ— </td>
<td align="center">2</td>
</tr>
<tr>
<td align="left">WEBhookï¼Œapiserverè¡Œä¸ºéªŒè¯</td>
<td align="right"></td>
<td align="center">3</td>
</tr>
<tr>
<td align="left">kube-apiserveré…ç½®yamlç­–ç•¥è§„åˆ™</td>
<td align="right">ç­–ç•¥é…ç½®éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶</td>
<td align="center">1</td>
</tr>
</tbody></table>
<h2 id="kube-apiserveré…ç½®yamlç­–ç•¥è§„åˆ™"><a href="#kube-apiserveré…ç½®yamlç­–ç•¥è§„åˆ™" class="headerlink" title="kube-apiserveré…ç½®yamlç­–ç•¥è§„åˆ™"></a>kube-apiserveré…ç½®yamlç­–ç•¥è§„åˆ™</h2><p>å®¡è®¡æ”¿ç­–å®šä¹‰äº†å…³äºåº”è®°å½•å“ªäº›äº‹ä»¶ä»¥åŠåº”åŒ…å«å“ªäº›æ•°æ®çš„è§„åˆ™ã€‚å¤„ç†äº‹ä»¶æ—¶ï¼Œå°†æŒ‰é¡ºåºä¸è§„åˆ™åˆ—è¡¨è¿›è¡Œæ¯”è¾ƒã€‚ç¬¬ä¸€ä¸ªåŒ¹é…è§„åˆ™è®¾ç½®äº‹ä»¶çš„ [å®¡è®¡çº§åˆ«][auditing-level]ã€‚å·²çŸ¥çš„å®¡è®¡çº§åˆ«æœ‰ï¼š<br>None -ç¬¦åˆè¿™æ¡è§„åˆ™çš„æ—¥å¿—å°†ä¸ä¼šè®°å½•ã€‚<br>Metadata -è®°å½•è¯·æ±‚çš„ metadataï¼ˆè¯·æ±‚çš„ç”¨æˆ·ã€timestampã€resourceã€verb ç­‰ç­‰ï¼‰ï¼Œä½†æ˜¯ä¸è®°å½•è¯·æ±‚æˆ–è€…å“åº”çš„æ¶ˆæ¯ä½“ã€‚<br>Request -è®°å½•äº‹ä»¶çš„ metadata å’Œè¯·æ±‚çš„æ¶ˆæ¯ä½“ï¼Œä½†æ˜¯ä¸è®°å½•å“åº”çš„æ¶ˆæ¯ä½“ã€‚è¿™ä¸é€‚ç”¨äºéèµ„æºç±»å‹çš„è¯·æ±‚ã€‚<br>RequestResponse -è®°å½•äº‹ä»¶çš„ metadataï¼Œè¯·æ±‚å’Œå“åº”çš„æ¶ˆæ¯ä½“ã€‚è¿™ä¸é€‚ç”¨äºéèµ„æºç±»å‹çš„è¯·æ±‚ã€‚<br>æ‚¨å¯ä»¥ä½¿ç”¨ â€“audit-policy-file æ ‡å¿—å°†åŒ…å«ç­–ç•¥çš„æ–‡ä»¶ä¼ é€’ç»™ kube-apiserverã€‚å¦‚æœä¸è®¾ç½®è¯¥æ ‡å¿—ï¼Œåˆ™ä¸è®°å½•äº‹ä»¶ã€‚æ³¨æ„ rules å­—æ®µå¿…é¡»åœ¨å®¡è®¡ç­–ç•¥æ–‡ä»¶ä¸­æä¾›ã€‚<br>è¿™ç§æ–¹å¼ä¸ºk8sè‡ªå¸¦åŠŸèƒ½ç­–ç•¥æ–¹é¢æ¯”è¾ƒä¸°å¯Œï¼Œç¼ºç‚¹åœ¨äºéœ€è¦é…ç½®apiserverï¼Œä½†apiserverå¤šä»¥system podå½¢å¼å¯åŠ¨å› æ­¤ä¼šå¯¼è‡´k8sé‡å¯ã€‚<br>ä¼˜ç‚¹ï¼šå®˜æ–¹åŠŸèƒ½è·å–æ—¥å¿—éƒ½å¾ˆæ–¹ä¾¿<br>ç¼ºç‚¹ï¼šéœ€è¦é…ç½®apiserverå‚æ•°ï¼Œå¤§ç¨‹åº¦å½±å“k8sè¿è¡Œï¼Œæ¶ˆè€—æ€§èƒ½è¾ƒé«˜å¼€å¯åéƒ¨ç½²èµ„æºæœ‰æ˜æ˜¾å¡é¡¿</p>
<h2 id="ç›‘å¬æ”¶é›†é›†ç¾¤æ—¥å¿—-è„šæœ¬è§„åˆ™å¤„ç†"><a href="#ç›‘å¬æ”¶é›†é›†ç¾¤æ—¥å¿—-è„šæœ¬è§„åˆ™å¤„ç†" class="headerlink" title="ç›‘å¬æ”¶é›†é›†ç¾¤æ—¥å¿—+è„šæœ¬è§„åˆ™å¤„ç†"></a>ç›‘å¬æ”¶é›†é›†ç¾¤æ—¥å¿—+è„šæœ¬è§„åˆ™å¤„ç†</h2><h3 id="è·å–æ–¹å¼ï¼š"><a href="#è·å–æ–¹å¼ï¼š" class="headerlink" title="è·å–æ–¹å¼ï¼š"></a>è·å–æ–¹å¼ï¼š</h3><p>kubectl cluster-info dump è·å–æ‰€æœ‰pod yamlä¿¡æ¯,kube-apiserver,kube-controller,kube-proxy,kube-schedulerç»„ä»¶æ—¥å¿—ï¼ˆsocketå½¢å¼ï¼Œå¤–éƒ¨å·¥å…·ï¼‰</p>
<h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--- podåå­—/log.txt(å®¹å™¨æ—¥å¿—)</span><br><span class="line">---daemonsets.json</span><br><span class="line">---events.json</span><br><span class="line">---pods.json</span><br><span class="line">---replicasets.json</span><br><span class="line">---services.json</span><br></pre></td></tr></table></figure>
<h3 id="ç›‘å¬æ”¶é›†é›†ç¾¤æ—¥å¿—"><a href="#ç›‘å¬æ”¶é›†é›†ç¾¤æ—¥å¿—" class="headerlink" title="ç›‘å¬æ”¶é›†é›†ç¾¤æ—¥å¿—"></a>ç›‘å¬æ”¶é›†é›†ç¾¤æ—¥å¿—</h3><p>journalctl -l -u kubelet  (æµæ–‡ä»¶)<br>çŸ­æ—¶é—´é—´éš”ä¸æ–­ç›‘å¬æˆ‘ä»¬å¯ä»¥è·å–k8sé›†ç¾¤æ—¥å¿—çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬podåˆ›å»ºæ—¶ç”¨yamlï¼Œserverï¼Œnamespace,ClusterRole,å®¹å™¨æ—¥å¿—ï¼Œäº‹ä»¶æ—¥å¿—</p>
<h3 id="å¤„ç†åˆ†ææ•°æ®"><a href="#å¤„ç†åˆ†ææ•°æ®" class="headerlink" title="å¤„ç†åˆ†ææ•°æ®"></a>å¤„ç†åˆ†ææ•°æ®</h3><p>ç¼–å†™è„šæœ¬ä¸»è¦æ˜¯å°†è·å–åˆ°çš„æ•°æ®æœ‰ä¸€äº›åŒ…æ‹¬podçš„åˆ›å»ºèŠ‚ç‚¹æ ‘ï¼Œeventsäº‹ä»¶ï¼ŒæœåŠ¡ç­‰è¿›è¡Œç›¸å…³è”ï¼Œé€šè¿‡è§‚å¯Ÿæ—¥å¿—å˜åŒ–è·å–è¡Œä¸ºå˜åŒ–å¯¹ç‰¹æ®Šè¡Œä¸ºè¿›è¡Œé¢„è­¦</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl cluster-info dump </span><br></pre></td></tr></table></figure>
<h3 id="ç›¸å…³è¡Œä¸ºè§„åˆ™"><a href="#ç›¸å…³è¡Œä¸ºè§„åˆ™" class="headerlink" title="ç›¸å…³è¡Œä¸ºè§„åˆ™"></a>ç›¸å…³è¡Œä¸ºè§„åˆ™</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨ç§æœ‰å‡­è¯åˆ›å»ºConfigmap  </span><br><span class="line">åˆ›å»ºpodæ•æ„ŸæŒ‚è½½ </span><br><span class="line">æ£€æµ‹åœ¨kube-systemæˆ–kube-publicå‘½åç©ºé—´ä¸­åˆ›å»ºpod </span><br><span class="line">æ£€æµ‹åœ¨kube-systemæˆ–kube-publicå‘½åç©ºé—´ä¸­åˆ›å»ºpodå¤±è´¥</span><br><span class="line">æ£€æµ‹åœ¨kube-systemæˆ–kube-publicå‘½åç©ºé—´ä¸­åˆ›å»ºæœåŠ¡å¸æˆ· </span><br><span class="line">æ£€æµ‹ä»»ä½•åˆ›å»º/åˆ é™¤ä»¥systemå¼€å¤´çš„ClusterRole/Role </span><br><span class="line">ä½¿ç”¨ç§æœ‰å‡­è¯åˆ›å»ºConfigmap </span><br><span class="line">æ£€æµ‹åˆ›å»ºå¯æ‰§è¡Œå†™æ“ä½œçš„è§’è‰²/ç¾¤é›†è§’è‰² </span><br></pre></td></tr></table></figure>

<h3 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h3><p>è¿è¡Œç›‘å¬åŠŸèƒ½æ¯éš”ä¸€æ®µæ—¶é—´è·å–æ—¥å¿—ï¼Œè·å–æ—¥å¿—æ—¥å¿—jsonæ ¼å¼è¾“å‡ºâ€“jsonå­—æ®µè§£ææŠ½è±¡åŒ–å½“å‰k8sé›†ç¾¤çŠ¶æ€â€“åŠ è½½è§„åˆ™åˆ¤æ–­é€»è¾‘â€“æ ¹æ®æ—¶é—´é—´éš”è§‚å¯Ÿæ˜¯å¦è§¦å‘å±é™©è¡Œä¸ºäº§ç”Ÿè­¦å‘Š.ï¼ˆæ—¥å¿—åˆ†å‘ï¼‰<br><img src="https://img-blog.csdnimg.cn/7f5a8270d2754ffc920125f57cd40081.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAaGF0andl,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¼˜ç‚¹ï¼šæ— ä¾µå…¥æ€§åªæ˜¯è·å–k8sæ‰€æœ‰ç»„ä»¶æ—¥å¿—ï¼Œä¹‹åé€šè¿‡è„šæœ¬è¿›è¡Œæ•°æ®åŠ è½½ï¼Œé›†ç¾¤çŠ¶æ€æ¨¡æ‹Ÿï¼Œé€šè¿‡æ—¶é—´å¯¹æ¯”è¡Œä¸ºå˜åŒ–è¿›è¡Œé¢„æµ‹ï¼Œ<br>ç¼ºç‚¹ï¼šé€šè¿‡è§‚å¯Ÿk8sæ—¥å¿—å‘ç°æ¯”è¾ƒç²—ç•¥æ›´åƒæ˜¯ç¨‹åºçš„æŠ¥é”™ï¼Œå› æ­¤å¯¹äºä¸€äº›ä¿¡æ¯çš„è·å–æ— æ³•ä»æ—¥å¿—ç›´è§‚çœ‹å‡ºæ¯”å¦‚<br>      1.åˆ›å»ºsecert<br>      æ²¡æœ‰åœ¨æ—¥å¿—ä¸­è¿›è¡Œä½“ç°ï¼ˆåˆ›å»ºsecertè·å–ä¸åˆ°)ã€‚</p>
<h3 id="WEBhook-apiserverè¡Œä¸ºæ¶ˆæ¯-è§„åˆ™å¼•æ“ï¼ˆæœ€ç»ˆé€‰æ‹©æ–¹æ¡ˆï¼‰"><a href="#WEBhook-apiserverè¡Œä¸ºæ¶ˆæ¯-è§„åˆ™å¼•æ“ï¼ˆæœ€ç»ˆé€‰æ‹©æ–¹æ¡ˆï¼‰" class="headerlink" title="WEBhook apiserverè¡Œä¸ºæ¶ˆæ¯+è§„åˆ™å¼•æ“ï¼ˆæœ€ç»ˆé€‰æ‹©æ–¹æ¡ˆï¼‰"></a>WEBhook apiserverè¡Œä¸ºæ¶ˆæ¯+è§„åˆ™å¼•æ“ï¼ˆæœ€ç»ˆé€‰æ‹©æ–¹æ¡ˆï¼‰</h3><p>K8Sä¸­æä¾›äº†è‡ªå®šä¹‰èµ„æºç±»å‹å’Œè‡ªå®šä¹‰æ§åˆ¶å™¨æ¥æ‰©å±•åŠŸèƒ½ï¼Œè¿˜æä¾›äº†åŠ¨æ€å‡†å…¥æ§åˆ¶ï¼Œå…¶å®å°±æ˜¯é€šè¿‡Webhookæ¥å®ç°å‡†å…¥æ§åˆ¶ï¼Œåˆ†ä¸ºä¸¤ç§ï¼šéªŒè¯æ€§è´¨çš„å‡†å…¥ Webhook ï¼ˆValidating Admission Webhookï¼‰ å’Œ ä¿®æ”¹æ€§è´¨çš„å‡†å…¥ Webhook ï¼ˆMutating Admission Webhookï¼‰</p>
<p>åˆ›å»ºRBACâ€”è¯ä¹¦è®¤è¯â€”è¿è¡Œwebhook<br>ä¼˜ç‚¹:åœ¨apiserverè¡Œä¸ºå¤„è·å–æ‰€æœ‰è¡Œä¸ºï¼Œç›´æ¥è¿›è¡Œè§„åˆ™éªŒè¯ï¼Œæ¯”è¾ƒçµæ´»æ–¹ä¾¿<br>ç¼ºç‚¹ï¼šä¼šå¯¹apiå“åº”æœ‰ä¸€å®šå½±å“ã€‚</p>
<h3 id="å·¥ä½œæµç¨‹-1"><a href="#å·¥ä½œæµç¨‹-1" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h3><p><img src="https://i.bmp.ovh/imgs/2022/04/02/9143401a6abf10bb.png"><br>apiserveræ˜¯k8sèµ„æºé…é¢æ§åˆ¶çš„å…¥å£ï¼Œé€šè¿‡webhookå¯ä»¥è·å–é›†ç¾¤å†…èµ„æºè¡Œä¸ºå˜åŒ–ï¼Œå°†å˜åŒ–æ•°æ®å‘é€ç»™è§„åˆ™å¼•æ“è¿›è¡Œå¤„ç†<br>ç¼ºç‚¹ï¼šä¼šå¯¹apiå“åº”æœ‰ä¸€å®šå½±å“ï¼Œåœ¨masterèŠ‚ç‚¹éƒ¨ç½²<br>è·å–æ•°æ®æ¦‚è§ˆ</p>
<h3 id="ç›¸å…³è¡Œä¸ºè§„åˆ™-1"><a href="#ç›¸å…³è¡Œä¸ºè§„åˆ™-1" class="headerlink" title="ç›¸å…³è¡Œä¸ºè§„åˆ™"></a>ç›¸å…³è¡Œä¸ºè§„åˆ™</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">æ‰§è¡Œpodæ“ä½œ(åˆ›å»ºåˆ é™¤æ›´æ–°)</span><br><span class="line">æ‰§è¡ŒServiceAccountæ“ä½œ(åˆ›å»ºåˆ é™¤æ›´æ–°)</span><br><span class="line">è¯·é¿å…åœ¨ system  namespaceä¸­æ“ä½œä¸å—ä¿¡ä»»çš„ServiceAccount</span><br><span class="line">æ‰§è¡ŒServiceæ“ä½œ(åˆ›å»ºåˆ é™¤æ›´æ–°)</span><br><span class="line">è¯·é¿å…åœ¨ system  namespaceä¸­æ“ä½œä¸å—ä¿¡ä»»çš„Service</span><br><span class="line"> åˆ›å»ºpodå¼€å¯NodePort </span><br><span class="line"><span class="string">&quot;æ‰§è¡Œ&quot;</span><span class="string">&quot;ConfigMapæ“ä½œ(åˆ›å»ºåˆ é™¤æ›´æ–°)&quot;</span></span><br><span class="line">è¯·é¿å…åœ¨ system  namespaceä¸­æ“ä½œä¸å—ä¿¡ä»»çš„ConfigMap</span><br><span class="line">è¯·é¿å…åœ¨ system  namespaceä¸­æ“ä½œä¸å—ä¿¡ä»»çš„pod</span><br><span class="line">æ•æ„Ÿç›®å½•æŒ‚è½½äº‹ä»¶</span><br><span class="line">ç‰¹æƒå®¹å™¨äº‹ä»¶</span><br><span class="line">Namespaceæ“ä½œ(åˆ›å»ºåˆ é™¤æ›´æ–°)</span><br><span class="line">æºå¸¦æœåŠ¡è´¦å·åˆ›å»ºpod</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†webhookè·å–çš„ä¿¡æ¯ç”Ÿæˆæœ¬åœ°jsonç”¨äºæµ‹è¯•ï¼Œåœ¨k8s_audit&#x2F;cmd&#x2F;audit&#x2F;main.go ä¸‹request.jsonä¸ºè·å–çš„ä¿¡æ¯è¯·æ±‚jsonæ–‡ä»¶ï¼Œå¼•æ“ä¼šè¯»å–æ–‡ä»¶è¿›è¡Œè§„åˆ™åŒ¹é…å’Œæ˜¾ç¤ºç»“æœï¼Œé¡¹ç›®ç”¨åˆ°äº†ç ”å‘é‚£è¾¹å®šåˆ¶çš„vendoræ‰€ä»¥buildéœ€è¦æ·»åŠ -mod&#x3D;vendorè¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘å¥½åç›´æ¥è¿è¡Œå³å¯ã€‚</p>
<h4 id="è§„åˆ™ç¼–å†™"><a href="#è§„åˆ™ç¼–å†™" class="headerlink" title="è§„åˆ™ç¼–å†™"></a>è§„åˆ™ç¼–å†™</h4><p>k8s_audit&#x2F;pkg&#x2F;policy_engine&#x2F;rule.engine</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">rule <span class="string">&quot;policy_1&quot;</span> <span class="string">&quot;Podäº‹ä»¶&quot;</span> salience <span class="number">0</span></span><br><span class="line">begin</span><br><span class="line">  if toString(req.Operation) == <span class="string">&quot;&quot;</span> <span class="punctuation">&#123;</span></span><br><span class="line">    return</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  if req.Kind.Kind != <span class="string">&quot;Pod&quot;</span> <span class="punctuation">&#123;</span></span><br><span class="line">    return</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">  obj = newObject()</span><br><span class="line"></span><br><span class="line">  obj<span class="punctuation">[</span><span class="string">&quot;id&quot;</span><span class="punctuation">]</span>                  = <span class="string">&quot;policy_1&quot;</span></span><br><span class="line">  obj<span class="punctuation">[</span><span class="string">&quot;title&quot;</span><span class="punctuation">]</span>               = <span class="string">&quot;podäº‹ä»¶&quot;</span></span><br><span class="line">  obj<span class="punctuation">[</span><span class="string">&quot;description&quot;</span><span class="punctuation">]</span>         = <span class="string">&quot;æ‰§è¡Œpodæ“ä½œ(åˆ›å»ºåˆ é™¤æ›´æ–°)&quot;</span></span><br><span class="line">  obj<span class="punctuation">[</span><span class="string">&quot;severity&quot;</span><span class="punctuation">]</span>            = <span class="string">&quot;NOTICE&quot;</span></span><br><span class="line">  obj<span class="punctuation">[</span><span class="string">&quot;type&quot;</span><span class="punctuation">]</span>                = <span class="string">&quot;Pod&quot;</span></span><br><span class="line">  obj<span class="punctuation">[</span><span class="string">&quot;recommended_actions&quot;</span><span class="punctuation">]</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  obj<span class="punctuation">[</span><span class="string">&quot;version&quot;</span><span class="punctuation">]</span>             = <span class="string">&quot;v1&quot;</span></span><br><span class="line">  obj<span class="punctuation">[</span><span class="string">&quot;msg&quot;</span><span class="punctuation">]</span>                 = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  return obj</span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰æ–¹æ³•ï¼Œåœ¨è§„åˆ™ä¸­éœ€è¦æ·»åŠ è‡ªå®šä¹‰æ–¹æ³•k8s_audit&#x2F;cmd&#x2F;audit&#x2F;main.goä¸­å®šä¹‰ï¼Œå®šä¹‰å®ä¾‹å¦‚ä¸‹</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Audit</span><span class="params">(req *admissionv1.AdmissionRequest)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	gvk := schema.GroupVersionKind(req.Kind)</span><br><span class="line">	decoder := codecs.UniversalDeserializer()</span><br><span class="line"></span><br><span class="line">	object, _, err := decoder.Decode(</span><br><span class="line">		req.Object.Raw,</span><br><span class="line">		&amp;gvk,</span><br><span class="line">		<span class="literal">nil</span>,</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.Wrap(err, <span class="string">&quot;decode object&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	oldObject, _, err := decoder.Decode(</span><br><span class="line">		req.OldObject.Raw,</span><br><span class="line">		&amp;gvk,</span><br><span class="line">		<span class="literal">nil</span>,</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.Wrap(err, <span class="string">&quot;decode old object&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	result, err := policy_engine.Execute(<span class="keyword">map</span>[<span class="type">string</span>]any&#123;</span><br><span class="line">		<span class="string">&quot;req&quot;</span>:       req,</span><br><span class="line">		<span class="string">&quot;object&quot;</span>:    object,</span><br><span class="line">		<span class="string">&quot;oldObject&quot;</span>: oldObject,</span><br><span class="line">		<span class="string">&quot;newObject&quot;</span>: <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">map</span>[<span class="type">string</span>]any &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">map</span>[<span class="type">string</span>]any&#123;&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">&quot;sprintf&quot;</span>: fmt.Sprintf,</span><br><span class="line">		<span class="string">&quot;inArray&quot;</span>: <span class="function"><span class="keyword">func</span><span class="params">(val any, array ...any)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> mbase.InSliceAny(val, array)</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">&quot;toString&quot;</span>:  mconv.String,</span><br><span class="line">		<span class="string">&quot;toBool&quot;</span>:    mconv.Bool,</span><br><span class="line">		<span class="string">&quot;hasPrefix&quot;</span>: strings.HasPrefix,</span><br><span class="line">		<span class="string">&quot;hasSuffix&quot;</span>: strings.HasSuffix,</span><br><span class="line">		<span class="string">&quot;contains&quot;</span>:  strings.Contains,</span><br><span class="line">		<span class="string">&quot;println&quot;</span>:   fmt.Println,</span><br><span class="line">		<span class="string">&quot;len&quot;</span>: <span class="function"><span class="keyword">func</span><span class="params">(val any)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">			v := reflect.ValueOf(val)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> v.Kind() == reflect.Slice &#123;</span><br><span class="line">				<span class="keyword">return</span> v.Len()</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.Wrapf(err, <span class="string">&quot;AuditService Execute error&quot;</span>)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>






<h2 id="æ—¥å¿—å®¡è®¡-æ–°å¢åŒ¿åç”¨æˆ·è®¿é—®è§„åˆ™"><a href="#æ—¥å¿—å®¡è®¡-æ–°å¢åŒ¿åç”¨æˆ·è®¿é—®è§„åˆ™" class="headerlink" title="æ—¥å¿—å®¡è®¡-æ–°å¢åŒ¿åç”¨æˆ·è®¿é—®è§„åˆ™"></a>æ—¥å¿—å®¡è®¡-æ–°å¢åŒ¿åç”¨æˆ·è®¿é—®è§„åˆ™</h2><p>webhookè·å–è¯·æ±‚userinfoå­—æ®µï¼Œæ­£åˆ™åŒ¹é…ç”¨æˆ·ä¸ºsystem:anonymous</p>
<p>webhookæŠ“åˆ°æ˜¯è¿™æ ·çš„</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserInfo=&#123;system:anonymous  [system:unauthenticated] map[]&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/08/11/OfmvuVI8Rsb7wcr.png" alt="image-20220811165933304"></p>
<p><strong>é£é™©ç±»å‹å­—æ®µæè¿°æ–°å¢ï¼š</strong></p>
<p>åŒ¿åç”¨æˆ·è®¿é—®äº‹ä»¶</p>
<p>æµ‹è¯•æ–¹å¼</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»™åŒ¿åç”¨æˆ·æˆæƒ</span></span><br><span class="line">kubectl create clusterrolebinding test:anonymous --clusterrole=cluster-admin --user=system:anonymous</span><br><span class="line"><span class="comment">//å†™ä¸ªyamlæ–‡ä»¶</span></span><br><span class="line">cat &gt; nginx-pod.yaml &lt;&lt; EOF</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: test<span class="number">-444</span></span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: test<span class="number">-444</span></span><br><span class="line">    image: nginx:<span class="number">1.14</span><span class="number">.2</span></span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: host</span><br><span class="line">      mountPath: /host</span><br><span class="line">  volumes:</span><br><span class="line">  - name: host</span><br><span class="line">    hostPath:</span><br><span class="line">      path: /</span><br><span class="line">      type: Directory</span><br><span class="line">EOF</span><br><span class="line"><span class="comment">//åŒ¿åç”¨æˆ·è¯·æ±‚</span></span><br><span class="line">curl  -k https:<span class="comment">//192.168.110.20:6443/api/v1/namespaces/dfault/pods -X POST --header &#x27;content-type: application/yaml&#x27; --data-binary @nginx-pod.yaml</span></span><br><span class="line"><span class="comment">//åˆ æ‰åŒ¿åç”¨æˆ·æˆæƒ</span></span><br><span class="line">kubectl delete clusterrolebinding test:anonymous</span><br></pre></td></tr></table></figure>









      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æº. </span>
    </div>
</article>







    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2022-2024
</p>


    </div>
    <div class="full-toc">
        <button class="full" data-title="Toggle full screen shortcut key s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>







</html>
