<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>API安全-文档泄露调研 | Hexo</title>
  <meta name="keywords" content=" apikit ">
  <meta name="description" content="API安全-文档泄露调研 | Hexo">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="API安全-文档泄露调研最近在做一些API文档泄露的安全调研，看到一款自动检测API文档泄露，且能模拟接口发包的工具。解析下源码，参考下实现。 API安全相关工具分析，主要检测方面为 1234swaggerspring-boot actuatorgraphqlsoap  源码及调试APIKIT github上最新relase的是jar包，给的源码还是旧的。最新版可以用我这个反编译再还原的。源码在最">
<meta property="og:type" content="article">
<meta property="og:title" content="API安全-文档泄露调研">
<meta property="og:url" content="http://example.com/2025/02/20/API%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B-APIKIT%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="API安全-文档泄露调研最近在做一些API文档泄露的安全调研，看到一款自动检测API文档泄露，且能模拟接口发包的工具。解析下源码，参考下实现。 API安全相关工具分析，主要检测方面为 1234swaggerspring-boot actuatorgraphqlsoap  源码及调试APIKIT github上最新relase的是jar包，给的源码还是旧的。最新版可以用我这个反编译再还原的。源码在最">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/2-17-1.png">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/2-18-1.png">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/2-12-1.png">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/2-13-2.png">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/2-13-3.png">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/2-13-9.png">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/25-2-13-7.png">
<meta property="og:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/2-14-1.png">
<meta property="article:published_time" content="2025-02-20T08:27:40.671Z">
<meta property="article:modified_time" content="2025-02-20T08:33:47.025Z">
<meta property="article:author" content="hatjwe">
<meta property="article:tag" content="apikit">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://prefect12.oss-cn-beijing.aliyuncs.com/2-17-1.png">


<link rel="icon" href="/img/avatar1.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.3.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar1.jpg"/>
</a>
<div class="author">
    <span>hatjwe</span>
</div>

<div class="icon">
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(10)</small>
            
        </div>
    </li>
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="云安全">
            <i class="fold iconfont icon-right"></i>
            云安全
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="云安全&lt;---&gt;源码泄露">
            
            源码泄露
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="云原生">
            <i class="fold iconfont icon-right"></i>
            云原生
            <small>(4)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="云原生&lt;---&gt;镜像扫描">
            
            镜像扫描
            <small>(2)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="云原生&lt;---&gt;k8s">
            
            k8s
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="云原生&lt;---&gt;RBAC">
            
            RBAC
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="主机安全">
            <i class="fold iconfont icon-right"></i>
            主机安全
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="主机安全&lt;---&gt;Capsule8">
            
            Capsule8
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="API安全">
            <i class="fold iconfont icon-right"></i>
            API安全
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="API安全&lt;---&gt;源码泄露">
            
            源码泄露
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="DevOps">
            
            DevOps
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="linux运维">
            
            linux运维
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="10">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="search shortcut key i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="switch to outline view shortcut key w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="return"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="case sensitive"></i>
            <i class="iconfont icon-tag" data-title="label"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">outline</div>
            <i class="iconfont icon-list" data-title="switch to article list"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>镜像扫描</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>日志审计</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>agc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>apikit</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Capsule8</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>CI/CD工具</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>linux命令</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>RBAC</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="All API安全 源码泄露 "
           href="/2025/02/20/API%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B-APIKIT%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"
           data-tag="apikit"
           data-author="" >
            <span class="post-title" title="API安全-文档泄露调研">API安全-文档泄露调研</span>
            <span class="post-date" title="2025-02-20 16:27:40">2025/02/20</span>
        </a>
        
        
        <a  class="All 云安全 源码泄露 "
           href="/2025/01/16/%E4%BA%91%E6%B3%84%E9%9C%B2/"
           data-tag="agc"
           data-author="" >
            <span class="post-title" title="云源码泄露点分析">云源码泄露点分析</span>
            <span class="post-date" title="2025-01-16 16:47:32">2025/01/16</span>
        </a>
        
        
        <a  class="All 云原生 镜像扫描 "
           href="/2024/12/11/%E9%95%9C%E5%83%8F%E6%89%AB%E6%8F%8F-syft/"
           data-tag="镜像扫描"
           data-author="" >
            <span class="post-title" title="镜像扫描-syft分析">镜像扫描-syft分析</span>
            <span class="post-date" title="2024-12-11 14:25:00">2024/12/11</span>
        </a>
        
        
        <a  class="All 云原生 镜像扫描 "
           href="/2024/12/11/%E9%95%9C%E5%83%8F%E6%89%AB%E6%8F%8F-trivy/"
           data-tag="镜像扫描"
           data-author="" >
            <span class="post-title" title="镜像扫描-trivy分析">镜像扫描-trivy分析</span>
            <span class="post-date" title="2024-12-11 14:12:46">2024/12/11</span>
        </a>
        
        
        <a  class="All DevOps "
           href="/2024/11/19/DevOps%E5%AE%9E%E8%B7%B5-CI/"
           data-tag="CI/CD工具"
           data-author="" >
            <span class="post-title" title="DevOps实践-gitlab CI集成">DevOps实践-gitlab CI集成</span>
            <span class="post-date" title="2024-11-19 11:29:00">2024/11/19</span>
        </a>
        
        
        <a  class="All DevOps "
           href="/2024/11/06/DevOps%E5%AE%9E%E8%B7%B5/"
           data-tag="CI/CD工具"
           data-author="" >
            <span class="post-title" title="DevOps实践-Watchtower一键全自动的watchtower">DevOps实践-Watchtower一键全自动的watchtower</span>
            <span class="post-date" title="2024-11-06 17:03:02">2024/11/06</span>
        </a>
        
        
        <a  class="All 云原生 k8s "
           href="/2024/10/12/K8s%E6%97%A5%E5%BF%97%E5%AE%A1%E8%AE%A1%E8%B0%83%E7%A0%94/"
           data-tag="日志审计"
           data-author="" >
            <span class="post-title" title="k8s日志审计调研">k8s日志审计调研</span>
            <span class="post-date" title="2024-10-12 16:47:26">2024/10/12</span>
        </a>
        
        
        <a  class="All linux运维 "
           href="/2024/10/09/%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA/"
           data-tag="linux命令"
           data-author="" >
            <span class="post-title" title="磁盘挂载分区">磁盘挂载分区</span>
            <span class="post-date" title="2024-10-09 11:56:07">2024/10/09</span>
        </a>
        
        
        <a  class="All 云原生 RBAC "
           href="/2024/10/05/RBAC/"
           data-tag="RBAC"
           data-author="" >
            <span class="post-title" title="K8s之RBAC">K8s之RBAC</span>
            <span class="post-date" title="2024-10-05 21:49:22">2024/10/05</span>
        </a>
        
        
        <a  class="All 主机安全 Capsule8 "
           href="/2024/10/05/ecaplute8/"
           data-tag="Capsule8"
           data-author="" >
            <span class="post-title" title="Capsule8分析 (一)">Capsule8分析 (一)</span>
            <span class="post-date" title="2024-10-05 21:49:22">2024/10/05</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="Toggle full screen shortcut key s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-API安全检测-APIKIT源码解析" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">API安全-文档泄露调研</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="API安全">API安全</a> > 
            
            <a  data-rel="API安全&lt;---&gt;源码泄露">源码泄露</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color2">apikit</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2025-02-20 16:33:47'>2025-02-20 16:27</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            Views 👀 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#API%E5%AE%89%E5%85%A8-%E6%96%87%E6%A1%A3%E6%B3%84%E9%9C%B2%E8%B0%83%E7%A0%94"><span class="toc-text">API安全-文档泄露调研</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%8F%8A%E8%B0%83%E8%AF%95"><span class="toc-text">源码及调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E5%BC%8F"><span class="toc-text">动态调式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E7%BC%96%E8%AF%91%E6%9B%BF%E6%8D%A2"><span class="toc-text">插件编译替换</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API%E6%B3%84%E9%9C%B2%E6%A3%80%E6%B5%8B%E9%83%A8%E5%88%86"><span class="toc-text">API泄露检测部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-swagger%E6%A3%80%E6%B5%8B"><span class="toc-text">1.1 swagger检测</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-%E7%89%B9%E5%BE%81%E5%8C%B9%E9%85%8D"><span class="toc-text">1.1.1 特征匹配</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#urlAddPath-%E6%98%AF%E6%95%B4%E4%B8%AA%E5%A4%84%E7%90%86%E7%89%B9%E5%BE%81%E7%9A%84%E6%A0%B8%E5%BF%83%EF%BC%8C%E4%B8%8A%E4%B8%80%E6%AD%A5%E5%8F%AA%E6%98%AF%E6%8E%A2%E6%B5%8B%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8swagger%E9%A1%B5%E9%9D%A2-%E8%83%BD%E4%B8%8D%E8%83%BD%E6%8B%BF%E5%88%B0%E6%95%B0%E6%8D%AE%E8%BF%98%E5%BE%97%E7%9C%8B%E8%BF%99%E4%B8%80%E6%AD%A5-%E8%A7%A3%E6%9E%90%E7%89%B9%E5%BE%81%E6%96%B9%E6%B3%95%E5%A6%82%E4%B8%8B"><span class="toc-text">urlAddPath 是整个处理特征的核心，上一步只是探测是否存在swagger页面,能不能拿到数据还得看这一步,解析特征方法如下</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80-json-yaml%E5%BC%BA%E8%A7%A3%E6%9E%90"><span class="toc-text">方法一  json&#x2F;yaml强解析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%85%88%E5%BC%BA%E8%A7%A3%E6%9E%90json-%E4%B8%8D%E8%A1%8C%E5%86%8Dyaml%E7%84%B6%E5%90%8E%E8%BD%AC%E4%B8%BAjson"><span class="toc-text">第一步：先强解析json,不行再yaml然后转为json</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E5%A6%82%E6%9E%9C%E6%9C%89%E6%95%B0%E6%8D%AEjson%E5%88%86%E4%B8%A4%E7%A7%8D%E6%83%85%E5%86%B5%E6%A0%BC%E5%BC%8F-element-isJsonArray-%E5%92%8Celement-isJsonObject"><span class="toc-text">第二步：如果有数据json分两种情况格式 element.isJsonArray()和element.isJsonObject()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C-%E6%AD%A3%E5%88%99url%E8%A7%A3%E6%9E%90"><span class="toc-text">方法二 正则url解析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-%E6%96%87%E6%A1%A3%E8%A7%A3%E6%9E%90"><span class="toc-text">1.1.2 文档解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-4-%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C"><span class="toc-text">1.1.4 测试效果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%A3%80%E6%B5%8Bspring-actuator"><span class="toc-text">1.2 检测spring actuator</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E7%89%B9%E5%BE%81%E5%8C%B9%E9%85%8D"><span class="toc-text">1.2.1 特征匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#actuator%E7%89%B9%E5%BE%81%E9%A1%B5%E9%9D%A2-%E6%B2%A1%E6%9C%89swagger%E5%A4%8D%E6%9D%82%EF%BC%8C%E4%BB%8E%E9%80%BB%E8%BE%91%E4%B8%8A%E7%9C%8B-%E5%B0%B1%E6%98%AF%E5%B0%86%E4%B8%8A%E8%BE%B9%E8%BE%93%E5%85%A5%E7%9A%84path%E9%87%8C%E8%BE%B9%E8%BF%9B%E8%A1%8C%E4%B8%80%E4%BA%9Bjson%E8%A7%A3%E6%9E%90%EF%BC%8C%E9%87%87%E9%9B%86%E5%88%B0%E4%BA%86%E5%AD%97%E6%AE%B5%E5%B0%B1%E8%AF%B4%E6%98%8E%E5%AD%98%E5%9C%A8%E6%B3%84%E9%9C%B2"><span class="toc-text">actuator特征页面,没有swagger复杂，从逻辑上看,就是将上边输入的path里边进行一些json解析，采集到了字段就说明存在泄露</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E6%96%87%E6%A1%A3%E8%A7%A3%E6%9E%90"><span class="toc-text">1.2.2 文档解析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-soap%E6%A3%80%E6%B5%8B"><span class="toc-text">1.3 soap检测</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">1.3.1 简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-%E7%89%B9%E5%BE%81%E5%8C%B9%E9%85%8D"><span class="toc-text">1.3.2 特征匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#urlAddPath%E5%87%BD%E6%95%B0%E6%B5%81%E7%A8%8B%E5%A6%82%E4%B8%8B"><span class="toc-text">urlAddPath函数流程如下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E5%BE%811%EF%BC%8C%E4%BC%9A%E7%BB%99%E5%BD%93%E5%89%8Durl%E6%B7%BB%E5%8A%A0-wsdl%E4%BD%9C%E4%B8%BA%E4%B8%8B%E4%B8%80%E6%AD%A5%E7%9A%84%E8%A7%A3%E6%9E%90api%E6%96%87%E6%A1%A3%E8%B7%AF%E5%BE%84%EF%BC%8C%E7%89%B9%E5%BE%81%E4%BA%8C%E7%9A%84%E7%9B%AE%E6%A0%87%E9%A2%84%E8%AE%BE%E5%BA%94%E8%AF%A5%E4%B8%BAhtml%E6%96%87%E4%BB%B6%E9%80%9A%E8%BF%87%E6%AD%A3%E5%88%99%E6%8A%93%E5%8F%96soap%E6%96%87%E6%A1%A3%E5%9C%B0%E5%9D%80"><span class="toc-text">特征1，会给当前url添加?wsdl作为下一步的解析api文档路径，特征二的目标预设应该为html文件通过正则抓取soap文档地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-%E6%96%87%E6%A1%A3%E8%A7%A3%E6%9E%90-%E6%A8%A1%E6%8B%9F%E5%8F%91%E5%8C%85"><span class="toc-text">1.3.3 文档解析&#x2F;模拟发包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-4-%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C"><span class="toc-text">1.3.4 测试效果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-graphql%E6%A3%80%E6%B5%8B"><span class="toc-text">1.4 graphql检测</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">1.4.1 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E7%9C%81%E6%94%BB%E5%87%BB"><span class="toc-text">内省攻击</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-2-%E7%89%B9%E5%BE%81%E5%8C%B9%E9%85%8D"><span class="toc-text">1.4.2 特征匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#urlAddPath%E7%89%B9%E5%BE%81%E9%80%BB%E8%BE%91%E4%B8%BB%E8%A6%81%E5%9C%A8%E8%BF%9B%E8%A1%8C%E5%86%85%E7%9C%81%E6%94%BB%E5%87%BB%EF%BC%8C%E6%9F%A5%E7%9C%8B%E8%AF%B7%E6%B1%82%E7%BB%93%E6%9E%9C%E8%BF%9B%E8%A1%8C%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%B3%84%E9%9C%B2"><span class="toc-text">urlAddPath特征逻辑主要在进行内省攻击，查看请求结果进行判断是否存在泄露</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-%E6%96%87%E6%A1%A3%E8%A7%A3%E6%9E%90"><span class="toc-text">1.4.3 文档解析</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Kind-OBJECT%E7%B1%BB%E5%9E%8B"><span class="toc-text">Kind:OBJECT类型</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Kind-INTERFACE%E7%B1%BB%E5%9E%8B"><span class="toc-text">Kind:INTERFACE类型</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-4-%E6%A8%A1%E6%8B%9F%E8%AF%B7%E6%B1%82-%E5%8F%91%E5%8C%85"><span class="toc-text">1.4.4 模拟请求&#x2F;发包</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-4-%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C"><span class="toc-text">1.4.4 测试效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-1-REST-WADL"><span class="toc-text">1.5.1  REST-WADL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-2-%E7%89%B9%E5%BE%81%E5%8C%B9%E9%85%8D"><span class="toc-text">1.5.2 特征匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#urlAddPath%E4%B8%BB%E8%A6%81%E5%81%9A%E7%89%B9%E5%BE%81%E5%8C%B9%E9%85%8D-%E6%AD%A3%E5%88%99url%E8%A7%A3%E6%9E%90%E7%BD%91%E9%A1%B5%E5%93%8D%E5%BA%94%E6%B5%81%E9%87%8F%E4%B8%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8wadl%E7%BD%91%E9%A1%B5%EF%BC%8C%E6%88%96%E8%80%85%E5%87%BA%E7%8E%B0"><span class="toc-text">urlAddPath主要做特征匹配 正则url解析网页响应流量中是否存在wadl网页，或者出现&lt;application 可能是网页本身就是wadl文档</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-2%E6%96%87%E6%A1%A3%E8%A7%A3%E6%9E%90"><span class="toc-text">1.5.2文档解析</span></a></li></ol></li></ol></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="API安全-文档泄露调研"><a href="#API安全-文档泄露调研" class="headerlink" title="API安全-文档泄露调研"></a>API安全-文档泄露调研</h1><p>最近在做一些API文档泄露的安全调研，看到一款自动检测API文档泄露，且能模拟接口发包的工具。解析下源码，参考下实现。</p>
<p>API安全相关工具分析，主要检测方面为</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">swagger</span><br><span class="line">spring-boot actuator</span><br><span class="line">graphql</span><br><span class="line">soap</span><br></pre></td></tr></table></figure>

<h2 id="源码及调试"><a href="#源码及调试" class="headerlink" title="源码及调试"></a>源码及调试</h2><p>APIKIT github上最新relase的是jar包，给的源码还是旧的。最新版可以用我这个反编译再还原的。<br>源码在最底下附件</p>
<h3 id="动态调式"><a href="#动态调式" class="headerlink" title="动态调式"></a>动态调式</h3><p>java支持动态调式功能</p>
<h4 id="插件编译替换"><a href="#插件编译替换" class="headerlink" title="插件编译替换"></a>插件编译替换</h4><p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/2-17-1.png"><br>用右边的Maven工具，直接install即可生成jar包，用这个加载到burp里，后续有修改同理install再加载。<br>远程加载debug。即使burp用的java环境和idea的java环境不一样也可以。<br>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/u014531320/article/details/140639053">https://blog.csdn.net/u014531320/article/details/140639053</a></p>
<p>部署好debug环境就可以开始下面解析了.</p>
<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/2-18-1.png"></p>
<h2 id="API泄露检测部分"><a href="#API泄露检测部分" class="headerlink" title="API泄露检测部分"></a>API泄露检测部分</h2><p>这个项目是基于burp插件制作，主要分为被动流量扫描和主动点击目标url扫描，这两种方式都是在调用this.apiScanner.detect 传入调用burp sdk拿到的请求流量和是否为被动扫描的选项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#src/main/java/burp/PassiveScanner.java</span><br><span class="line">public List&lt;IScanIssue&gt; doPassiveScan(IHttpRequestResponse httpRequestResponse) &#123;</span><br><span class="line">        URL httpRequestURL = BurpExtender.getHelpers().analyzeRequest(httpRequestResponse).getUrl();</span><br><span class="line">        String requestUrl = CommonUtils.getUrlWithoutFilename(httpRequestURL);</span><br><span class="line">        if (this.scanedUrl.get(requestUrl) &lt;= 0) &#123;</span><br><span class="line">            this.scanedUrl.add(requestUrl);</span><br><span class="line">            System.out.println(&quot;Scanning\t&quot; + requestUrl);</span><br><span class="line">            ArrayList apiTypes = this.apiScanner.detect(httpRequestResponse, true);</span><br></pre></td></tr></table></figure>

<p>apiScanner.detect是个接口，会先初始化几种要扫描的类型实例，然后遍历这些实例通过 apiType.isFingerprintMatch()的覆写方法检测是否有那些泄露特征。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#src/main/java/burp/application/ApiScanner.java</span><br><span class="line">public class ApiScanner &#123;</span><br><span class="line">    private final ArrayList&lt;BiFunction&lt;IHttpRequestResponse, Boolean, ApiType&gt;&gt; apiTypeConstructors = <span class="built_in">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    public ApiScanner() &#123;</span><br><span class="line">        this.apiTypeConstructors.add(ApiTypeActuator::newInstance);</span><br><span class="line">        this.apiTypeConstructors.add(ApiTypeSwagger::newInstance);</span><br><span class="line">        this.apiTypeConstructors.add(ApiTypeGraphQL::newInstance);</span><br><span class="line">        this.apiTypeConstructors.add(ApiTypeSoap::newInstance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ArrayList&lt;ApiType&gt; detect(IHttpRequestResponse baseRequestResponse, boolean isPassive) &#123;</span><br><span class="line">        ArrayList&lt;ApiType&gt; apiTypes = <span class="built_in">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (BiFunction&lt;IHttpRequestResponse, Boolean, ApiType&gt; apiTypeConstructor : apiTypeConstructors) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                ApiType apiType = apiTypeConstructor.apply(baseRequestResponse, isPassive);</span><br><span class="line">                <span class="keyword">if</span> (apiType.isFingerprintMatch()) &#123;</span><br><span class="line">                    apiTypes.add(apiType);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                BurpExtender.getStderr().<span class="built_in">println</span>(CommonUtils.exceptionToString(e));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> apiTypes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-1-swagger检测"><a href="#1-1-swagger检测" class="headerlink" title="1.1 swagger检测"></a>1.1 swagger检测</h3><p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/2-12-1.png"></p>
<h4 id="1-1-1-特征匹配"><a href="#1-1-1-特征匹配" class="headerlink" title="1.1.1 特征匹配"></a>1.1.1 特征匹配</h4><p>这部分主要现是对如果目标是swagger时，一些特征网页路径进行访问成功就进入特征匹配。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#src/main/java/burp/application/apitypes/swagger/ApiTypeSwagger.java</span><br><span class="line">路径				 &quot;/swagger-resources&quot;</span><br><span class="line">								 &quot;/swagger/&quot;,</span><br><span class="line">                                    &quot;/swagger/index.html&quot;,</span><br><span class="line">                                    &quot;/api/&quot;,</span><br><span class="line">                                    &quot;/api/index.html&quot;,</span><br><span class="line">                                    &quot;/docs/&quot;,</span><br><span class="line">                                    &quot;/docs/index.html&quot;,</span><br><span class="line">                                    &quot;/apidocs/&quot;,</span><br><span class="line">                                    &quot;/apidocs/index.html&quot;,</span><br><span class="line">                                    &quot;/api-docs/&quot;,</span><br><span class="line">                                    &quot;/api-docs/index.html&quot;,</span><br><span class="line">                                    &quot;/&quot;</span><br><span class="line">public Boolean isFingerprintMatch() &#123;</span><br><span class="line">...</span><br><span class="line">                            for (String path : paths) &#123;</span><br><span class="line">                                Boolean checkResult = this.urlAddPath(urlPath + path);</span><br><span class="line">                                if (checkResult) &#123;</span><br><span class="line">                                    BurpExtender.PrintLog(&quot;Found Swagger at: &quot; + urlPath + path);</span><br><span class="line">                                    System.out.println(&quot;Found Swagger at: &quot; + urlPath + path); // 记录成功路径</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="urlAddPath-是整个处理特征的核心，上一步只是探测是否存在swagger页面-能不能拿到数据还得看这一步-解析特征方法如下"><a href="#urlAddPath-是整个处理特征的核心，上一步只是探测是否存在swagger页面-能不能拿到数据还得看这一步-解析特征方法如下" class="headerlink" title="urlAddPath 是整个处理特征的核心，上一步只是探测是否存在swagger页面,能不能拿到数据还得看这一步,解析特征方法如下"></a>urlAddPath 是整个处理特征的核心，上一步只是探测是否存在swagger页面,能不能拿到数据还得看这一步,解析特征方法如下</h3><h5 id="方法一-json-yaml强解析"><a href="#方法一-json-yaml强解析" class="headerlink" title="方法一  json&#x2F;yaml强解析"></a>方法一  json&#x2F;yaml强解析</h5><p>拿到swagger页面响应流量，尝试进行强解析，</p>
<h5 id="第一步：先强解析json-不行再yaml然后转为json"><a href="#第一步：先强解析json-不行再yaml然后转为json" class="headerlink" title="第一步：先强解析json,不行再yaml然后转为json"></a>第一步：先强解析json,不行再yaml然后转为json</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># src/main/java/burp/application/apitypes/swagger/ApiTypeSwagger.java</span><br><span class="line"> public Boolean urlAddPath(String apiDocumentUrl) &#123;</span><br><span class="line"> 。。。</span><br><span class="line"> 1.先强解析json,不行再yaml然后转为json</span><br><span class="line">try &#123;</span><br><span class="line">                element = JsonParser.parseString(resp);</span><br><span class="line">            &#125; catch (Exception var24) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                Yaml yaml = new Yaml(new SafeConstructor());</span><br><span class="line">                Object result = yaml.load(resp);</span><br><span class="line">                Gson gson = (new GsonBuilder()).create();</span><br><span class="line">                element = gson.toJsonTree(result);</span><br><span class="line">            &#125; catch (Exception var23) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>

<h5 id="第二步：如果有数据json分两种情况格式-element-isJsonArray-和element-isJsonObject"><a href="#第二步：如果有数据json分两种情况格式-element-isJsonArray-和element-isJsonObject" class="headerlink" title="第二步：如果有数据json分两种情况格式 element.isJsonArray()和element.isJsonObject()"></a>第二步：如果有数据json分两种情况格式 element.isJsonArray()和element.isJsonObject()</h5><p>isJsonArray())类型数据样例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// /swagger-resources  openapi 2.x [&#123;&quot;name&quot;:&quot;default&quot;,&quot;location&quot;:&quot;/v2/api-docs&quot;,&quot;swaggerVersion&quot;:&quot;2.0&quot;&#125;]</span><br></pre></td></tr></table></figure>
<p>(1) isJsonArray())处理逻辑，关键在location中取，取到的基本上就是这个网站swagger.json的地址，在urlAddPath处理下特征</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#src/main/java/burp/application/apitypes/swagger/ApiTypeSwagger.java</span><br><span class="line"><span class="keyword">if</span> (element.isJsonArray()) &#123;</span><br><span class="line">                    JsonArray ja = element.getAsJsonArray();</span><br><span class="line">                    <span class="keyword">if</span> (null != ja) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (JsonElement ae : ja) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (ae.isJsonObject()) &#123;</span><br><span class="line">                                JsonObject link = ae.getAsJsonObject();</span><br><span class="line">                                <span class="comment">// openapi 1 2 3 都可以从location中取。</span></span><br><span class="line">                                <span class="keyword">if</span> (!(link.get(<span class="string">&quot;location&quot;</span>) == null)) &#123;</span><br><span class="line">                                    try &#123;</span><br><span class="line">                                        String tmpurl = URLEncoder.encode(link.get(<span class="string">&quot;location&quot;</span>).getAsString(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                                        tmpurl = tmpurl.replace(<span class="string">&quot;%2F&quot;</span>, <span class="string">&quot;/&quot;</span>).replace(<span class="string">&quot;%3D&quot;</span>, <span class="string">&quot;=&quot;</span>).replace(<span class="string">&quot;%3F&quot;</span>, <span class="string">&quot;?&quot;</span>).replace(<span class="string">&quot;%40&quot;</span>, <span class="string">&quot;@&quot;</span>).replace(<span class="string">&quot;%3A&quot;</span>, <span class="string">&quot;:&quot;</span>);</span><br><span class="line">                                        this.urlAddPath(urlPath + tmpurl);</span><br><span class="line">                                        this.urlAddPath(urlBasePath + tmpurl);</span><br><span class="line">                                    &#125; catch (UnsupportedEncodingException e) &#123;</span><br><span class="line">                                        BurpExtender.getStderr().<span class="built_in">println</span>(CommonUtils.exceptionToString(e));</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure>


<p>(2 ) isJsonObject()处理逻辑,这中就是直接拿到swagger的数据里，依次匹配了paths、api等字段来保证他是正确数据，然后this.getApiDocuments().put(apiDocumentUrl, newHttpRequestResponse); 放入要进行文档解析的数组里</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#src/main/java/burp/application/apitypes/swagger/ApiTypeSwagger.java</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (element.isJsonObject()) &#123;</span><br><span class="line">                    JsonObject link = element.getAsJsonObject();</span><br><span class="line">                    <span class="keyword">if</span> (link.get(<span class="string">&quot;paths&quot;</span>) != null) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (link.get(<span class="string">&quot;paths&quot;</span>).isJsonObject() &amp;&amp; !this.getApiDocuments().containsKey(apiDocumentUrl)) &#123;</span><br><span class="line">                            this.getApiDocuments().put(apiDocumentUrl, newHttpRequestResponse);</span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (link.get(<span class="string">&quot;apis&quot;</span>) != null) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (link.get(<span class="string">&quot;basePath&quot;</span>) != null) &#123;</span><br><span class="line">                            isapiobject = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (link.get(<span class="string">&quot;apis&quot;</span>).isJsonArray()) &#123;</span><br><span class="line">                            JsonArray apisarray = link.get(<span class="string">&quot;apis&quot;</span>).getAsJsonArray();</span><br><span class="line">                            <span class="keyword">if</span> (null != apisarray) &#123;</span><br><span class="line">                                Iterator var37 = apisarray.iterator();</span><br><span class="line"></span><br><span class="line">                                while(var37.hasNext()) &#123;</span><br><span class="line">                                    JsonElement ae = (JsonElement)var37.next();</span><br><span class="line">                                    <span class="keyword">if</span> (ae.isJsonObject()) &#123;</span><br><span class="line">                                        JsonObject paths = ae.getAsJsonObject();</span><br><span class="line">                                        <span class="keyword">if</span> (paths.get(<span class="string">&quot;path&quot;</span>) != null) &#123;</span><br><span class="line">                                            <span class="keyword">if</span> (isapiobject) &#123;</span><br><span class="line">                                                <span class="keyword">if</span> (!this.getApiDocuments().containsKey(apiDocumentUrl)) &#123;</span><br><span class="line">                                                    this.getApiDocuments().put(apiDocumentUrl, newHttpRequestResponse);</span><br><span class="line">                                                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                                                &#125;</span><br><span class="line">                                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                                this.urlAddPath(CommonUtils.combineURLs(apiDocumentUrl, paths.get(<span class="string">&quot;path&quot;</span>).getAsString()));</span><br><span class="line">                                            &#125;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure>



<p>isJsonObject类型的数据样例</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /v2/api-docs  &#123;&quot;swagger&quot;:&quot;2.0&quot;,&quot;info&quot;:&#123;&quot;description&quot;:&quot;test&quot;,&quot;version&quot;:&quot;1.0&quot;,&quot;title&quot;:&quot;Java Swagger API 文档&quot;,&quot;license&quot;:&#123;&#125;&#125;,&quot;host&quot;:&quot;0.0.0.0:8091&quot;,&quot;basePath&quot;:&quot;/&quot;,&quot;tags&quot;:[&#123;&quot;name&quot;:&quot;deserialize&quot;,&quot;description&quot;:&quot;Deserialize&quot;&#125;,&#123;&quot;name&quot;:&quot;filter-by-pass&quot;,&quot;description&quot;:&quot;Filter By Pass&quot;&#125;,&#123;&quot;name&quot;:&quot;user-controller&quot;,&quot;description&quot;:&quot;User Controller&quot;&#125;,&#123;&quot;name&quot;:&quot;commandi&quot;,&quot;description&quot;:&quot;Commandi&quot;&#125;],&quot;paths&quot;:&#123;&quot;/command/exec/array&quot;:&#123;&quot;post&quot;:&#123;&quot;tags&quot;:[&quot;commandi&quot;],&quot;summary&quot;:&quot;命令执行&quot;,&quot;description&quot;:&quot;exec接受array参数&quot;,&quot;operationId&quot;:&quot;execArrayUsingPOST&quot;,&quot;consumes&quot;:[&quot;application/json&quot;],&quot;produces&quot;:[&quot;application/json&quot;],&quot;parameters&quot;:[&#123;&quot;in&quot;:&quot;body&quot;,&quot;name&quot;:&quot;path&quot;,&quot;description&quot;:&quot;path&quot;,&quot;required&quot;:true,&quot;schema&quot;:&#123;&quot;$ref&quot;:&quot;#/definitions/</span></span><br><span class="line"><span class="comment">// /api-docs    &#123;&quot;apiVersion&quot;:&quot;1.0&quot;,&quot;apis&quot;:[&#123;&quot;description&quot;:&quot;Basic Error Controller&quot;,&quot;path&quot;:&quot;/default/basic-error-controller&quot;,&quot;position&quot;:0&#125;,&#123;&quot;description&quot;:&quot;Commandi&quot;,&quot;path&quot;:&quot;/default/commandi&quot;,&quot;position&quot;:0&#125;,&#123;&quot;description&quot;:&quot;Deserialize&quot;,&quot;path&quot;:&quot;/default/deserialize&quot;,&quot;position&quot;:0&#125;,&#123;&quot;description&quot;:&quot;Filter By Pass&quot;,&quot;path&quot;:&quot;/default/filter-by-pass&quot;,&quot;position&quot;:0&#125;,&#123;&quot;description&quot;:&quot;User Controller&quot;,&quot;path&quot;:&quot;/default/user-controller&quot;,&quot;position&quot;:0&#125;],&quot;authorizations&quot;:&#123;&#125;,&quot;info&quot;:&#123;&quot;contact&quot;:&quot;cor0ps&quot;,&quot;description&quot;:&quot;漏洞仅仅做安全研究使用！&quot;,&quot;title&quot;:&quot;Java Range API 文档&quot;&#125;,&quot;swaggerVersion&quot;:&quot;1.2&quot;&#125;</span></span><br><span class="line">               &#125; </span><br></pre></td></tr></table></figure>
<h5 id="方法二-正则url解析"><a href="#方法二-正则url解析" class="headerlink" title="方法二 正则url解析"></a>方法二 正则url解析</h5><p>这个方法就是从拿到网站的返回包中，正则匹配两个特征来提取他引用数据地方的json路径</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#src/main/java/burp/application/apitypes/swagger/ApiTypeSwagger.java</span><br><span class="line">urlAddPath(String apiDocumentUrl)&#123;</span><br><span class="line"> <span class="comment">//正则去拿非java swagger html中的接口文档地址</span></span><br><span class="line">                Pattern pattern = Pattern.compile(<span class="string">&quot;url:(\\s*)\&quot;(.*?)\&quot;&quot;</span>);</span><br><span class="line">                Pattern pattern2 = Pattern.compile(<span class="string">&quot;discoveryPaths:(\\s*)arrayFrom\\(&#x27;(.*?)&#x27;\\)&quot;</span>);</span><br><span class="line">                Pattern pattern3 = Pattern.compile(<span class="string">&quot;\&quot;url\&quot;:(\\s*)\&quot;(.*?)\&quot;&quot;</span>);</span><br><span class="line">                Matcher matcher = pattern.matcher(resp);</span><br><span class="line">                Matcher matcher2 = pattern2.matcher(resp);</span><br><span class="line">                Matcher matcher3 = pattern3.matcher(resp);</span><br><span class="line">                String documentjsonyaml = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (documentjsonyaml.equals(<span class="string">&quot; &quot;</span>) || documentjsonyaml.isEmpty())</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        <span class="keyword">if</span> (documentjsonyaml.startsWith(<span class="string">&quot;./&quot;</span>))</span><br><span class="line">                            urlAddPath(apiDocumentUrl + (apiDocumentUrl.endsWith(<span class="string">&quot;/&quot;</span>) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;/&quot;</span>) + documentjsonyaml.substring(<span class="number">2</span>));</span><br><span class="line">                            <span class="comment">//如果是/开头说明可能是python swagger  不需要加/apidocs/路径</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (documentjsonyaml.startsWith(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">                            urlAddPath(urlPath + documentjsonyaml);</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (documentjsonyaml.startsWith(<span class="string">&quot;http&quot;</span>)) &#123;</span><br><span class="line">                            urlAddPath(documentjsonyaml);</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (apiDocumentUrl.endsWith(<span class="string">&quot;/swagger/&quot;</span>))<span class="comment">//像beego的swagger 则需要加上/swagger/路径</span></span><br><span class="line">                            urlAddPath(apiDocumentUrl + documentjsonyaml);</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            <span class="comment">//         若是根目录不带/  则判断后添加</span></span><br><span class="line">                            urlAddPath(urlPath + <span class="string">&quot;/&quot;</span> + documentjsonyaml);</span><br><span class="line">                    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="1-1-2-文档解析"><a href="#1-1-2-文档解析" class="headerlink" title="1.1.2 文档解析"></a>1.1.2 文档解析</h4><p>处理获取到的swagger数据类似isJsonObject的样例，对openapi 1 2 3  swagger根对象初始化，根据特征比如</p>
<ol>
<li><p>openapi 1.2 和2.0 都可以直接取basePath  openapi3没有basePath</p>
</li>
<li><p>openapi3  basePath在 servers的url中，url如http:&#x2F;xxx&#x2F;v1 格式  可以使用相对路径  也可以使用变量的形式</p>
</li>
<li><p>具体在 SwaggerParseObject()函数中写的非常详细,这里以openApi 3.0.1格式为例,会将所有paths里的内容解析为map,然后遍历map进行接下来的模拟器请处理</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#src/main/java/burp/application/apitypes/swagger/SwaggerObject.java</span><br><span class="line">public HashMap&lt;String, String&gt; SwaggerParseObject(JsonObject inputJsonobj, String _basePath) throws MalformedURLException &#123;</span><br><span class="line">       ...</span><br><span class="line">       <span class="keyword">if</span> (this.link.get(<span class="string">&quot;paths&quot;</span>) != null &amp;&amp; this.link.get(<span class="string">&quot;paths&quot;</span>).isJsonObject()) &#123;</span><br><span class="line">            JsonObject paths = this.link.get(<span class="string">&quot;paths&quot;</span>).getAsJsonObject();</span><br><span class="line">            Set&lt;Map.Entry&lt;String, JsonElement&gt;&gt; apiPaths = paths.getAsJsonObject().entrySet();</span><br><span class="line">            Iterator var19 = apiPaths.iterator();</span><br><span class="line"></span><br><span class="line">            label135:</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">   ![](https://prefect12.oss-cn-beijing.aliyuncs.com/2-12-2.png)</span><br><span class="line"></span><br><span class="line">#### 1.1.3 请求模拟</span><br><span class="line"></span><br><span class="line">1. 这部分主要是根据上一步的数据map 字段key:api路径 value:里边的值内容进行解析，3.0.1格式解析的字段包括parameters、requestBody俩部分。</span><br><span class="line">2.  this.Openapi23ParserObject会将字段内容生成好对象，方便 this.makeHttpRequest(); </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> #src&#x2F;main&#x2F;java&#x2F;burp&#x2F;application&#x2F;apitypes&#x2F;swagger&#x2F;SwaggerObject.java<br> if (((JsonElement)apiMethod.getValue()).getAsJsonObject().get(“parameters”) !&#x3D; null) {<br>                        reqparamnull &#x3D; false;<br>                        JsonArray apiParameters &#x3D; ((JsonElement)apiMethod.getValue()).getAsJsonObject().get(“parameters”).getAsJsonArray();<br>                        if (apiParameters.size() &#x3D;&#x3D; 0) {<br>                            reqparamnull &#x3D; true;<br>                        }</p>
<pre><code>                    if (null != apiParameters) &#123;
                        Iterator var28 = apiParameters.iterator();

                        while(var28.hasNext()) &#123;
                            JsonElement apiParameter = (JsonElement)var28.next();
                            if (!apiParameter.isJsonNull()) &#123;
                                this.params.clear();
                                this.in = &quot;&quot;;
                                this.Openapi23ParserObject(&quot;&quot;, apiParameter.getAsJsonObject()); //处理数据转换为对象
                                this.makeHttpRequest(); //根据类型如parameters 模拟生成参数
                            &#125;
                        &#125;
                    &#125;
                &#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">this.makeHttpRequest();  主要用于模拟制造参数，比如数据就会根据this.in的类型来模拟生成什么样的值，那么this.in是如何生成的呢？</span><br><span class="line"></span><br><span class="line">​```go</span><br><span class="line">#src/main/java/burp/application/apitypes/swagger/SwaggerObject.java</span><br><span class="line">switch (this.in) &#123;</span><br><span class="line">               ...</span><br><span class="line">                    case &quot;query&quot;:</span><br><span class="line">                        this.para_querystr = this.para_querystr + String.format(&quot;&amp;%s=%s&quot;, _para_name, replaceStr(_para_format));</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;formdata&quot;:</span><br><span class="line">                    case &quot;form&quot;:</span><br><span class="line">                        if (!this.isctset) &#123;</span><br><span class="line">                            this.isctset = true;</span><br><span class="line">                            this.newheaders.add(&quot;Content-Type: multipart/form-data; boundary=&quot; + this.boundary);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        if (_para_format.toLowerCase().contains(&quot;file&quot;)) &#123;</span><br><span class="line">                            this.para_bodystr = this.para_bodystr + &quot;--&quot; + this.boundary + &quot;\r\n&quot; + String.format(&quot;Content-Disposition: form-data; name=\&quot;%s\&quot;; filename=\&quot;tmp.jpg\&quot;&quot;, _para_name) + &quot;\r\n&quot; + &quot;Content-Type: application/octet-stream&quot; + &quot;\r\n&quot; + &quot;\r\n&quot; + &quot;GIF89aaaaaaaaaaaaaaaaaaaa&quot; + &quot;\r\n&quot;;</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            this.para_bodystr = this.para_bodystr + &quot;--&quot; + this.boundary + &quot;\r\n&quot; + String.format(&quot;Content-Disposition: form-data; name=\&quot;%s\&quot;;&quot;, _para_name) + &quot;\r\n&quot; + &quot;\r\n&quot; + replaceStr(_para_format) + &quot;\r\n&quot;;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;header&quot;:</span><br><span class="line">                        this.newheaders.add(_para_name + &quot;: &quot; + replaceStr(_para_format));</span><br><span class="line">                        break;</span><br><span class="line">                 </span><br><span class="line">        ],</span><br></pre></td></tr></table></figure>

<p>this.in一般是再上一步this.Openapi23ParserObject转换为对象的过程中生成的具体逻辑如下,而且不同版本的openapi用到的解析OpenParserObject也是不一样的有好几个。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#src/main/java/burp/application/apitypes/swagger/SwaggerObject.java</span><br><span class="line">private void Openapi23ParserObject(String para_name, JsonObject apiParam) &#123;</span><br><span class="line">     String para_format = &quot;&quot;;</span><br><span class="line">     String is_required = &quot;&quot;;</span><br><span class="line">     if (apiParam.get(&quot;name&quot;) != null) &#123;</span><br><span class="line">         para_name = apiParam.get(&quot;name&quot;).getAsString();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     if (apiParam.get(&quot;in&quot;) != null) &#123;</span><br><span class="line">         this.in = apiParam.get(&quot;in&quot;).getAsString().toLowerCase();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     if (apiParam.get(&quot;required&quot;) != null) &#123;</span><br><span class="line">         if (apiParam.get(&quot;required&quot;).isJsonPrimitive() &amp;&amp; apiParam.get(&quot;required&quot;).getAsBoolean()) &#123;</span><br><span class="line">             is_required = &quot;*&quot;;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125; else &#123;</span><br><span class="line">         is_required = &quot;&quot;;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-1-4-测试效果"><a href="#1-1-4-测试效果" class="headerlink" title="1.1.4 测试效果"></a>1.1.4 测试效果</h4><p>测试中存在一些问题比如swagger-ui-init.js（很小部分，一般是线上测试的环境）,这种其实是流量进来的，插件对其检测并未解析到内容</p>
<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/2-13-2.png"></p>
<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/2-13-3.png"></p>
<h3 id="1-2-检测spring-actuator"><a href="#1-2-检测spring-actuator" class="headerlink" title="1.2 检测spring actuator"></a>1.2 检测spring actuator</h3><h4 id="1-2-1-特征匹配"><a href="#1-2-1-特征匹配" class="headerlink" title="1.2.1 特征匹配"></a>1.2.1 特征匹配</h4><p>同理上一步，这块是spring actuator业务类的实现逻辑，url目标进来也是先匹配特征</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#src/main/java/burp/application/apitypes/actuator/ApiTypeActuator.java</span><br><span class="line">public Boolean isFingerprintMatch() &#123;</span><br><span class="line"> while(var6.hasNext()) &#123;</span><br><span class="line">                        String urlPath = (String)var6.next();</span><br><span class="line">                        Boolean result = this.urlAddPath(urlPath + <span class="string">&quot;/actuator&quot;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (result != null &amp;&amp; !result) &#123;</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/%61%63%74%75%61%74%6f%72&quot;</span>);</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/actuator.json&quot;</span>);</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/actuator;.js&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        result = this.urlAddPath(urlPath + <span class="string">&quot;/mappings&quot;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (result != null &amp;&amp; !result) &#123;</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/%6d%61%70%70%69%6e%67%73&quot;</span>);</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/mappings.json&quot;</span>);</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/mappings;.js&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> this.getApiDocuments().size() != <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="actuator特征页面-没有swagger复杂，从逻辑上看-就是将上边输入的path里边进行一些json解析，采集到了字段就说明存在泄露"><a href="#actuator特征页面-没有swagger复杂，从逻辑上看-就是将上边输入的path里边进行一些json解析，采集到了字段就说明存在泄露" class="headerlink" title="actuator特征页面,没有swagger复杂，从逻辑上看,就是将上边输入的path里边进行一些json解析，采集到了字段就说明存在泄露"></a>actuator特征页面,没有swagger复杂，从逻辑上看,就是将上边输入的path里边进行一些json解析，采集到了字段就说明存在泄露</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#src/main/java/burp/application/apitypes/actuator/ApiTypeActuator.java</span><br><span class="line">public Boolean urlAddPath(String apiDocumentUrl) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                JsonElement element = JsonParser.parseString(resp);</span><br><span class="line">                <span class="keyword">if</span> (element.isJsonObject()) &#123;</span><br><span class="line">                    JsonObject jsonObject = element.getAsJsonObject();</span><br><span class="line">                    <span class="keyword">if</span> (jsonObject.get(<span class="string">&quot;_links&quot;</span>) != null || jsonObject.get(<span class="string">&quot;/**/favicon.ico&quot;</span>) != null || jsonObject.get(<span class="string">&quot;contexts&quot;</span>) != null) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (jsonObject.get(<span class="string">&quot;_links&quot;</span>) != null &amp;&amp; jsonObject.get(<span class="string">&quot;_links&quot;</span>).getAsJsonObject().get(<span class="string">&quot;mappings&quot;</span>) != null) &#123;</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/mappings&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        this.getApiDocuments().put(apiDocumentUrl, newHttpRequestResponse);</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>


<h4 id="1-2-2-文档解析"><a href="#1-2-2-文档解析" class="headerlink" title="1.2.2 文档解析"></a>1.2.2 文档解析</h4><p>actuator 的文档解析和模拟发包是在一起的，通过界面UI开关来判断是否发送模拟包，根据代码来看，一般都是写get请求没有模拟参数.</p>
<p>对文档解析主要通过_links 、&#x2F;**&#x2F;favicon.ico、contexts着手。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#src/main/java/burp/application/apitypes/actuator/ApiTypeActuator.java</span><br><span class="line">public ArrayList&lt;ApiEndpoint&gt; parseApiDocument(IHttpRequestResponse apiDocument, IHttpRequestResponse basePath, boolean isTargetScan) &#123;</span><br><span class="line"><span class="keyword">if</span> (jsonObject.get(<span class="string">&quot;_links&quot;</span>) != null) &#123;</span><br><span class="line">                    JsonObject links = jsonObject.get(<span class="string">&quot;_links&quot;</span>).getAsJsonObject();</span><br><span class="line">                        String uri = hrefUrl.getPath();</span><br><span class="line">                        <span class="keyword">if</span> (!path.contains(<span class="string">&quot;&#123;&quot;</span>) &amp;&amp; !path.contains(<span class="string">&quot;&#125;&quot;</span>)) &#123;</span><br><span class="line">                            try &#123;</span><br><span class="line">                                newRequest = this.helpers.buildHttpRequest(<span class="built_in">new</span> URL(path));</span><br><span class="line">                                <span class="keyword">if</span> (basePath == null) &#123;</span><br><span class="line">                                    newRequest = CookieManager.getRequest(apiDocument, newRequest);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    newRequest = CookieManager.getRequest(basePath, newRequest);</span><br><span class="line">                                &#125;</span><br><span class="line">                                ...</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    String href;</span><br><span class="line">                    <span class="keyword">if</span> (jsonObject.get(<span class="string">&quot;/**/favicon.ico&quot;</span>) != null) &#123;</span><br><span class="line">                        try &#123;</span><br><span class="line">                            Set&lt;Map.Entry&lt;String, JsonElement&gt;&gt; endpoints = jsonObject.entrySet();</span><br><span class="line">                            Iterator var31 = endpoints.iterator();</span><br><span class="line"></span><br><span class="line">                            while(var31.hasNext()) &#123;</span><br><span class="line">                                Map.Entry&lt;String, JsonElement&gt; endpoint = (Map.Entry)var31.next();</span><br><span class="line">                                href = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                                path = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">                                try &#123;</span><br><span class="line">                                    Matcher matcher = pattern.matcher((CharSequence)endpoint.getKey());</span><br><span class="line">                                    <span class="keyword">if</span> (matcher.find()) &#123;</span><br><span class="line">                                        path = matcher.group().split(<span class="string">&quot; &quot;</span>)[<span class="number">0</span>];</span><br><span class="line">                                        path = path.endsWith(<span class="string">&quot;]&quot;</span>) ? path.substring(<span class="number">1</span>, path.length() - <span class="number">1</span>) : path.substring(<span class="number">1</span>);</span><br><span class="line">                                        <span class="keyword">if</span> (basePath == null) &#123;</span><br><span class="line">                                            href = CommonUtils.combineURLs(UrlWithoutFilename.substring(<span class="number">0</span>, UrlWithoutFilename.length() - <span class="number">1</span>), path);</span><br><span class="line">                                     ...</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (jsonObject.get(<span class="string">&quot;contexts&quot;</span>) != null) &#123;</span><br><span class="line">                        Matcher matcher = patternpath.matcher(body);</span><br><span class="line"></span><br><span class="line">                        String uri = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">                        while(matcher.find()) &#123;</span><br><span class="line">                            href = matcher.group(<span class="number">0</span>).replace(<span class="string">&quot;\&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                            <span class="keyword">if</span> (!href.endsWith(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (basePath == null) &#123;</span><br><span class="line">                                    href = CommonUtils.combineURLs(UrlWithoutFilename.substring(<span class="number">0</span>, UrlWithoutFilename.length() - <span class="number">10</span>), href);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    href = CommonUtils.combineURLs(BaseURLPath, href);</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                                uri = href;</span><br><span class="line"></span><br><span class="line">                                try &#123;</span><br><span class="line">                                    newRequest = this.helpers.buildHttpRequest(<span class="built_in">new</span> URL(href));</span><br><span class="line">                                    <span class="keyword">if</span> (basePath == null) &#123;</span><br><span class="line">                                        newRequest = CookieManager.getRequest(apiDocument, newRequest);</span><br><span class="line">                                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                        newRequest = CookieManager.getRequest(basePath, newRequest);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                 ...</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-soap检测"><a href="#1-3-soap检测" class="headerlink" title="1.3 soap检测"></a>1.3 soap检测</h3><h4 id="1-3-1-简介"><a href="#1-3-1-简介" class="headerlink" title="1.3.1 简介"></a>1.3.1 简介</h4><p>SOAP 是基于 XML 的简易协议，可使应用程序在 HTTP 之上进行信息交换。</p>
<p><a target="_blank" rel="noopener" href="http://52.209.189.24/VatatWebService.asmx?WSDL">http://52.209.189.24/VatatWebService.asmx?WSDL</a></p>
<p>SOAP由三部分组成：</p>
<p>SOAP消息，它定义了一个SOAP消息的框架，用于表达数据内容。<br>一条SOAP消息就是一个XML文档，包含以下元素<br>Envelope：必须的。它SOAP消息的根元素。就是它把 XML 文档定义为 SOAP 消息。<br>Header：可选的。它是一个扩展，可用于包含有关 SOAP 消息的应用程序的专用信息(比如身份验证、支付等)<br>Body：必须的。它包含SOAP消息的正文<br>Fault：可选的。它用来携带错误或状态信息</p>
<p>在平常使用走的是SOAP协议时，一般用户（或后台）会给你一个WSDL文件里边包含xml相关的信息。</p>
<p>WSDL是一个用于精确描述Web服务的文档，WSDL文档是一个遵循WSDL-XML模式的XML文档。WSDL 文档将Web服务定义为服务访问点或端口的集合。因此在扫描SOAP泄露时也会找服务关于WSDL特征标志。</p>
<p>比如：<br><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/2-13-9.png"></p>
<p>实例：<a target="_blank" rel="noopener" href="http://52.209.189.24/VatatWebService.asmx?WSDL">http://52.209.189.24/VatatWebService.asmx?WSDL</a></p>
<h4 id="1-3-2-特征匹配"><a href="#1-3-2-特征匹配" class="headerlink" title="1.3.2 特征匹配"></a>1.3.2 特征匹配</h4><p>同样进来的目标 先通过 isFingerprintMatch()过滤存活的特征url路径，然后进入urlAddPath进行特征解析</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># src/main/java/burp/application/apitypes/soap/ApiTypeSoap.java</span><br><span class="line">public Boolean isFingerprintMatch() &#123;</span><br><span class="line">        URL url = this.helpers.analyzeRequest(this.baseRequestResponse).getUrl();</span><br><span class="line">        ArrayList&lt;String&gt; urlList = <span class="built_in">new</span> ArrayList();</span><br><span class="line">        Set&lt;String&gt; UrlPathList = CommonUtils.getUrlPathList(url);</span><br><span class="line">        Iterator iterator = UrlPathList.iterator();</span><br><span class="line">        while(<span class="literal">true</span>) &#123;</span><br><span class="line">            String tmpurl;</span><br><span class="line">            do &#123;</span><br><span class="line">                <span class="keyword">if</span> (!iterator.hasNext()) &#123;</span><br><span class="line">                    this.urlAddPath(url.toString());</span><br><span class="line">                    Iterator var6 = urlList.iterator();</span><br><span class="line">                    while(var6.hasNext()) &#123;</span><br><span class="line">                        String urlPath = (String)var6.next();</span><br><span class="line">                        <span class="keyword">if</span> (!this.urlAddPath(urlPath + <span class="string">&quot;/service&quot;</span>)) &#123;</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/services&quot;</span>);</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/webservices&quot;</span>);</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/webservice&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> this.getApiDocuments().size() != <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="urlAddPath函数流程如下"><a href="#urlAddPath函数流程如下" class="headerlink" title="urlAddPath函数流程如下"></a>urlAddPath函数流程如下</h4><p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/25-2-13-7.png"></p>
<h4 id="特征1，会给当前url添加-wsdl作为下一步的解析api文档路径，特征二的目标预设应该为html文件通过正则抓取soap文档地址"><a href="#特征1，会给当前url添加-wsdl作为下一步的解析api文档路径，特征二的目标预设应该为html文件通过正则抓取soap文档地址" class="headerlink" title="特征1，会给当前url添加?wsdl作为下一步的解析api文档路径，特征二的目标预设应该为html文件通过正则抓取soap文档地址"></a>特征1，会给当前url添加?wsdl作为下一步的解析api文档路径，特征二的目标预设应该为html文件通过正则抓取soap文档地址</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># src/main/java/burp/application/apitypes/soap/ApiTypeSoap.java</span><br><span class="line">public Boolean urlAddPath(String apiDocumentUrl) &#123;</span><br><span class="line">    <span class="comment">//特征1</span></span><br><span class="line">     <span class="keyword">if</span> (resp.contains(<span class="string">&quot;soap:Server&quot;</span>) || resp.contains(<span class="string">&quot;xmlns:soap&quot;</span>)) &#123;</span><br><span class="line">                apidocument = currentUrl + (currentUrl.endsWith(<span class="string">&quot;/&quot;</span>) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;/&quot;</span>) + <span class="string">&quot;?wsdl&quot;</span>;</span><br><span class="line">                try &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!this.getApiDocuments().containsKey(apidocument)) &#123;</span><br><span class="line">                        newRequest = this.helpers.buildHttpRequest(<span class="built_in">new</span> URL(apidocument));</span><br><span class="line">                        newHttpRequestResponse = CookieManager.makeHttpRequest(this.baseRequestResponse, newRequest);</span><br><span class="line">                        this.getApiDocuments().put(apidocument, newHttpRequestResponse);</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (MalformedURLException var13) &#123;</span><br><span class="line">                    throw <span class="built_in">new</span> ApiKitRuntimeException(var13);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//特征2</span></span><br><span class="line">    resp = <span class="built_in">new</span> String(CommonUtils.getHttpResponseBody(newHttpRequestResponse.getResponse()));</span><br><span class="line">            Pattern pattern = Pattern.compile(<span class="string">&quot;href=\&quot;([^\&quot;]*)\\?wsdl\&quot;&gt;&quot;</span>);</span><br><span class="line">            Matcher matcher = pattern.matcher(resp);</span><br><span class="line"></span><br><span class="line">            while(matcher.find()) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    apidocument = matcher.group(<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">if</span> (apidocument.startsWith(<span class="string">&quot;http&quot;</span>)) &#123;</span><br><span class="line">                        apidocument = apidocument + <span class="string">&quot;?wsdl&quot;</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        apidocument = this.helpers.analyzeRequest(newHttpRequestResponse).getUrl().toString() + (this.helpers.analyzeRequest(newHttpRequestResponse).getUrl().toString().endsWith(<span class="string">&quot;/&quot;</span>) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;/&quot;</span>) + apidocument + <span class="string">&quot;?wsdl&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (!this.getApiDocuments().containsKey(apidocument)) &#123;</span><br><span class="line">                        newRequest = this.helpers.buildHttpRequest(<span class="built_in">new</span> URL(apidocument));</span><br><span class="line">                        IHttpRequestResponse tempRequestResponse = CookieManager.makeHttpRequest(this.baseRequestResponse, newRequest);</span><br><span class="line">                        this.getApiDocuments().put(apidocument, tempRequestResponse);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (Exception var12) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-3-文档解析-模拟发包"><a href="#1-3-3-文档解析-模拟发包" class="headerlink" title="1.3.3 文档解析&#x2F;模拟发包"></a>1.3.3 文档解析&#x2F;模拟发包</h4><p>SOAP在代码中看到额外添加了个jar包，名为soa-model-core-1.6.4-SNAPSHOT-patched-jar-with-dependencies.jar ，在代码中看这个jar包主要做的就是传入soap文档url，它去解析文档，并且自带模拟请求方法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># src/main/java/burp/application/apitypes/soap/WsdlParser.java</span><br><span class="line">public static ArrayList&lt;ApiEndpoint&gt; parseWsdl(IHttpRequestResponse apiDocument, IHttpRequestResponse basePath, boolean isTargetScan) &#123;</span><br><span class="line">     <span class="comment">//传入url解析内容  </span></span><br><span class="line">     WSDLParser parser = <span class="built_in">new</span> WSDLParser();</span><br><span class="line">      Definitions definitions = parser.parse(APIdocumenturl);</span><br><span class="line">     ...</span><br><span class="line">     <span class="comment">//模拟请求</span></span><br><span class="line">       try &#123;</span><br><span class="line">                            StringWriter writer = <span class="built_in">new</span> StringWriter();</span><br><span class="line">                            SOARequestCreator creator = <span class="built_in">new</span> SOARequestCreator(definitions, <span class="built_in">new</span> RequestTemplateCreator(), <span class="built_in">new</span> MarkupBuilder(writer));</span><br><span class="line">                            creator.createRequest(port.getName(), operation.getName(), port.getBinding().getName());</span><br><span class="line">                            List&lt;String&gt; tempHeaders = <span class="built_in">new</span> ArrayList(newHeaders);</span><br><span class="line">                            tempHeaders.add(<span class="string">&quot;SOAPAction: &quot;</span> + operation.getOperation().getSoapAction());</span><br><span class="line">                            <span class="keyword">if</span> (isTargetScan) &#123;</span><br><span class="line">                                HttpRequestFormator.TrimDupHeader(tempHeaders);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            apiRequest = helpers.buildHttpMessage(tempHeaders, writer.toString().getBytes());</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                       ...</span><br><span class="line">                    &#125;</span><br><span class="line">                    tempRequestResponse.setRequest(apiRequest);</span><br><span class="line">                    tempRequestResponse.sendRequest();</span><br><span class="line">                    apiEndpoints.add(<span class="built_in">new</span> ApiEndpoint(operation.getName(), tempRequestResponse));</span><br><span class="line">                &#125;</span><br><span class="line">     </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-4-测试效果"><a href="#1-3-4-测试效果" class="headerlink" title="1.3.4 测试效果"></a>1.3.4 测试效果</h4><p>测试中发现会有问题，比如<a target="_blank" rel="noopener" href="http://52.209.189.24/VatatWebService.asmx?WSDL%E5%B7%B2%E7%BB%8F%E6%9C%89wsdl%E4%BA%86%EF%BC%8C%E4%BD%86%E6%98%AF%E8%BF%98%E4%BC%9A%E5%8A%A0%EF%BC%8C%E5%AF%BC%E8%87%B4%E8%A7%A3%E6%9E%90%E6%8A%A5%E9%94%99%EF%BC%8C%E5%9C%A8%E8%A7%A3%E6%9E%90%E6%96%87%E6%A1%A3%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%8D%A1%E4%BD%8F%EF%BC%8C%E5%AF%BC%E8%87%B4%E5%90%8E%E8%BE%B9%E7%BB%93%E6%9E%9C%E5%B1%95%E7%A4%BA%E5%A4%B1%E8%B4%A5%E3%80%82">http://52.209.189.24/VatatWebService.asmx?WSDL已经有wsdl了，但是还会加，导致解析报错，在解析文档过程中卡住，导致后边结果展示失败。</a></p>
<p>原因还是特征1对于目标url处理有些简单粗暴了,不管是否已经以wsdl结尾了，还是加上?wsdl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apidocument = currentUrl + (currentUrl.endsWith(&quot;/&quot;) ? &quot;&quot; : &quot;/&quot;) + &quot;?wsdl&quot;;</span><br></pre></td></tr></table></figure>




<h3 id="1-4-graphql检测"><a href="#1-4-graphql检测" class="headerlink" title="1.4 graphql检测"></a>1.4 graphql检测</h3><h4 id="1-4-1-简介"><a href="#1-4-1-简介" class="headerlink" title="1.4.1 简介"></a>1.4.1 简介</h4><p>GraphQL 是一种 API 查询语言，旨在促进客户端和服务器之间的高效通信。它使用户能够准确指定他们在响应中所需的数据，从而有助于避免有时使用 REST API 看到的大型响应对象和多个调用。</p>
<h5 id="内省攻击"><a href="#内省攻击" class="headerlink" title="内省攻击"></a>内省攻击</h5><p>内省攻击是一种针对GraphQL API的攻击方法，利用了GraphQL的内省能力。GraphQL的内省（introspection）是指通过特定的查询来获取有关GraphQL模式的信息，包括可用的类型、字段、关系等。攻击者可以利用内省功能来了解目标GraphQL API的结构，从而更好地进行后续攻击。</p>
<p>以下是一些常见的内省攻击方法</p>
<p>简短点的</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;query&quot;</span>: <span class="string">&quot;&#123;__schema&#123;queryType&#123;name&#125;&#125;&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>复杂点的，功能都一样</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;__schema&#123;queryType&#123;name&#125;mutationType&#123;name&#125;subscriptionType&#123;name&#125;types&#123;...FullType&#125;directives&#123;name description locations args&#123;...InputValue&#125;&#125;&#125;&#125;fragment FullType on __Type&#123;kind name description fields(includeDeprecated:<span class="literal">true</span>)&#123;name description args&#123;...InputValue&#125;<span class="keyword">type</span>&#123;...TypeRef&#125;isDeprecated deprecationReason&#125;inputFields&#123;...InputValue&#125;interfaces&#123;...TypeRef&#125;enumValues(includeDeprecated:<span class="literal">true</span>)&#123;name description isDeprecated deprecationReason&#125;possibleTypes&#123;...TypeRef&#125;&#125;fragment InputValue on __InputValue&#123;name description <span class="keyword">type</span>&#123;...TypeRef&#125;defaultValue&#125;fragment TypeRef on __Type&#123;kind name ofType&#123;kind name ofType&#123;kind name ofType&#123;kind name ofType&#123;kind name ofType&#123;kind name ofType&#123;kind name ofType&#123;kind name&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>效果，可以理解如果目标开启了这个内省模式，通过上述payload可以看到他写的所有ql参数查询内容等信息</p>
<p><img src="https://prefect12.oss-cn-beijing.aliyuncs.com/2-14-1.png"></p>
<h4 id="1-4-2-特征匹配"><a href="#1-4-2-特征匹配" class="headerlink" title="1.4.2 特征匹配"></a>1.4.2 特征匹配</h4><p>同样进来的目标 先通过 isFingerprintMatch()过滤存活的特征url路径，然后进入urlAddPath进行特征解析,。</p>
<p>TIPS：那个&#x2F;根目录是我加的，测试中发现他对这种直接目标测不出来，例如url为：<a target="_blank" rel="noopener" href="http://nrep-graphql.numerous.cloud/">http://nrep-graphql.numerous.cloud/</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># src/main/java/burp/application/apitypes/graphql/ApiTypeGraphQL.java</span><br><span class="line">public Boolean isFingerprintMatch() &#123;</span><br><span class="line">    ...</span><br><span class="line">        while(<span class="literal">true</span>) &#123;</span><br><span class="line">            String tmpurl;</span><br><span class="line">            do &#123;</span><br><span class="line">                <span class="keyword">if</span> (!iterator.hasNext()) &#123;</span><br><span class="line">                    Iterator var6 = urlList.iterator();</span><br><span class="line"></span><br><span class="line">                    while(var6.hasNext()) &#123;</span><br><span class="line">                        String urlPath = (String)var6.next();</span><br><span class="line">                        this.urlAddPath(urlPath + <span class="string">&quot;/&quot;</span>);</span><br><span class="line">                        this.urlAddPath(urlPath + <span class="string">&quot;/graphql&quot;</span>);</span><br><span class="line">                        this.urlAddPath(urlPath + <span class="string">&quot;/%67%72%61%70%68%71%6c&quot;</span>);</span><br><span class="line">                        this.urlAddPath(urlPath + <span class="string">&quot;/graphql.php&quot;</span>);</span><br><span class="line">                        this.urlAddPath(urlPath + <span class="string">&quot;/graphiql&quot;</span>);</span><br><span class="line">                        this.urlAddPath(urlPath + <span class="string">&quot;/%67%72%61%70%68%69%71%6c&quot;</span>);</span><br><span class="line">                        this.urlAddPath(urlPath + <span class="string">&quot;/graphiql.php&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> this.getApiDocuments().size() != <span class="number">0</span>;</span><br><span class="line">                &#125;...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="urlAddPath特征逻辑主要在进行内省攻击，查看请求结果进行判断是否存在泄露"><a href="#urlAddPath特征逻辑主要在进行内省攻击，查看请求结果进行判断是否存在泄露" class="headerlink" title="urlAddPath特征逻辑主要在进行内省攻击，查看请求结果进行判断是否存在泄露"></a>urlAddPath特征逻辑主要在进行内省攻击，查看请求结果进行判断是否存在泄露</h5><p>函数接收请求地址，通过POST请求，body携带base64编码后的字符串进行访问，如果返回200，且内容中包含data或者__schema表示返回了所有参数，存在泄露。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># src/main/java/burp/application/apitypes/graphql/ApiTypeGraphQL.java</span><br><span class="line">public Boolean urlAddPath(String apiDocumentUrl) &#123;</span><br><span class="line">      ....</span><br><span class="line">        List&lt;String&gt; headers = this.helpers.analyzeRequest(newRequest).getHeaders();</span><br><span class="line">        List&lt;String&gt; httpFirstLine = Arrays.asList(((String)headers.get(<span class="number">0</span>)).split(<span class="string">&quot; &quot;</span>));</span><br><span class="line">        httpFirstLine.set(<span class="number">0</span>, <span class="string">&quot;POST&quot;</span>);</span><br><span class="line">        headers.set(<span class="number">0</span>, String.join(<span class="string">&quot; &quot;</span>, httpFirstLine));</span><br><span class="line">        headers.add(<span class="string">&quot;Content-Type: application/json&quot;</span>);</span><br><span class="line">        JsonObject jsonBody = <span class="built_in">new</span> JsonObject();</span><br><span class="line">        IExtensionHelpers var10006 = this.helpers;</span><br><span class="line">        this.getClass();</span><br><span class="line">        jsonBody.add(<span class="string">&quot;query&quot;</span>, <span class="built_in">new</span> JsonPrimitive(<span class="built_in">new</span> String(var10006.base64Decode(<span class="string">&quot;xxx&quot;</span>))));</span><br><span class="line">        newRequest = this.helpers.buildHttpMessage(headers, (<span class="built_in">new</span> Gson()).toJson(jsonBody).getBytes());</span><br><span class="line">        IHttpRequestResponse newHttpRequestResponse = CookieManager.makeHttpRequest(this.baseRequestResponse, newRequest);</span><br><span class="line">        String Respone=newHttpRequestResponse.getResponse().toString();</span><br><span class="line">        <span class="keyword">if</span> (this.helpers.analyzeResponse(newHttpRequestResponse.getResponse()).getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (this.isPassive) &#123;</span><br><span class="line">                <span class="keyword">if</span> (scannedUrl.get(this.helpers.analyzeRequest(newHttpRequestResponse).getUrl().toString()) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                scannedUrl.add(this.helpers.analyzeRequest(newHttpRequestResponse).getUrl().toString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            String responseJSON = <span class="built_in">new</span> String(CommonUtils.getHttpResponseBody(newHttpRequestResponse.getResponse()));</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                JsonElement element = JsonParser.parseString(responseJSON);</span><br><span class="line">                <span class="keyword">if</span> (element.isJsonObject()) &#123;</span><br><span class="line">                    JsonObject jsonObject = element.getAsJsonObject();</span><br><span class="line">                    <span class="keyword">if</span> (!jsonObject.get(<span class="string">&quot;data&quot;</span>).isJsonNull() &amp;&amp; !jsonObject.get(<span class="string">&quot;data&quot;</span>).getAsJsonObject().get(<span class="string">&quot;__schema&quot;</span>).isJsonNull()) &#123;</span><br><span class="line">                        this.getApiDocuments().put(apiDocumentUrl, newHttpRequestResponse);</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (Exception var11) &#123;</span><br><span class="line">                System.out.<span class="built_in">println</span>(var11.getMessage());</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>那么base64编码内容是什么？经过解码后发现就是一个内省攻击的payload,从代码里调式后扣出来的完整请求包如下：</p>
<p>思考：从网上参考payload有三种，可以改为每次测试三个payload，防止一个payload由于网站兼容性问题漏报</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/<span class="number">1.1</span></span><br><span class="line">Host: nrep-graphql.numerous.cloud</span><br><span class="line">Content-Length: <span class="number">1555</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">133.0</span><span class="number">.0</span><span class="number">.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">accept: application/json, multipart/mixed</span><br><span class="line">content-<span class="keyword">type</span>: application/json</span><br><span class="line">Origin: http:<span class="comment">//nrep-graphql.numerous.cloud</span></span><br><span class="line">Referer: http:<span class="comment">//nrep-graphql.numerous.cloud/</span></span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.9</span></span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;query&quot;</span>:<span class="string">&quot;query Query &#123;\n    __schema &#123;\n      queryType &#123; name &#125;\n      mutationType &#123; name &#125;\n      subscriptionType &#123; name &#125;\n      types &#123;\n        ...FullType\n      &#125;\n      directives &#123;\n        name\n        description\n        locations\n        args &#123;\n          ...InputValue\n        &#125;\n      &#125;\n    &#125;\n  &#125;\n\n  fragment FullType on __Type &#123;\n    kind\n    name\n    description\n    fields(includeDeprecated: true) &#123;\n      name\n      description\n      args &#123;\n        ...InputValue\n      &#125;\n      type &#123;\n        ...TypeRef\n      &#125;\n      isDeprecated\n      deprecationReason\n    &#125;\n    inputFields &#123;\n      ...InputValue\n    &#125;\n    interfaces &#123;\n      ...TypeRef\n    &#125;\n    enumValues(includeDeprecated: true) &#123;\n      name\n      description\n      isDeprecated\n      deprecationReason\n    &#125;\n    possibleTypes &#123;\n      ...TypeRef\n    &#125;\n  &#125;\n\n  fragment InputValue on __InputValue &#123;\n    name\n    description\n    type &#123; ...TypeRef &#125;\n    defaultValue\n  &#125;\n\n  fragment TypeRef on __Type &#123;\n    kind\n    name\n    ofType &#123;\n      kind\n      name\n      ofType &#123;\n        kind\n        name\n        ofType &#123;\n          kind\n          name\n          ofType &#123;\n            kind\n            name\n            ofType &#123;\n              kind\n              name\n              ofType &#123;\n                kind\n                name\n                ofType &#123;\n                  kind\n                  name\n                &#125;\n              &#125;\n            &#125;\n          &#125;\n        &#125;\n      &#125;\n    &#125;\n  &#125;&quot;</span>,<span class="string">&quot;operationName&quot;</span>:<span class="string">&quot;Query&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-4-3-文档解析"><a href="#1-4-3-文档解析" class="headerlink" title="1.4.3 文档解析"></a>1.4.3 文档解析</h5><p>这边的逻辑还是比较多的，先梳理一下文档内容，首先是数据里的types字段，表示数据的类型</p>
<p>再细分下，下一步要关注的是kind字段，根据kind字段我们可以知道它定义了什么，以及怎么做的。</p>
<p>GraphQL 的 types下的<code>kind</code> 主要有以下几种类型：</p>
<ul>
<li><p><strong>OBJECT</strong>：对象类型</p>
</li>
<li><p><strong>INTERFACE</strong>：接口类型</p>
</li>
<li><p><strong>UNION</strong>：联合类型</p>
</li>
<li><p><strong>SCALAR</strong>：标量类型</p>
</li>
<li><p><strong>ENUM</strong>：枚举类型</p>
</li>
<li><p><strong>INPUT_OBJECT</strong>：输入对象类型</p>
</li>
<li><p><strong>LIST</strong>：列表类型</p>
</li>
<li><p><strong>NON_NULL</strong>：非空类型</p>
</li>
<li><p><strong>自定义 SCALAR</strong>：自定义标量类型</p>
<p>可参考：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/nEEia2VZgn6pDn4gZMUxsA">https://mp.weixin.qq.com/s/nEEia2VZgn6pDn4gZMUxsA</a></p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;__schema&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;queryType&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Query&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;mutationType&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Mutation&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;subscriptionType&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Subscription&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;types&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;OBJECT&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Query&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;fields&quot;</span>: [</span><br><span class="line">                        &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码可见解析文档首先通过解析type字段，然后对里边kind字段的内容进行分类，然后走具体的解析字段的。下面挑几个常用的字段进行解析</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">src/main/java/burp/application/apitypes/graphql/GraphQLIntrospectionParser.java</span><br><span class="line">GraphQLParseResult parseIntrospection(String introspectionJson) &#123;</span><br><span class="line">JsonArray types = introspection.getAsJsonArray(<span class="string">&quot;types&quot;</span>);</span><br><span class="line">        HashMap&lt;String, GraphQLBaseObject&gt; globalObjects = <span class="built_in">new</span> HashMap&lt;&gt;();</span><br><span class="line">        GraphQLParseContext context = <span class="built_in">new</span> GraphQLParseContext(globalObjects);</span><br><span class="line">        <span class="comment">// 解析 GraphQL 自省得到的各种类/接口等等</span></span><br><span class="line">        <span class="keyword">for</span> (JsonElement element : types) &#123;</span><br><span class="line">            JsonObject object = element.getAsJsonObject();</span><br><span class="line">            GraphQLKind objectKind = GraphQLKind.valueOf(object.getAsJsonPrimitive(<span class="string">&quot;kind&quot;</span>).getAsString());</span><br><span class="line">            String name = object.getAsJsonPrimitive(<span class="string">&quot;name&quot;</span>).getAsString();</span><br><span class="line">            <span class="keyword">switch</span> (objectKind) &#123;</span><br><span class="line">                <span class="keyword">case</span> OBJECT:</span><br><span class="line">                    globalObjects.put(name, <span class="built_in">new</span> GraphQLObject(object));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> INTERFACE:</span><br><span class="line">                    globalObjects.put(name, <span class="built_in">new</span> GraphQLInterface(object));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> SCALAR:</span><br><span class="line">                    globalObjects.put(name, <span class="built_in">new</span> GraphQLScalar(name));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> ENUM:</span><br><span class="line">                    globalObjects.put(name, <span class="built_in">new</span> GraphQLEnum(object));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> UNION:</span><br><span class="line">                    globalObjects.put(name, <span class="built_in">new</span> GraphQLUnion(object));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> INPUT_OBJECT:</span><br><span class="line">                    globalObjects.put(name, <span class="built_in">new</span> GraphQLInputObject(object));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    System.out.<span class="built_in">println</span>(objectKind);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GraphQLObject --》 GraphQLObjectField --》GraphQLObjectFieldArgument --》GraphQLObjectType</span><br><span class="line">GraphQLInterface --》GraphQLObjectField --》GraphQLObjectType</span><br><span class="line">SCALAR --》GraphQLScalar --》</span><br><span class="line">GraphQLEnum--》</span><br><span class="line">GraphQLUnion --》GraphQLObjectType</span><br><span class="line">GraphQLInputObject --》GraphQLInputObjectField --》GraphQLObjectType</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="Kind-OBJECT类型"><a href="#Kind-OBJECT类型" class="headerlink" title="Kind:OBJECT类型"></a>Kind:OBJECT类型</h6><p>1.深入到type字段下可知，具体的object类型数据格式大致如下，主要内容都在fields字段</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">                    <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;OBJECT&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;DataTag&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;fields&quot;</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;tag&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;description&quot;</span>: null,</span><br><span class="line">                            <span class="string">&quot;args&quot;</span>: [],</span><br><span class="line">                            <span class="string">&quot;type&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;NON_NULL&quot;</span>,</span><br><span class="line">                                <span class="string">&quot;name&quot;</span>: null,</span><br><span class="line">                                <span class="string">&quot;ofType&quot;</span>: &#123;</span><br><span class="line">                                    <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;SCALAR&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;String&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;ofType&quot;</span>: null</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="string">&quot;isDeprecated&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                            <span class="string">&quot;deprecationReason&quot;</span>: null</span><br><span class="line">                        &#125; 。。。</span><br><span class="line">                    ],</span><br><span class="line">                    <span class="string">&quot;inputFields&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;interfaces&quot;</span>: [],</span><br><span class="line">                    <span class="string">&quot;enumValues&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;possibleTypes&quot;</span>: null</span><br><span class="line">                &#125;,</span><br></pre></td></tr></table></figure>

<p>2.先将json中提取fields 字段内容，然后GraphQLObjectFieldArgument解析args字段，GraphQLObjectType解析type类型值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># src/main/java/burp/application/apitypes/graphql/GraphQLObject.java</span><br><span class="line">public GraphQLObject(JsonObject inputJson) &#123;</span><br><span class="line">        super(inputJson);</span><br><span class="line">        this.kind = GraphQLKind.OBJECT;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (JsonElement jsonElement : inputJson.getAsJsonArray(<span class="string">&quot;fields&quot;</span>)) &#123;</span><br><span class="line">            this.fields.add(<span class="built_in">new</span> GraphQLObjectField(jsonElement.getAsJsonObject()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"># src/main/java/burp/application/apitypes/graphql/GraphQLObjectField.java </span><br><span class="line">public GraphQLObjectField(JsonObject inputJson) &#123;</span><br><span class="line">        super(inputJson);</span><br><span class="line">        this.kind = GraphQLKind.OBJECT_FIELD;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (JsonElement jsonElement : inputJson.getAsJsonArray(<span class="string">&quot;args&quot;</span>)) &#123;</span><br><span class="line">            this.args.add(<span class="built_in">new</span> GraphQLObjectFieldArgument(jsonElement.getAsJsonObject()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        this.<span class="keyword">type</span> = <span class="built_in">new</span> GraphQLObjectType(inputJson.getAsJsonObject(<span class="string">&quot;type&quot;</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>3.仔细看下json中这部分值，kind: “NON_NULL”表示此参数不可为空，然后通过ofType来表明具体要写啥样的参数，</p>
<p>其中这里的 <code>kind: &quot;SCALAR&quot;</code> 表示这个字段的基本类型是一个标量类型（即基础类型）。 </p>
<p><code>name: &quot;String&quot;</code> 表示这个字段的类型是 <code>String</code> 类型。<code>String</code> 是 GraphQL 中的一个标准标量类型，用于表示文本数据。</p>
<p>ofType”: null代表没有复合类型了。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;type&quot;</span>: &#123;</span><br><span class="line">                               <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;NON_NULL&quot;</span>,</span><br><span class="line">                               <span class="string">&quot;name&quot;</span>: null,</span><br><span class="line">                               <span class="string">&quot;ofType&quot;</span>: &#123;</span><br><span class="line">                                   <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;SCALAR&quot;</span>,</span><br><span class="line">                                   <span class="string">&quot;name&quot;</span>: <span class="string">&quot;String&quot;</span>,</span><br><span class="line">                                   <span class="string">&quot;ofType&quot;</span>: null</span><br><span class="line">                               &#125;</span><br></pre></td></tr></table></figure>

<p>在apikit里这部分也有处理逻辑，如果raphQLKind类型为GraphQLKind.NON_NULL和GraphQLKind.LIST 那么就会解析ofType字段，看具体要那种格式的值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># src/main/java/burp/application/apitypes/graphql/GraphQLObjectType.java </span><br><span class="line">public GraphQLObjectType(JsonObject jsonInput) &#123;</span><br><span class="line">        while (<span class="literal">true</span>) &#123;</span><br><span class="line">            GraphQLKind graphQLKind = GraphQLKind.valueOf(jsonInput.getAsJsonPrimitive(<span class="string">&quot;kind&quot;</span>).getAsString());</span><br><span class="line">            <span class="keyword">if</span> (graphQLKind == GraphQLKind.NON_NULL || graphQLKind == GraphQLKind.LIST) &#123;</span><br><span class="line">                modifiers.add(graphQLKind);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                this.kind = graphQLKind;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            jsonInput = jsonInput.getAsJsonObject(<span class="string">&quot;ofType&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        this.typeName = jsonInput.getAsJsonPrimitive(<span class="string">&quot;name&quot;</span>).getAsString();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h6 id="Kind-INTERFACE类型"><a href="#Kind-INTERFACE类型" class="headerlink" title="Kind:INTERFACE类型"></a>Kind:INTERFACE类型</h6><p>1.具体的INTERFACE类型数据格式大致如下，主要内容都在fields字段</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">                   <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;INTERFACE&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;name&quot;</span>: <span class="string">&quot;UserSignUpInterface&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;description&quot;</span>: null,</span><br><span class="line">                   <span class="string">&quot;fields&quot;</span>: [</span><br><span class="line">                       &#123;</span><br><span class="line">                           <span class="string">&quot;name&quot;</span>: <span class="string">&quot;email&quot;</span>,</span><br><span class="line">                           <span class="string">&quot;description&quot;</span>: null,</span><br><span class="line">                           <span class="string">&quot;args&quot;</span>: [],</span><br><span class="line">                           <span class="string">&quot;type&quot;</span>: &#123;</span><br><span class="line">                               <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;NON_NULL&quot;</span>,</span><br><span class="line">                               <span class="string">&quot;name&quot;</span>: null,</span><br><span class="line">                               <span class="string">&quot;ofType&quot;</span>: &#123;</span><br><span class="line">                                   <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;SCALAR&quot;</span>,</span><br><span class="line">                                   <span class="string">&quot;name&quot;</span>: <span class="string">&quot;String&quot;</span>,</span><br><span class="line">                                   <span class="string">&quot;ofType&quot;</span>: null</span><br><span class="line">                               &#125;</span><br><span class="line">                           &#125;,</span><br><span class="line">                           <span class="string">&quot;isDeprecated&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                           <span class="string">&quot;deprecationReason&quot;</span>: null</span><br><span class="line">                       &#125;</span><br><span class="line">                   ],</span><br><span class="line">                   <span class="string">&quot;inputFields&quot;</span>: null,</span><br><span class="line">                   <span class="string">&quot;interfaces&quot;</span>: [],</span><br><span class="line">                   <span class="string">&quot;enumValues&quot;</span>: null,</span><br><span class="line">                   <span class="string">&quot;possibleTypes&quot;</span>: [</span><br><span class="line">                       &#123;</span><br><span class="line">                           <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;OBJECT&quot;</span>,</span><br><span class="line">                           <span class="string">&quot;name&quot;</span>: <span class="string">&quot;UserSignUpActivationEmailSent&quot;</span>,</span><br><span class="line">                           <span class="string">&quot;ofType&quot;</span>: null</span><br><span class="line">                       &#125;,</span><br><span class="line">                   ]</span><br><span class="line">               &#125;,</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>也是处理字段，区别在有了possibleTypes字段,但是接下来解析字段和类型用的函数一样</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public GraphQLInterface(JsonObject inputJson) &#123;</span><br><span class="line">       super(inputJson);</span><br><span class="line">       this.kind = GraphQLKind.INTERFACE;</span><br><span class="line">   </span><br><span class="line">       <span class="keyword">for</span> (JsonElement jsonElement : inputJson.getAsJsonArray(<span class="string">&quot;fields&quot;</span>)) &#123;</span><br><span class="line">           this.fields.add(<span class="built_in">new</span> GraphQLObjectField(jsonElement.getAsJsonObject()));</span><br><span class="line">       &#125;</span><br><span class="line">   </span><br><span class="line">       <span class="keyword">for</span> (JsonElement jsonElement : inputJson.getAsJsonArray(<span class="string">&quot;possibleTypes&quot;</span>)) &#123;</span><br><span class="line">           this.possibleTypes.add(<span class="built_in">new</span> GraphQLObjectType(jsonElement.getAsJsonObject()));</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="1-4-4-模拟请求-发包"><a href="#1-4-4-模拟请求-发包" class="headerlink" title="1.4.4 模拟请求&#x2F;发包"></a>1.4.4 模拟请求&#x2F;发包</h5><p>模拟请求部分，主要是用了一个接口，分别实现了Object、Interface等type类型时，该模拟那些参数，field.exportToQuery(context) 覆写了各种类型下，对于内容的处理，最后返回要模拟查询时的语句</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">GraphQLParseResult parseIntrospection(String introspectionJson) &#123;</span><br><span class="line">     <span class="comment">// 通过 QueryName, MutationName 得到实际的接口</span></span><br><span class="line">        JsonElement queryTypeJson = introspection.get(<span class="string">&quot;queryType&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!queryTypeJson.isJsonNull()) &#123;</span><br><span class="line">            String queryTypeName = queryTypeJson.getAsJsonObject().getAsJsonPrimitive(<span class="string">&quot;name&quot;</span>).getAsString();</span><br><span class="line">            GraphQLObject queryObject = (GraphQLObject) globalObjects.get(queryTypeName);</span><br><span class="line">            <span class="keyword">for</span> (GraphQLObjectField field : queryObject.fields) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    parseResult.queryParseResult.put(field.name, context.getExportQueryIndent() + field.exportToQuery(context));</span><br><span class="line">                &#125; catch (GraphQLParseError e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">比如 # src/main/java/burp/application/apitypes/graphql/GraphQLScalar.java 就是query下参数scalar时，模拟的实现</span><br><span class="line"> public String exportToQuery(GraphQLParseContext context) throws GraphQLParseError &#123;</span><br><span class="line">        String result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (scalarDefaultValues.containsKey(this.typeName)) &#123;</span><br><span class="line">            result = scalarDefaultValues.get(this.typeName);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// throw new GraphQLParseError(&quot;Unexpected scalar type &quot; + this.typeName);</span></span><br><span class="line">            result = String.format(<span class="string">&quot;\&quot;undefined scalar type %s\&quot;&quot;</span>, this.typeName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>上边返回结果数据经过处理后为数据，每一条都含有文档中的&lt;name,模拟发送请求数据&gt;，然后遍历发送。其中graphQL URL都是一致的，只是每次body变换不同，发送即可</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">src/main/java/burp/application/apitypes/graphql/ApiTypeGraphQL.java</span><br><span class="line">public ArrayList&lt;ApiEndpoint&gt; parseApiDocument(IHttpRequestResponse apiDocument, IHttpRequestResponse basePath, boolean isTargetScan) &#123; </span><br><span class="line">endpoints = parseResult.mutationParseResult.entrySet();</span><br><span class="line">        var8 = endpoints.iterator();</span><br><span class="line"></span><br><span class="line">        while(var8.hasNext()) &#123;</span><br><span class="line">            endpoint = (Map.Entry)var8.next();</span><br><span class="line">            <span class="keyword">if</span> (basePath == null) &#123;</span><br><span class="line">                url = this.helpers.analyzeRequest(apiDocument).getUrl();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                url = this.helpers.analyzeRequest(basePath).getUrl();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            newRequest = null;</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                newRequest = this.helpers.buildHttpRequest(<span class="built_in">new</span> URL(url.toString()));</span><br><span class="line">            &#125; catch (MalformedURLException var16) &#123;</span><br><span class="line">                throw <span class="built_in">new</span> ApiKitRuntimeException(var16);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (basePath == null) &#123;</span><br><span class="line">                newRequest = CookieManager.getRequest(apiDocument, newRequest);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                newRequest = CookieManager.getRequest(basePath, newRequest);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            headers = this.helpers.analyzeRequest(newRequest).getHeaders();</span><br><span class="line">            httpFirstLine = Arrays.asList(((String)headers.get(<span class="number">0</span>)).split(<span class="string">&quot; &quot;</span>));</span><br><span class="line">            httpFirstLine.set(<span class="number">0</span>, <span class="string">&quot;POST&quot;</span>);</span><br><span class="line">            headers.set(<span class="number">0</span>, String.join(<span class="string">&quot; &quot;</span>, httpFirstLine));</span><br><span class="line">            headers.add(<span class="string">&quot;Content-Type: application/json&quot;</span>);</span><br><span class="line">            jsonBody = <span class="built_in">new</span> JsonObject();</span><br><span class="line">            jsonBody.add(<span class="string">&quot;query&quot;</span>, <span class="built_in">new</span> JsonPrimitive(<span class="string">&quot;mutation&quot;</span> + Constants.GRAPHQL_SPACE + (String)endpoint.getKey() + Constants.GRAPHQL_SPACE + <span class="string">&quot;&#123;&quot;</span> + Constants.GRAPHQL_NEW_LINE + (String)endpoint.getValue() + Constants.GRAPHQL_NEW_LINE + <span class="string">&quot;&#125;&quot;</span>));</span><br><span class="line">            <span class="keyword">if</span> (isTargetScan) &#123;</span><br><span class="line">                HttpRequestFormator.TrimDupHeader(headers);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            newRequest = this.helpers.buildHttpMessage(headers, (<span class="built_in">new</span> Gson()).toJson(jsonBody).getBytes());</span><br><span class="line">            <span class="keyword">if</span> (basePath == null) &#123;</span><br><span class="line">                newRequest = CookieManager.getRequest(apiDocument, newRequest);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                newRequest = CookieManager.getRequest(basePath, newRequest);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            tempRequestResponse = <span class="built_in">new</span> HttpRequestResponse();</span><br><span class="line">            <span class="keyword">if</span> (basePath == null) &#123;</span><br><span class="line">                tempRequestResponse.setHttpService(apiDocument.getHttpService());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                tempRequestResponse.setHttpService(basePath.getHttpService());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            tempRequestResponse.setRequest(newRequest);</span><br><span class="line">            tempRequestResponse.sendRequest();</span><br><span class="line">            results.add(<span class="built_in">new</span> ApiEndpoint(<span class="string">&quot;mutation:&quot;</span> + Constants.GRAPHQL_SPACE + (String)endpoint.getKey(), tempRequestResponse));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> results;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-4-4-测试效果"><a href="#1-4-4-测试效果" class="headerlink" title="1.4.4 测试效果"></a>1.4.4 测试效果</h4><p>1.测试中发现数据量还是比较大的，因为这个涉及到单URL，重复发送body不同的包，可能会有网络请求问题。</p>
<p>2.模拟的body是以Object和Interface这种类型的模拟成数据为主，参数是以 “kind”: “NON_NULL”,为主流进行模拟的</p>
<h4 id="1-5-1-REST-WADL"><a href="#1-5-1-REST-WADL" class="headerlink" title="1.5.1  REST-WADL"></a>1.5.1  REST-WADL</h4><p>WADL（Web Application Description Language，Web 应用描述语言）是一种基于 XML 的格式，用于描述 RESTful Web 服务的 API。它类似于 WSDL（Web Services Description Language），但 WSDL 主要用于 SOAP，而 WADL 主要用于 REST。</p>
<p>WADL 主要作用<br>描述 REST API：提供 API 的端点、请求方法（GET、POST 等）、请求&#x2F;响应的参数格式等信息。<br>自动生成客户端代码：可以基于 WADL 文件生成 API 客户端代码，提高开发效率。<br>提高 API 文档化：让开发者可以更清晰地了解 API 的结构.</p>
<h4 id="1-5-2-特征匹配"><a href="#1-5-2-特征匹配" class="headerlink" title="1.5.2 特征匹配"></a>1.5.2 特征匹配</h4><p>同样进来的目标 先通过 isFingerprintMatch()过滤存活的特征url路径，路径大致与soap检测的wsdl风格url相似，然后进入urlAddPath进行特征解析,。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># src/main/java/burp/application/apitypes/rest/ApiTypeRest.java</span><br><span class="line">public Boolean isFingerprintMatch() &#123;</span><br><span class="line">        URL url = this.helpers.analyzeRequest(this.baseRequestResponse).getUrl();</span><br><span class="line">        ArrayList&lt;Object&gt; urlList = <span class="built_in">new</span> ArrayList();</span><br><span class="line">        Set&lt;String&gt; UrlPathList = CommonUtils.getUrlPathList(url);</span><br><span class="line">        Iterator iterator = UrlPathList.iterator();</span><br><span class="line"></span><br><span class="line">        while(<span class="literal">true</span>) &#123;</span><br><span class="line">            String tmpurl;</span><br><span class="line">            do &#123;</span><br><span class="line">                <span class="keyword">if</span> (!iterator.hasNext()) &#123;</span><br><span class="line">                    this.urlAddPath(url.toString());</span><br><span class="line">                    Iterator var6 = urlList.iterator();</span><br><span class="line"></span><br><span class="line">                    while(var6.hasNext()) &#123;</span><br><span class="line">                        Object urlPath = var6.next();</span><br><span class="line">                        <span class="keyword">if</span> (!this.urlAddPath(urlPath + <span class="string">&quot;/service&quot;</span>)) &#123;</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/services&quot;</span>);</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/webservices&quot;</span>);</span><br><span class="line">                            this.urlAddPath(urlPath + <span class="string">&quot;/webservice&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> this.getApiDocuments().size() != <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                tmpurl = iterator.next().toString();</span><br><span class="line">            &#125; while(scannedUrl.get(tmpurl) &gt; <span class="number">0</span> &amp;&amp; this.isPassive);</span><br><span class="line"></span><br><span class="line">            urlList.add(tmpurl);</span><br><span class="line">            <span class="keyword">if</span> (this.isPassive) &#123;</span><br><span class="line">                scannedUrl.add(tmpurl);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="urlAddPath主要做特征匹配-正则url解析网页响应流量中是否存在wadl网页，或者出现"><a href="#urlAddPath主要做特征匹配-正则url解析网页响应流量中是否存在wadl网页，或者出现" class="headerlink" title="urlAddPath主要做特征匹配 正则url解析网页响应流量中是否存在wadl网页，或者出现&lt;application 可能是网页本身就是wadl文档"></a>urlAddPath主要做特征匹配 正则url解析网页响应流量中是否存在wadl网页，或者出现&lt;application 可能是网页本身就是wadl文档</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># src/main/java/burp/application/apitypes/rest/ApiTypeRest.java</span><br><span class="line">public Boolean urlAddPath(String apiDocumentUrl) &#123;</span><br><span class="line">      String resp = <span class="built_in">new</span> String(CommonUtils.getHttpResponseBody(newHttpRequestResponse.getResponse()));</span><br><span class="line">            <span class="keyword">if</span> (resp.contains(<span class="string">&quot;&lt;application&quot;</span>) &amp;&amp; resp.contains(<span class="string">&quot;&lt;resources&quot;</span>)) &#123;</span><br><span class="line">                this.getApiDocuments().put(apiDocumentUrl, newHttpRequestResponse);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Pattern pattern = Pattern.compile(<span class="string">&quot;href=\&quot;([^\&quot;]*\\?_?wadl)\&quot;&gt;&quot;</span>);</span><br><span class="line">                Matcher matcher = pattern.matcher(resp);</span><br><span class="line">                Boolean isFound = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">                while(matcher.find()) &#123;</span><br><span class="line">                    isFound = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">                    try &#123;</span><br><span class="line">                        String apidocument = matcher.group(<span class="number">1</span>);</span><br><span class="line">                        <span class="keyword">if</span> (!this.getApiDocuments().containsKey(apidocument)) &#123;</span><br><span class="line">                            newRequest = this.helpers.buildHttpRequest(<span class="built_in">new</span> URL(apidocument));</span><br><span class="line">                            IHttpRequestResponse tempRequestResponse = CookieManager.makeHttpRequest(this.baseRequestResponse, newRequest);</span><br><span class="line">                            this.getApiDocuments().put(apidocument, tempRequestResponse);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; catch (Exception var13) &#123;</span><br><span class="line">                    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-5-2文档解析"><a href="#1-5-2文档解析" class="headerlink" title="1.5.2文档解析"></a>1.5.2文档解析</h4><p>因为wadl风格是restful API格式的解析比较容易，parseWadl主要来解析内容中的api地址</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"># src/main/java/burp/application/apitypes/rest/WadlParser.java</span><br><span class="line">public HashMap&lt;List&lt;String&gt;, <span class="type">byte</span>[]&gt; parseWadl(IHttpRequestResponse apiDocument, IHttpRequestResponse basePath) &#123;</span><br><span class="line">        IExtensionHelpers helpers = BurpExtender.getHelpers();</span><br><span class="line">    。。。</span><br><span class="line">        while(<span class="literal">true</span>) &#123;</span><br><span class="line">            List methods;</span><br><span class="line">            Resource resource;</span><br><span class="line">            do &#123;</span><br><span class="line">                <span class="keyword">if</span> (queue.size() == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> this.apiRequestResponse;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                resource = (Resource)queue.get(<span class="number">0</span>);</span><br><span class="line">                List&lt;Resource&gt; tmpResources = resource.getResources();</span><br><span class="line">                <span class="keyword">if</span> (tmpResources.size() != <span class="number">0</span>) &#123;</span><br><span class="line">                    queue.addAll(tmpResources);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                queue.remove(<span class="number">0</span>);</span><br><span class="line">                <span class="type">byte</span>[] apiRequest = null;</span><br><span class="line">                methods = resource.getMethods();</span><br><span class="line">            &#125; while(methods.size() == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            Iterator var13 = methods.iterator();</span><br><span class="line"></span><br><span class="line">            while(var13.hasNext()) &#123;</span><br><span class="line">               。。。</span><br><span class="line">                this.getParentParametersandPath(resource);</span><br><span class="line">                this.path = this.path.replaceAll(<span class="string">&quot;//&quot;</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (this.path.startsWith(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">                    this.path = this.path.replaceFirst(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (this.path.endsWith(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">                    this.path = this.path.substring(<span class="number">0</span>, this.path.length() - <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (method.getRequest() != null) &#123;</span><br><span class="line">                    Iterator var22 = method.getRequest().getParams().iterator();</span><br><span class="line"></span><br><span class="line">                    while(var22.hasNext()) &#123;</span><br><span class="line">                        Param param = (Param)var22.next();</span><br><span class="line">                        this.addParameter(param);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">				</span><br><span class="line">                this.buildHttpRequestParams();</span><br><span class="line">                this.saveHttpRequest();</span><br><span class="line">                this.clearCache();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>跟进后 this.buildHttpRequestParams(); 会为模拟请求进行准备，包括设置文件头，以及设置请求参数，发送请求类型头是json格式还是xml格式都会进行处理。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"> # src/main/java/burp/application/apitypes/rest/WadlParser.java</span><br><span class="line">public void buildHttpRequestParams() &#123;</span><br><span class="line">        Set matrix;</span><br><span class="line">        Iterator var2;</span><br><span class="line">        Map.Entry entry;</span><br><span class="line">        String paramName;</span><br><span class="line">        String paramValue;</span><br><span class="line">        <span class="keyword">if</span> (((HashMap)this.params.get(<span class="string">&quot;template&quot;</span>)).size() != <span class="number">0</span>) &#123;</span><br><span class="line">            matrix = ((HashMap)this.params.get(<span class="string">&quot;template&quot;</span>)).entrySet();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(var2 = matrix.iterator(); var2.hasNext(); this.path = this.path.replace(<span class="string">&quot;&#123;&quot;</span> + paramName + <span class="string">&quot;&#125;&quot;</span>, paramValue)) &#123;</span><br><span class="line">                entry = (Map.Entry)var2.next();</span><br><span class="line">                paramName = (String)entry.getKey();</span><br><span class="line">                paramValue = mockData(<span class="string">&quot;+&quot;</span> + entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (((HashMap)this.params.get(<span class="string">&quot;query&quot;</span>)).size() != <span class="number">0</span>) &#123;</span><br><span class="line">            matrix = ((HashMap)this.params.get(<span class="string">&quot;query&quot;</span>)).entrySet();</span><br><span class="line">            var2 = matrix.iterator();</span><br><span class="line"></span><br><span class="line">            while(var2.hasNext()) &#123;</span><br><span class="line">                entry = (Map.Entry)var2.next();</span><br><span class="line">                paramName = (String)entry.getKey();</span><br><span class="line">                paramValue = mockData((String)entry.getValue());</span><br><span class="line">                <span class="keyword">switch</span> (this.content_type) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;&quot;</span>:</span><br><span class="line">                        this.para_querystr = this.para_querystr + String.format(<span class="string">&quot;&amp;%s=%s&quot;</span>, paramName, paramValue);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;application/json&quot;</span>:</span><br><span class="line">                        this.para_bodystr = this.para_bodystr + <span class="string">&quot;\&quot;&quot;</span> + paramName + <span class="string">&quot;\&quot;: \&quot;&quot;</span> + paramValue + <span class="string">&quot;\&quot;,&quot;</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;application/xml&quot;</span>:</span><br><span class="line">                        this.para_bodystr = <span class="string">&quot;&lt;?xml&gt;&quot;</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>:</span><br><span class="line">                        this.para_bodystr = this.para_bodystr + String.format(<span class="string">&quot;&amp;%s=%s&quot;</span>, paramName, paramValue);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        this.para_bodystr = <span class="string">&quot;Not Support Media Format&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      。。</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>其中 mockData 负责根据数据类型，返回模拟的假数据</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> # src/main/java/burp/application/apitypes/rest/WadlParser.java</span><br><span class="line">public static String mockData(String value) &#123;</span><br><span class="line">        <span class="keyword">if</span> (value.startsWith(<span class="string">&quot;*&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> value.substring(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Boolean isRequired = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (value.startsWith(<span class="string">&quot;+&quot;</span>)) &#123;</span><br><span class="line">                isRequired = <span class="literal">true</span>;</span><br><span class="line">                value = value.substring(<span class="number">1</span>).toLowerCase(Locale.ROOT);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">switch</span> (value) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;string&quot;</span>:</span><br><span class="line">                    value = value.replace(value, <span class="string">&quot;testString&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;int&quot;</span>:</span><br><span class="line">                    value = value.replace(value, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    value = isRequired ? <span class="string">&quot;&#123;RequiredValue:\t&quot;</span> + value + <span class="string">&quot;&#125;&quot;</span> : <span class="string">&quot;[OptionalValue\t&quot;</span> + value + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<p>1.5.4根据反编译jar包，新版源码</p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源. </span>
    </div>
</article>







    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2022-2024
</p>


    </div>
    <div class="full-toc">
        <button class="full" data-title="Toggle full screen shortcut key s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>







</html>
